import{a as w}from"./chunk-4TQV4WQK.js";import{a as te}from"./chunk-7N33FE2K.js";import{b as Y}from"./chunk-JBNC72Z7.js";import{a as S}from"./chunk-QA4O23TC.js";import{o as k}from"./chunk-CUMGWIKM.js";import"./chunk-OSUEIBEK.js";import{a as ie}from"./chunk-UZO5QNZS.js";import{c as Z,d as $}from"./chunk-HU6BYMHG.js";import{a as ee}from"./chunk-U2EAJGNN.js";import{a as D}from"./chunk-4TSZW343.js";import{a as T,b as X}from"./chunk-OO4BC6LN.js";import{a as Q}from"./chunk-67M5LFVM.js";import"./chunk-GKZUPR7X.js";import"./chunk-QUGPZPJP.js";import{m as x,o as J,t as v,u as K,v as A}from"./chunk-O2FCGDZ2.js";import{$b as P,Ba as C,Bc as s,C as q,Dc as F,Ec as U,Jc as b,La as H,Lc as y,Ma as M,Mb as f,Qb as O,Qc as h,Rc as g,Sb as G,Sc as W,Ua as V,Vb as m,aa as N,ec as i,fc as n,gc as c,hc as j,ic as z,kc as B,n as R,qc as d,rc as u,v as _,wb as l,xa as r}from"./chunk-H565K2KG.js";var se=o=>({"mb-3":o});function le(o,e){if(o&1&&(i(0,"div",15)(1,"div",17)(2,"div",18)(3,"i",19),c(4,"span",4)(5,"span",5)(6,"span",11),n(),i(7,"span"),s(8),n()()()()),o&2){let t=u();l(8),F("Asistencia despu\xE9s de ",t.todayHorario," se marcar\xE1 como tarde")}}var E=class I{constructor(){this.showBanner=!1,this.modal=r(k),this.asistenciaService=r(w),this.auth=r(S).user()?.personal,this.isLoading=r(D).isLoading,this.onRequestComplete=new V,this.todayHorario="",this.currentDate=new Date}close(){this.modal.dismissAll()}confirmAsistencia(){this.asistenciaService.create({id_personal:this.auth?.id_personal,fecha:this.currentDate,hora_asistencia:this.currentDate.toTimeString().slice(0,8),id_status:this.showBanner?2:1}).subscribe({next:()=>{this.onRequestComplete.emit(),this.close()},error:e=>{console.error(e)}})}static{this.\u0275fac=function(t){return new(t||I)}}static{this.\u0275cmp=C({type:I,selectors:[["app-check-asistencia"]],outputs:{onRequestComplete:"onRequestComplete"},standalone:!0,features:[b],decls:29,vars:13,consts:[[1,"modal-header"],["id","modal-basic-title",1,"modal-title","d-flex","align-items-center","gap-1"],[1,"text-primary"],[1,"ki-duotone","ki-time","text-gray-900","fs-2x",2,"vertical-align","text-top"],[1,"path1"],[1,"path2"],["type","button","aria-label","Close",1,"btn","btn-sm","btn-icon","btn-active-color-primary","btn-color-gray-800",3,"click"],[1,"ki-duotone","ki-cross-square","fs-1"],[1,"modal-body"],[1,"d-flex","gap-3","alert","alert-primary","rounded","align-items-center"],[1,"ki-duotone","ki-timer","text-primary","fs-3x"],[1,"path3"],[1,"d-flex","flex-column","gap-2",3,"ngClass"],[1,"d-flex","fs-5","align-items-center","gap-2"],[1,"fw-bold","fs-3"],[1,"alert","alert-warning","rounded"],["type","button",1,"btn","btn-success","w-100",3,"click","disabled"],[1,"d-flex","fs-6","gap-3","align-items-start"],[1,"d-flex","gap-3"],[1,"ki-duotone","ki-information","text-warning","fs-1"]],template:function(t,a){t&1&&(i(0,"div",0)(1,"h4",1)(2,"span",2)(3,"i",3),c(4,"span",4)(5,"span",5),n()(),s(6," Confirmar Asistencia "),n(),i(7,"button",6),d("click",function(){return a.close()}),i(8,"i",7),c(9,"span",4)(10,"span",5),n()()(),i(11,"div",8)(12,"div",9)(13,"i",10),c(14,"span",4)(15,"span",5)(16,"span",11),n(),i(17,"div",12)(18,"span",13)(19,"strong"),s(20,"Hora Actual:"),n(),s(21),h(22,"date"),n(),i(23,"span",14),s(24),n()()(),f(25,le,9,1,"div",15),i(26,"button",16),h(27,"async"),d("click",function(){return a.confirmAsistencia()}),s(28,"Marcar Asistencia"),n()()),t&2&&(l(17),m("ngClass",y(11,se,!a.showBanner)),l(4),F(" ",W(22,6,a.currentDate,"HH:mm")," "),l(3),U("",a.auth==null?null:a.auth.nombre," \u2022 ",a.auth==null?null:a.auth.terapia.nombre,""),l(),P(a.showBanner?25:-1),l(),m("disabled",g(27,9,a.isLoading)))},dependencies:[A,x,v,K]})}};E=_([T()],E);var ce=()=>[v,Z],me=o=>[o];function de(o,e){if(o&1){let t=B();i(0,"button",19),d("click",function(){H(t);let p=u();return M(p.openConfirmModal())}),s(1,"Marcar Asistencia"),n()}if(o&2){let t=u();m("disabled",t.loadingHorario)}}function pe(o,e){if(o&1){let t=B();i(0,"ag-grid-angular",20),h(1,"async"),h(2,"async"),d("gridReady",function(p){H(t);let ae=u();return M(ae.gridReady(p))}),n()}if(o&2){let t=u();m("rowData",g(1,7,t.asistenciaList))("columnDefs",t.colDefs)("enableCellTextSelection",!0)("localeText",t.localeText)("ariaHidden",!0)("pagination",!0)("loading",g(2,9,t.isLoading))}}function ue(o,e){o&1&&(i(0,"div",21)(1,"div",22)(2,"span",23),s(3,"Loading..."),n()()())}var ne=class L{constructor(){this.personalService=r(te),this.horarios=[],this.auth=r(S).user()?.personal,this.asistenciaService=r(w),this.isLoading=r(D).isLoading,this.theme=r(Q),this.modal=r(k),this.asistenciaList=new R,this.loadingHorario=!1,this.btnVisible=!0,this.localeText=ee,this.colDefs=[{headerName:"Fecha",field:"fecha",filter:"agDateColumnFilter",valueFormatter:e=>ie(e.value)},{headerName:"Hora de Marcado",field:"hora_asistencia",filter:"agDateColumnFilter"},{headerName:"Status",field:"status.nombre",cellClass:"fw-bold",filter:"agTextColumnFilter",minWidth:250}],this.currentDay=new Date().getDay()}ngOnInit(){this.getHorarios(),this.getAsistencia()}loadTabla(){this.getAsistencia()}gridReady(e){this.gridApi=e.api}onFilterTextBoxChanged(){this.gridApi.setGridOption("quickFilterText",document.getElementById("asistencia-search").value)}getAsistencia(){this.asistenciaList=this.asistenciaService.getByPersonal(this.auth?.id_personal).pipe(q(e=>e.data))}getHorarios(){this.loadingHorario=!0,this.personalService.getHorario(this.auth?.id_personal).pipe(N(()=>this.loadingHorario=!1),X(this)).subscribe(e=>{this.horarios=e.data})}get showBanner(){return this.horarios?.some(e=>e.dia_semana===this.currentDay&&this.convertTimeToMinutes(e.hora_inicio)<this.convertTimeToMinutes(new Date().toTimeString().slice(0,5)))}get todayHorario(){return(this.horarios?.find(t=>t.dia_semana===this.currentDay)).hora_inicio}convertTimeToMinutes(e){let[t,a]=e.split(":").map(Number);return t*60+a}get isCurrentDayInSchedule(){return this.horarios?.some(e=>e.dia_semana===this.currentDay)}openConfirmModal(){let e=this.modal.open(E,{centered:!0,scrollable:!0,backdrop:"static"});e.componentInstance.todayHorario=this.todayHorario,e.componentInstance.showBanner=this.showBanner,e.componentInstance.onRequestComplete.subscribe(()=>{this.btnVisible=!1,this.getAsistencia()})}static{this.\u0275fac=function(t){return new(t||L)}}static{this.\u0275cmp=C({type:L,selectors:[["app-asistencia"]],standalone:!0,features:[b],decls:26,vars:4,consts:[["header-title",""],[1,"d-flex","align-items-center","text-white","fw-bold","my-1"],[1,"content","d-flex","flex-column","flex-column-fluid"],[1,"container-xxl"],[1,"card","shadow","p-2","px-4"],[1,"d-flex","py-4","justify-content-between","align-items-center"],["data-kt-search-element","form","autocomplete","off",1,"position-relative"],["type","hidden"],[1,"ki-duotone","ki-magnifier","fs-2","search-icon","position-absolute","top-50","translate-middle-y","ms-4"],[1,"path1"],[1,"path2"],["type","search","id","asistencia-search","name","search","value","","placeholder","B\xFAsqueda","data-kt-search-element","input",1,"form-control","custom-form-control","ps-13",3,"input"],[1,"d-flex","align-items-center","gap-3"],["type","button","class","btn btn-secondary",3,"disabled","click",4,"ngIf"],["type","button",1,"btn","btn-light-primary",3,"click"],[1,"d-flex","align-items-center"],[1,"fa-solid","fa-rotate-right"],[1,"ms-2"],[2,"height","calc(100dvh - 281px)",3,"ngClass"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],["loadingMessage","Cargando...",2,"width","100%","height","100%",3,"gridReady","rowData","columnDefs","enableCellTextSelection","localeText","ariaHidden","pagination","loading"],[1,"d-flex","justify-content-center","align-items-center",2,"height","100%"],["role","status",1,"spinner-border"],[1,"visually-hidden"]],template:function(t,a){t&1&&(i(0,"app-header"),j(1,0),i(2,"h1",1),s(3," Historial de Asistencia "),n(),z(),n(),i(4,"div",2)(5,"div",3)(6,"div",4)(7,"div",5)(8,"form",6),c(9,"input",7),i(10,"i",8),c(11,"span",9)(12,"span",10),n(),i(13,"input",11),d("input",function(){return a.onFilterTextBoxChanged()}),n()(),i(14,"div",12),f(15,de,2,1,"button",13),i(16,"button",14),d("click",function(){return a.loadTabla()}),i(17,"span",15),c(18,"span",16),i(19,"span",17),s(20,"Actualizar"),n()()()()(),i(21,"div",18),f(22,pe,3,11)(23,ue,4,0),O(24,22,ce,23),G(),n()()()()),t&2&&(l(15),m("ngIf",a.btnVisible&&a.isCurrentDayInSchedule),l(6),m("ngClass",y(2,me,a.theme.getThemeMode()==="light"?"ag-theme-quartz":"ag-theme-quartz-dark")))},dependencies:[Y,A,x,J,$]})}};ne=_([T()],ne);export{ne as AsistenciaComponent};
