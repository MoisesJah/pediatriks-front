import{a as Ze,c as Ke}from"./chunk-SGCSK6S6.js";import{a as Re,b as Be,c as He,d as je,e as $e}from"./chunk-ZJJN7SN5.js";import{a as j}from"./chunk-7YUY65AQ.js";import{a as Ue,b as Ye}from"./chunk-JLG5ANCQ.js";import{ib as Qe,jb as ze,lb as Je}from"./chunk-HSVI2AL3.js";import"./chunk-D5V43OAI.js";import{a as B}from"./chunk-VTU3SGCZ.js";import"./chunk-T5EURV5D.js";import{a as Ae}from"./chunk-LPXLFVB6.js";import{a as R}from"./chunk-3B2MPMJU.js";import{a as Ne}from"./chunk-QSXVNZMY.js";import{a as Ge}from"./chunk-C62D5LBB.js";import"./chunk-QHO6RQLH.js";import{c as Ie,d as Oe}from"./chunk-SX6LGTBN.js";import{a as De}from"./chunk-FLXP5CLU.js";import{a as Le,b as We}from"./chunk-C3PJ6G3N.js";import"./chunk-GT4JH6HJ.js";import"./chunk-EBZKSOFQ.js";import{b as qe}from"./chunk-SMQXWYLW.js";import{A as Ve,o as T,x as we,y as Fe,z as Ee}from"./chunk-SZA4NEXD.js";import{a as G}from"./chunk-5ZMKPZZY.js";import"./chunk-3IC3XWDF.js";import{a as Me,b as A}from"./chunk-T3S5D2ZO.js";import"./chunk-H7V4WWIX.js";import"./chunk-GKZUPR7X.js";import{A as be,D as ye,E as Se,F as xe,G as ke,K as Te,N as W,P as Pe,j as ue,k as he,l as fe,r as _e,s as b,t as ge,u as ve,z as Ce}from"./chunk-DA7F7PFS.js";import{m as O,n as me,o as pe,t as N,v as L}from"./chunk-IVHFDWNE.js";import{$b as ee,Ac as re,Ba as V,Bc as m,C as x,Cc as se,Dc as k,Jc as D,La as f,Lc as I,Ma as _,Mb as g,Mc as le,Nc as ce,Qb as Z,Qc as v,Rc as C,Tb as K,Tc as de,Ua as Y,Ub as X,Vb as c,Z as U,a as w,aa as E,b as F,ec as r,fc as o,gc as u,hc as te,ic as ie,ka as J,kc as q,n as S,qc as y,rc as h,v as Q,w as z,wb as l,xa as d,xb as M,xc as ae,yc as ne,zc as oe}from"./chunk-MKY54U27.js";var tt=n=>({"mb-4":n}),it=(n,i)=>({slots:n,index:i}),at=(n,i,e)=>({"btn-active-success active":n,"btn-active-primary active":i,"cursor-not-allowed":e});function nt(n,i){if(n&1){let e=q();r(0,"div",13)(1,"label",28),m(2,"Seleccionar Paquete"),o(),r(3,"ng-select",29),v(4,"async"),y("change",function(a){f(e);let s=h();return _(s.changePaquete(a))}),o()()}if(n&2){let e=h();l(3),c("items",C(4,3,e.paquetesList))("loading",e.loadingPaquetes)("loadingText","Cargando...")}}function ot(n,i){if(n&1&&(r(0,"label",28),m(1),o(),u(2,"input",30)),n&2){let e=h();l(),k("N\xB0 de Sesiones (",e.maxSesiones,")"),l(),X("max",e.maxSesiones)}}function rt(n,i){n&1&&(r(0,"label",31),m(1,"Hora de Fin"),o(),u(2,"input",32))}function st(n,i){if(n&1){let e=q();r(0,"app-slot-time-picker",33),y("deleselected",function(){let a=f(e).index,s=h();return _(s.onDeselect(a))})("selectedSlot",function(a){let s=f(e).index,p=h();return _(p.onSlotSelected(s,a))}),o()}if(n&2){let e=i.slots;c("slotTimes",e)}}function lt(n,i){if(n&1&&(r(0,"span",41),m(1),o()),n&2){let e=h().$implicit;l(),se(e.value.selectedTimeSlot)}}function ct(n,i){if(n&1&&(r(0,"div",38)(1,"button",39),m(2),o(),g(3,lt,2,1,"span",40),o()),n&2){let e=i.$implicit,t=i.index,a=h(2),s=re(39);c("formGroupName",t),l(),c("disablePopover",!a.isEnabledDay(e.value.dia_semana)||a.isCurrentDayOfWeek(e.value.dia_semana))("disableTooltip",a.isEnabledDay(e.value.dia_semana))("ngbPopover",s)("popoverContext",le(8,it,a.getTimeSlots(e.value.dia_semana),t))("ngClass",ce(11,at,a.isOptionSelected(e.value.dia_semana)&&e.value.selectedTimeSlot&&!a.isCurrentDayOfWeek(e.value.dia_semana),a.isCurrentDayOfWeek(e.value.dia_semana),!a.isEnabledDay(e.value.dia_semana))),l(),k(" ",a.getDayLabel(e.value.dia_semana)," "),l(),c("ngIf",e.value.selectedTimeSlot&&!a.isCurrentDayOfWeek(e.value.dia_semana))}}function dt(n,i){if(n&1&&(r(0,"div",12)(1,"div",34)(2,"label",35),m(3,"Dias Disponibles"),o(),r(4,"div",36),g(5,ct,4,15,"div",37),o()()()),n&2){let e=h();l(4),c("ngClass",I(2,tt,e.diferentSlots())),l(),c("ngForOf",e.days.controls)}}function mt(n,i){n&1&&u(0,"span",42)}var H=class ${constructor(i){this.fb=i,this.personalService=d(R),this.pacienteService=d(Ge),this.tipoCitaService=d(Ue),this.terapiaService=d(Ne),this.paquetesService=d(Ae),this.isLoading=d(G).isLoading,this.citaService=d(B),this.toast=d(De),this.onSaveComplete=new Y,this.modal=d(T),this.personal=null,this.isCitaContinua=!1,this.pacientesList=new S,this.tipoCitasList=new S,this.paquetesList=new S,this.maxSesiones=0,this.isRecurrente=!1,this.isCitaPaquete=!1,this.id_tipopaquete="",this.num_cambios=0,this.loadingPacientes=!1,this.loadingPaquetes=!1,this.loadingTipoCitas=!1,this.slotTimeList=[],this.timeOptions={enableTime:!0,noCalendar:!0,dateFormat:"H:i"},this.options=[{label:"L",value:1},{label:"M",value:2},{label:"MI",value:3},{label:"J",value:4},{label:"V",value:5},{label:"S",value:6}],this.isEnabledDay=e=>(this.personal?.horarios).some(a=>a.daysOfWeek.includes(e)),this.isOptionSelected=e=>{let t=this.createForm.get("fecha_inicio")?.value,a=new Date(t).getDay()+1,s=this.createForm.get("recurrencia"),p=`${this.createForm.get("hora_inicio")?.value} - ${this.createForm.get("hora_fin")?.value}`;return e===a?(s.controls.find(P=>P.value.dia_semana===e)?.setValue({dia_semana:e,selectedTimeSlot:p}),!0):s.controls.find(P=>P.value.dia_semana===e&&P.value.selectedTimeSlot)&&this.isEnabledDay(e)},this.createForm=this.fb.group({id_paciente:[null,b.required],id_tipocita:[null,b.required],id_paquete:[null],fecha_inicio:[null,b.required],hora_inicio:[null,b.required],hora_fin:[null,b.required],descripcion:[null],paquete:[null],num_sesiones:[null],recurrencia:this.fb.array(this.options.map(e=>this.createDayGroup(e.value)))})}createDayGroup(i){return this.fb.group({dia_semana:[i],selectedTimeSlot:[null]})}diferentSlots(){let i=new Date(this.createForm.get("fecha_inicio")?.value).getDay()+1;return this.createForm.get("recurrencia").value.some(t=>t.dia_semana!==i&&t.selectedTimeSlot!==null)}get days(){return this.createForm.get("recurrencia")}getDayLabel(i){return this.options.find(t=>t.value===i).label||""}onSlotSelected(i,e){this.days.at(i).patchValue({selectedTimeSlot:e})}onDeselect(i){this.days.at(i).patchValue({selectedTimeSlot:null})}ngOnInit(){this.loadPacientes(),this.loadTipoCitas()}changePaquete(i){let e=this.createForm.get("id_paquete"),t=this.createForm.get("num_sesiones");this.maxSesiones=i?.num_sesiones,this.num_cambios=i?.num_cambios,e.value?(t.setValue(i.num_sesiones),t.setValidators([b.required,b.max(i.num_sesiones)])):(t.setValue(null),t.clearValidators()),t.updateValueAndValidity()}changeTipoCita(i){this.isRecurrente=i?.recurrente,this.isCitaPaquete=i?.nombre==="Paquete",this.id_tipopaquete=this.isCitaPaquete&&i?.id_tipocita;let e=this.createForm.get("id_paquete"),t=this.createForm.get("num_sesiones");this.isCitaPaquete?e?.setValidators(b.required):(e?.clearValidators(),e?.setValue(null),t?.setValue(null),t?.clearValidators()),e?.updateValueAndValidity(),t?.updateValueAndValidity()}changePaciente(i){let e=this.createForm.get("id_paquete");e&&(e.setValue(null),e.clearValidators())}closeModal(){this.modal.dismissAll()}loadPaquetesPaciente(){this.createForm.valueChanges.pipe(U((i,e)=>i.id_paciente===e.id_paciente&&e.id_tipocita===this.id_tipopaquete)).subscribe(i=>{let{id_paciente:e}=i;e&&this.loadPaquetes(e)})}loadTipoCitas(){this.loadingTipoCitas=!0,this.tipoCitasList=this.tipoCitaService.getAll().pipe(x(i=>i.data),E(()=>this.loadingTipoCitas=!1),A(this))}loadPaquetes(i){this.loadingPaquetes=!0;let e={id_paciente:i,id_terapia:this.personal?.terapia.id_terapia};this.paquetesList=this.paquetesService.getByPaciente(e).pipe(x(t=>t.data),E(()=>this.loadingPaquetes=!1),A(this))}loadPacientes(){this.loadingPacientes=!0,this.pacientesList=this.pacienteService.getAll().pipe(x(i=>i.data),E(()=>this.loadingPacientes=!1),A(this))}getTimeSlots(i){let e=this.slotTimeList?.find(t=>t.dia_semana===i);return e?e.time_slots:[]}toggleOption(i){let e=this.createForm.get("recurrencia"),t=this.createForm.get("fecha_inicio")?.value,a=new Date(t).getDay()+1,s=`${this.createForm.get("hora_inicio")?.value} - ${this.createForm.get("hora_fin")?.value}`;if(i===a)e.controls.find(p=>p.value.dia_semana===i)?.setValue({dia_semana:i,selectedTimeSlot:s});else{let p=e.value.indexOf(i);p!==-1?e.removeAt(p):e.push(this.fb.control({dia_semana:i}))}}isCurrentDayOfWeek(i){let e=this.createForm.get("fecha_inicio")?.value,t=new Date(e).getDay()+1;return i===t}ngAfterViewInit(){this.loadPaquetesPaciente(),this.slotTimeList=Ke(this.personal?.horarios,this.personal?.terapia.duracion)}createCita(){this.createForm.valid&&this.citaService.createForTherapy(F(w({},this.createForm.value),{id_sede:this.personal?.sede.id_sede,id_terapia:this.personal?.terapia.id_terapia,id_personal:this.personal?.id_personal,recurrencia:this.days.value.filter(i=>i.selectedTimeSlot)})).subscribe({next:i=>{this.onSaveComplete.emit(),this.closeModal(),i.message.startsWith("Cita")||this.toast.info(i.message,"Cita Creada",{disableTimeOut:!0,closeButton:!0})},error:i=>{if(i.error.errors){let e=Object.values(i.error.errors).join(`
`);this.toast.error(e,"Error")}else this.toast.error("Ocurri\xF3 un error al crear la cita","Error")}})}static{this.\u0275fac=function(e){return new(e||$)(M(W))}}static{this.\u0275cmp=V({type:$,selectors:[["app-create-modal"]],outputs:{onSaveComplete:"onSaveComplete"},standalone:!0,features:[D],decls:49,vars:24,consts:[["slot",""],[1,"modal-header"],[1,"modal-title"],[1,"text-primary"],[1,"ki-duotone","ki-add-files","text-gray-900","fs-1",2,"vertical-align","text-top"],[1,"path1"],[1,"path2"],[1,"path3"],["type","button","aria-label","Close",1,"btn","btn-sm","btn-icon","btn-active-color-primary","btn-color-gray-800",3,"click"],[1,"ki-duotone","ki-cross-square","fs-1"],[1,"modal-body"],[1,"form","d-flex","flex-column","gap-4",3,"formGroup"],[1,"row"],[1,"form-group","col-6"],["for","kt_calendar_datepicker_date",1,"form-label"],["bindValue","id_paciente","placeholder","Seleccionar","bindLabel","nombre","formControlName","id_paciente",3,"change","items","loading","loadingText"],[1,"form-label"],["bindValue","id_tipocita","placeholder","Seleccionar","bindLabel","nombre","formControlName","id_tipocita",3,"change","items","loading","loadingText"],["class","form-group col-6",4,"ngIf"],[1,"form-group","col","mb-3"],["type","text","id","kt_calendar_datepicker_date","formControlName","fecha_inicio","mwlFlatpickr","","readonly","","placeholder","Seleccionar Fecha(s)",1,"form-control",3,"noCalendar","altInput","altFormat"],["for","kt_calendar_datepicker_start_time",1,"form-label"],["type","text","id","kt_calendar_datepicker_start_time","formControlName","hora_inicio","readonly","","placeholder","Seleccionar Hora de Inicio",1,"form-control"],["class","row",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-light",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["class","spinner-border spinner-border-sm align-middle ms-2",4,"ngIf"],["for","",1,"form-label"],["bindValue","paquete.id_paquetes","placeholder","Seleccionar Paquete","bindLabel","paquete.nombre","formControlName","id_paquete",3,"change","items","loading","loadingText"],["type","number","min","1","step","1","formControlName","num_sesiones",1,"form-control"],["for","kt_calendar_datepicker_end_time",1,"form-label"],["type","text","id","kt_calendar_datepicker_end_time","formControlName","hora_fin","readonly","","placeholder","Seleccionar Hora de Fin",1,"form-control"],[3,"deleselected","selectedSlot","slotTimes"],[1,"form-group","d-flex","flex-column","col","mb-3"],["for","kt_calendar_datepicker_end_date",1,"form-label"],["formArrayName","recurrencia",1,"btn-group",3,"ngClass"],["class","btn-group flex-grow-1",3,"formGroupName",4,"ngFor","ngForOf"],[1,"btn-group","flex-grow-1",3,"formGroupName"],["type","button","ngbTooltip","No Disponible","placement","bottom",1,"btn","btn-outline","mactive","position-relative",3,"disablePopover","disableTooltip","ngbPopover","popoverContext","ngClass"],["class","position-absolute fs-10 fs-sm-8 badge mt-1 rounded-pill bg-success slot-time",4,"ngIf"],[1,"position-absolute","fs-10","fs-sm-8","badge","mt-1","rounded-pill","bg-success","slot-time"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"]],template:function(e,t){if(e&1){let a=q();r(0,"div",1)(1,"h4",2)(2,"span",3)(3,"i",4),u(4,"span",5)(5,"span",6)(6,"span",7),o()(),m(7),o(),r(8,"button",8),y("click",function(){return f(a),_(t.closeModal())}),r(9,"i",9),u(10,"span",5)(11,"span",6),o()()(),r(12,"div",10)(13,"form",11)(14,"section",12)(15,"div",13)(16,"label",14),m(17,"Seleccionar Paciente"),o(),r(18,"ng-select",15),v(19,"async"),y("change",function(p){return f(a),_(t.changePaciente(p))}),o()(),r(20,"div",13)(21,"label",16),m(22,"Seleccionar Tipo de Cita"),o(),r(23,"ng-select",17),v(24,"async"),y("change",function(p){return f(a),_(t.changeTipoCita(p))}),o()()(),g(25,nt,5,5,"div",18),r(26,"div",12)(27,"div",19)(28,"label",14),m(29,"Fecha"),o(),u(30,"input",20),o(),r(31,"div",19)(32,"label",21),m(33,"Hora de Inicio"),o(),u(34,"input",22),o(),r(35,"div",19),g(36,ot,3,2)(37,rt,3,0),o()(),g(38,st,1,1,"ng-template",null,0,de)(40,dt,6,4,"div",23),o()(),r(41,"div",24)(42,"button",25),y("click",function(){return f(a),_(t.closeModal())}),m(43,"Cancelar"),o(),r(44,"button",26),v(45,"async"),y("click",function(){return f(a),_(t.createCita())}),m(46," Registrar "),g(47,mt,1,0,"span",27),v(48,"async"),o()()}if(e&2){let a;l(7),k(" Registrar Cita para ",t.personal==null?null:t.personal.nombre," "),l(6),c("formGroup",t.createForm),l(5),c("items",C(19,16,t.pacientesList))("loading",t.loadingPacientes)("loadingText","Cargando..."),l(5),c("items",C(24,18,t.tipoCitasList))("loading",t.loadingTipoCitas)("loadingText","Cargando..."),l(2),c("ngIf",t.isCitaPaquete),l(5),c("noCalendar",!0)("altInput",!0)("altFormat","d/m/Y"),l(6),ee((a=t.createForm.get("id_paquete"))!=null&&a.value?36:37),l(4),c("ngIf",t.isRecurrente),l(4),c("disabled",!t.createForm.valid||C(45,20,t.isLoading)),l(3),c("ngIf",C(48,22,t.isLoading))}},dependencies:[Pe,Ce,_e,be,ge,ve,Te,ye,ke,Se,xe,We,Le,Oe,Ie,L,O,me,pe,N,Ze,Fe,we,Ve,Ee]})}};H=Q([Me({checkProperties:!0}),z("design:paramtypes",[W])],H);var pt=["calendar"],ut=()=>[Qe,O,N],ht=n=>({"opacity-50":n});function ft(n,i){if(n&1&&(u(0,"full-calendar",10,0),v(2,"async"),v(3,"async")),n&2){let e=h();c("events",C(2,3,e.citasEvent))("ngClass",I(7,ht,C(3,5,e.isLoading)))("options",e.calendarOptions)}}function _t(n,i){n&1&&(r(0,"h1"),m(1,"Loading..."),o())}var fi=(()=>{class n{get bodyParams(){return{id_personal:this.personalId,startWeek:this.startWeek,endWeek:this.endWeek}}constructor(e){this.route=e,this.isLoading=d(G).isLoading,this.modal=d(T),this.loadingCalendar=!1,this.citasService=d(B),this.personalService=d(R),this.modalService=d(T),this.router=d(fe),this.citasEvent=new S,this.personalId=this.route.snapshot.params.terapist,this.startWeek=j().startOfWeek,this.endWeek=j().endOfWeek,this.calendarOptions={plugins:[Re,Be,He,je],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},eventMaxStack:1,allDaySlot:!1,expandRows:!0,slotLabelInterval:"00:05:00",slotMinTime:"08:00",slotMaxTime:"20:00:00",slotLabelFormat:{hour:"numeric",minute:"2-digit",omitZeroMinute:!1,meridiem:"narrow"},eventTimeFormat:{hour:"numeric",minute:"2-digit",meridiem:"short"},selectConstraint:"businessHours",initialView:"timeGridWeek",weekends:!0,editable:!0,loading:t=>{this.loadingCalendar=t},select:t=>this.handleClick(t),eventClick:this.handleEventClick.bind(this),selectAllow:t=>{let a=this.calendar?.getApi()?.view.type=="timeGridWeek",s=new Date;return t.end>s&&a&&(s<t.start||s>=t.end)},selectable:!0,selectMirror:!0,dayMaxEvents:!0,locale:$e,datesSet:t=>{this.startWeek=t.view.activeStart,this.endWeek=t.view.activeEnd,this.loadCitas(this.bodyParams)}},this.route.params.subscribe(()=>{this.startWeek=this.calendar?.getApi()?.view.activeStart,this.endWeek=this.calendar?.getApi()?.view.activeEnd})}ngOnInit(){this.route.params.pipe(J(({terapist:e})=>this.personalId=e)).subscribe(e=>{this.loadCitas(this.bodyParams)}),this.route.data.subscribe(e=>{this.currentPersonal=e.personal,this.calendarOptions=F(w({},this.calendarOptions),{businessHours:this.currentPersonal?.horarios,slotDuration:this.currentPersonal?.terapia.duracion})})}handleClick(e){let t=this.modal.open(H,{size:"lg",centered:!0});t.componentInstance.personal=this.currentPersonal,t.componentInstance.onSaveComplete.subscribe(()=>{this.loadCitas(this.bodyParams)}),t.componentInstance.createForm.patchValue({fecha_inicio:e.startStr.substring(0,10),hora_inicio:e.startStr.substring(11,16),hora_fin:e.endStr.substring(11,16)})}handleEventClick(e){let t=e.event,a=this.modalService.open(Je,{centered:!0,size:"100",scrollable:!0,backdrop:"static"});window.document.body.classList.add("modal-open"),a.componentInstance.eventId=t.id,a.componentInstance.citaId=t.extendedProps.id_cita,a.componentInstance.eventUpdated.subscribe(()=>{this.loadCitas(this.bodyParams)})}loadCitas(e){if(this.currentPersonal)return this.citasEvent=this.citasService.getByPersonal(e).pipe(x(t=>t.data))}static{this.\u0275fac=function(t){return new(t||n)(M(ue))}}static{this.\u0275cmp=V({type:n,selectors:[["app-especialista"]],viewQuery:function(t,a){if(t&1&&ae(pt,5),t&2){let s;ne(s=oe())&&(a.calendar=s.first)}},standalone:!0,features:[D],decls:17,vars:1,consts:[["calendar",""],["header-title",""],[1,"d-flex","align-items-center","text-white","fw-bold","my-1"],[1,"content","d-flex","flex-column","flex-column-fluid"],["id","kt_content_container",1,"container-xxl"],[1,"card"],[1,"card-header"],[1,"card-toolbar","d-flex","ms-auto","justify-content-end"],[1,"card-body",2,"border","none","box-shadow","0 4px 8px rgba(0, 0, 0, 0.1)","border-radius","0 0 15px 15px"],[1,"demo-app-main"],[3,"events","ngClass","options"]],template:function(t,a){t&1&&(r(0,"app-header"),te(1,1),r(2,"h1",2),m(3),o(),ie(),o(),r(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6)(8,"div",7),u(9,"app-dropdown"),o()(),r(10,"div",8)(11,"div",9),g(12,ft,4,9)(13,_t,2,0),Z(14,12,ut,null,13),K(0,-1),o()()()()(),u(16,"router-outlet")),t&2&&(l(3),k(" ",a.currentPersonal==null?null:a.currentPersonal.nombre," "))},dependencies:[qe,Ye,ze,L,he]})}}return n})();export{fi as EspecialistaComponent};
