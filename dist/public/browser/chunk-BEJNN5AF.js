import{a as _,b as P}from"./chunk-KYYFOBDT.js";import{a as S}from"./chunk-X6NFAZFH.js";import{a as C}from"./chunk-NR6WIMHC.js";import{a as D,b as w,c as I,d as M}from"./chunk-P3UOLO5N.js";import"./chunk-MGQU4BYR.js";import{a as y}from"./chunk-PIACHCSP.js";import{a as g}from"./chunk-J6P2CT7J.js";import"./chunk-GKZUPR7X.js";import{j as v}from"./chunk-APQUY7ND.js";import"./chunk-JS4ZJV2L.js";import{Ba as d,Oc as p,Vb as c,f as r,fc as l,gc as f,hc as u,v as h,wb as m,xa as t}from"./chunk-B762IU3Y.js";var F=r(D()),i=r(_()),H=r(P());var b=class n{constructor(){this.route=t(v),this.theme=t(g),this.fichaId=this.route.snapshot.paramMap.get("surveyId"),this.sesionId=this.route.snapshot.paramMap.get("sesionId"),this.fichaService=t(C),this.citaService=t(S),this.fichaResult=t(M),this.showCloseMg=!1}ngOnInit(){this.getFicha()}mergePaciente(o){this.citaService.getPacienteInfo(this.sesionId).subscribe(e=>{o.mergeData({nombres:e.data.nombres,diagnostico:e.data.diagnostico,apoderado:e.data.apoderado,fecha_nacimiento:e.data.fecha_nacimiento,edad:e.data.edad,personal:e.data.personal,telefono:e.data.telefono,colegio:e.data.colegio})})}getFicha(){this.fichaService.getById(this.fichaId).subscribe(o=>{this.survey=new F.Model(o.data.body),this.survey.locale="es",this.survey.applyTheme(this.theme.getThemeMode()==="dark"?i.DefaultDark:i.DefaultLight);let e="<h3>Ficha Completada!</h3>";this.survey.completedHtml=e,this.showCloseMg&&(e+='<a href="javascript:window.close();">Ya puede cerrar esta ventana</a>'),this.mergePaciente(this.survey),this.survey.onComplete.add((s,a)=>{a.showSaveInProgress(),this.fichaResult.create({id_sesion:this.sesionId,id_ficha:this.fichaId,body:JSON.stringify(s.data)}).subscribe({next:()=>{this.showCloseMg=!0,console.log(this.showCloseMg),a.showSaveSuccess("Ficha Guardada Correctamente!")},error:()=>{this.showCloseMg=!1,a.showSaveError()}})})})}ngAfterViewInit(){}static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275cmp=d({type:n,selectors:[["app-survey"]],standalone:!0,features:[p],decls:2,vars:1,consts:[[1,"ficha-container"],[3,"model"]],template:function(e,s){e&1&&(l(0,"div",0),u(1,"survey",1),f()),e&2&&(m(),c("model",s.survey))},dependencies:[I,w]})}};b=h([y()],b);export{b as SurveyComponent};
