import{a as x}from"./chunk-KIQKYD5B.js";import{a as pe}from"./chunk-DR7YQVCV.js";import{a as Ke}from"./chunk-QOPFTOZL.js";import{a as Qe}from"./chunk-UXZ2VA4W.js";import{a as $e}from"./chunk-QB37QMMN.js";import{a as We}from"./chunk-TS646TIG.js";import{c as W,d as H}from"./chunk-4FIJZXK5.js";import{a as He,b as Je}from"./chunk-TJFBSUUK.js";import{a as ae}from"./chunk-GT4JH6HJ.js";import{c as Ye,d as Ce,f as me,i as ye}from"./chunk-EBZKSOFQ.js";import{b as Ue}from"./chunk-7KNNJSCE.js";import"./chunk-FMZGRIZ6.js";import{o as k}from"./chunk-KLLKZ3UM.js";import{A as w,c as Q,d as m,e as V,f as B,i as je,k as A,l as re,n as Re,o as $,r as Y,v as oe,y as E,z as Ge}from"./chunk-MGQU4BYR.js";import{c as ze}from"./chunk-XKOQY6PJ.js";import{a as se}from"./chunk-U2EAJGNN.js";import{a as F}from"./chunk-RQ4VGEOD.js";import{a as T,b as N}from"./chunk-PIACHCSP.js";import{a as le}from"./chunk-J6P2CT7J.js";import"./chunk-GKZUPR7X.js";import"./chunk-APQUY7ND.js";import{m as ne,n as Oe,o as M,t as y,w as S}from"./chunk-JS4ZJV2L.js";import{Ba as q,Bc as G,C as _,Cc as U,D as we,Dc as z,Fc as o,Gc as te,Hc as qe,La as g,Ma as v,Mb as P,Oc as C,Qc as ie,S as ve,Ua as L,Vb as d,Vc as f,Wc as h,a as Z,b as ee,bc as De,dc as Le,ec as Ve,f as Ie,fc as r,gc as i,ha as Te,hc as l,ic as Be,jc as Ae,lc as R,n as D,qb as Ne,r as Me,uc as c,v as I,vc as J,w as O,wb as s,xa as p,xb as j,y as ge,yc as _e}from"./chunk-B762IU3Y.js";var de=Ie(Qe());var it=["datePicker"],nt=["endDatePicker"];function rt(u,t){u&1&&l(0,"span",42)}var ce=class Se{constructor(t){this.fb=t,this.modal=p(k),this.paqueteService=p(x),this.loadingService=p(F),this.terapiaService=p(pe),this.isLoading=this.loadingService.isLoading,this.terapiaid="",this.terapiasList=new D,this.onSaveComplete=new L,this.paqueteForm=this.fb.group({nombre:["",m.required],descripcion:[""],num_cambios:[null,[m.required,m.min(1)]],cantidadsesiones:["",[m.required,m.min(1)]],precioregular:["",[m.required,m.min(0),m.pattern("^[0-9]+(\\.[0-9]{1,2})?$")]],descuento:[0,[m.required,m.min(0),m.max(100),m.pattern("^[0-9]+(\\.[0-9]{1,2})?$")]],preciopaquete:["",[m.required,m.min(0),m.pattern("^[0-9]+(\\.[0-9]{1,2})?$")]],fechainicio:[""],fechafin:[""],terapias:[null,m.required],banner_url:[""]})}evtSelectFile(t){let e=t.target.files;this.paqueteForm.get("banner_url")?.setValue(e?.item(0))}ngOnInit(){this.loadTerapias(),this.paqueteForm.get("precioregular")?.valueChanges.subscribe(()=>this.calculatePreciopaquete()),this.paqueteForm.get("descuento")?.valueChanges.subscribe(()=>this.calculatePreciopaquete()),this.paqueteForm.get("fechainicio")?.valueChanges.subscribe(()=>{this.paqueteForm.get("fechafin")?.value<this.paqueteForm.get("fechainicio")?.value&&this.paqueteForm.get("fechafin")?.setValue(this.paqueteForm.get("fechainicio")?.value)})}loadTerapias(){this.terapiasList=this.terapiaService.getAll().pipe(_(t=>t.data),N(this))}ngAfterViewInit(){let t=new Date;this.datePicker&&this.datePicker.nativeElement&&ae(this.datePicker.nativeElement,{locale:de.Spanish,altFormat:"d/m/Y",altInput:!0,minDate:t,onChange:e=>{let n=e[0];if(this.endDatePicker&&this.endDatePicker.nativeElement){let a=ae(this.endDatePicker.nativeElement,{locale:de.Spanish,altFormat:"d/m/Y",altInput:!0,minDate:n});this.paqueteForm.get("fechafin")?.value<n&&(this.paqueteForm.get("fechafin")?.setValue(n),a.setDate(n))}}}),this.endDatePicker&&this.endDatePicker.nativeElement&&ae(this.endDatePicker.nativeElement,{locale:de.Spanish,altInput:!0,altFormat:"d/m/Y",minDate:t})}close(){this.modal.dismissAll()}save(){let t=new FormData;Object.keys(this.paqueteForm.value).forEach(e=>{let n=this.paqueteForm.get(e);Array.isArray(n?.value)?t.append(e,JSON.stringify(n?.value)):t.append(e,n?.value)}),this.paqueteService.create(t).subscribe({next:()=>{this.modal.dismissAll(),this.onSaveComplete.emit()},error:e=>{console.log(e)}})}calculatePreciopaquete(){let t=this.paqueteForm.get("precioregular")?.value,e=this.paqueteForm.get("descuento")?.value;if(t&&e!=null){let n=e/100,a=t-t*n;this.paqueteForm.get("preciopaquete")?.setValue(a.toFixed(2),{emitEvent:!1})}}static{this.\u0275fac=function(e){return new(e||Se)(j(E))}}static{this.\u0275cmp=q({type:Se,selectors:[["app-crear-modal"]],viewQuery:function(e,n){if(e&1&&(G(it,5),G(nt,5)),e&2){let a;U(a=z())&&(n.datePicker=a.first),U(a=z())&&(n.endDatePicker=a.first)}},inputs:{terapiaid:"terapiaid"},outputs:{onSaveComplete:"onSaveComplete"},standalone:!0,features:[C],decls:72,vars:14,consts:[["datePicker",""],["endDatePicker",""],[1,"modal-header"],["id","modal-basic-title",1,"modal-title","d-flex","align-items-center","gap-1"],[1,"text-primary"],[1,"ki-duotone","ki-add-files","text-gray-900","fs-1",2,"vertical-align","text-top"],[1,"path1"],[1,"path2"],[1,"path3"],["type","button","aria-label","Close",1,"btn","btn-sm","btn-icon","btn-active-color-primary","btn-color-gray-800",3,"click"],[1,"ki-duotone","ki-cross-square","fs-1"],[1,"modal-body"],[1,"form","d-flex","flex-column","gap-4",3,"formGroup"],[1,"form-group"],["for","nombre",1,"required","form-label"],["type","text","id","nombre","formControlName","nombre","placeholder","Ingresa Nombre del Paquete",1,"form-control"],["for","",1,"required","form-label"],["type","file","id","imagen","accept","image/*",1,"form-control",3,"change"],["for","descripcion",1,"form-label"],["cols","3","rows","2","id","descripcion","formControlName","descripcion","placeholder","Ingresa Descripci\xF3n del Paquete",1,"form-control"],["for","terapias",1,"required","form-label"],["bindValue","id_terapia","bindLabel","nombre","formControlName","terapias","placeholder","Seleccionar","bindLabel","nombre",3,"items","multiple","closeOnSelect","hideSelected","loadingText"],[1,"row"],[1,"form-group","col-4"],["for","cantidadsesiones",1,"required","form-label"],["type","number","id","cantidadsesiones","formControlName","cantidadsesiones","min","1","placeholder","Nro de Sesiones",1,"form-control"],["type","number","id","num_cambios","formControlName","num_cambios","min","1","placeholder","Nro de Cambios",1,"form-control"],["for","precioregular",1,"required","form-label"],["type","number","id","precioregular","formControlName","precioregular","min","0","step","0.01","placeholder","Ingresar Precio",1,"form-control"],[1,"form-group","col-6"],["for","descuento",1,"required","form-label"],["type","number","id","descuento","formControlName","descuento","min","0","step","0.01","placeholder","Ingresar Descuento %",1,"form-control"],["for","preciopaquete",1,"required","form-label"],["type","number","id","preciopaquete","formControlName","preciopaquete","min","0","step","0.01","placeholder","Precio Total",1,"form-control"],["for","fechainicio",1,"form-label"],["type","text","id","kt_calendar_datepicker_date","formControlName","fechainicio","placeholder","Seleccionar Fecha",1,"form-control"],["for","fechafin",1,"form-label"],["type","text","id","kt_calendar_datepicker_end_date","formControlName","fechafin","placeholder","Seleccionar Fecha",1,"form-control"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["class","spinner-border spinner-border-sm align-middle ms-2",4,"ngIf"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"]],template:function(e,n){if(e&1){let a=R();r(0,"div",2)(1,"h4",3)(2,"span",4)(3,"i",5),l(4,"span",6)(5,"span",7)(6,"span",8),i()(),o(7," A\xF1adir Paquete "),i(),r(8,"button",9),c("click",function(){return g(a),v(n.close())}),r(9,"i",10),l(10,"span",6)(11,"span",7),i()()(),r(12,"div",11)(13,"form",12)(14,"div",13)(15,"label",14),o(16,"Nombre del Paquete"),i(),l(17,"input",15),i(),r(18,"div",13)(19,"label",16),o(20,"Imagen"),i(),r(21,"input",17),c("change",function(be){return g(a),v(n.evtSelectFile(be))}),i()(),r(22,"div",13)(23,"label",18),o(24,"Descripci\xF3n"),i(),l(25,"textarea",19),i(),r(26,"div",13)(27,"label",20),o(28,"Seleccionar Terapia(s) Incluidas"),i(),l(29,"ng-select",21),f(30,"async"),i(),r(31,"div",22)(32,"div",23)(33,"label",24),o(34,"Nro de Sesiones"),i(),l(35,"input",25),i(),r(36,"div",23)(37,"label",24),o(38,"Nro de Cambios"),i(),l(39,"input",26),i(),r(40,"div",23)(41,"label",27),o(42,"Precio Regular"),i(),l(43,"input",28),i()(),r(44,"div",22)(45,"div",29)(46,"label",30),o(47,"Descuento %"),i(),l(48,"input",31),i(),r(49,"div",29)(50,"label",32),o(51,"Precio del Paquete"),i(),l(52,"input",33),i()(),r(53,"div",22)(54,"div",29)(55,"label",34),o(56,"Fecha de Inicio"),i(),l(57,"input",35,0),i(),r(59,"div",29)(60,"label",36),o(61,"Fecha de Fin"),i(),l(62,"input",37,1),i()()()(),r(64,"div",38)(65,"button",39),c("click",function(){return g(a),v(n.close())}),o(66," Cancelar "),i(),r(67,"button",40),f(68,"async"),c("click",function(){return g(a),v(n.save())}),o(69," Guardar "),P(70,rt,1,0,"span",41),f(71,"async"),i()()}e&2&&(s(13),d("formGroup",n.paqueteForm),s(16),d("items",h(30,8,n.terapiasList))("multiple",!0)("closeOnSelect",!1)("hideSelected",!0)("loadingText","Cargando.."),s(38),d("disabled",n.paqueteForm.invalid||h(68,10,n.isLoading)),s(3),d("ngIf",h(71,12,n.isLoading)))},dependencies:[w,A,Q,re,V,B,oe,$,Y,S,M,y,H,W]})}};ce=I([T({checkProperties:!0}),O("design:paramtypes",[E])],ce);function ot(u,t){u&1&&l(0,"span",13)}var Ze=(()=>{class u{constructor(){this.modal=p(k),this.paqueteService=p(x),this.isLoading=p(F).isLoading,this.paqueteId="",this.onSaveComplete=new L}close(){this.modal.dismissAll()}delete(){let e=typeof this.paqueteId=="string"?this.paqueteId:this.paqueteId.id_paquetes;e?this.paqueteService.delete(e).subscribe({next:()=>{this.onSaveComplete.emit(),this.modal.dismissAll()},error:n=>{console.error("Error al eliminar paquete:",n)}}):console.error("ID del paquete no proporcionado o en formato incorrecto")}static{this.\u0275fac=function(n){return new(n||u)}}static{this.\u0275cmp=q({type:u,selectors:[["app-borrar-modal"]],inputs:{paqueteId:"paqueteId"},outputs:{onSaveComplete:"onSaveComplete"},standalone:!0,features:[C],decls:25,vars:6,consts:[[1,"modal-header"],["id","modal-basic-title",1,"modal-title","d-flex","align-items-center","gap-1"],[1,"ki-duotone","ki-information","text-danger","fs-2hx",2,"vertical-align","middle"],[1,"path1"],[1,"path2"],[1,"path3"],["type","button","aria-label","Close",1,"btn","btn-sm","btn-icon","btn-active-color-primary","btn-color-gray-800",3,"click"],[1,"ki-duotone","ki-cross-square","fs-1"],[1,"modal-body","text-center"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-danger",3,"click","disabled"],["class","spinner-border spinner-border-sm align-middle ms-2",4,"ngIf"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"]],template:function(n,a){n&1&&(r(0,"div",0)(1,"h4",1)(2,"span")(3,"i",2),l(4,"span",3)(5,"span",4)(6,"span",5),i()(),o(7," Eliminar Paquete "),i(),r(8,"button",6),c("click",function(){return a.close()}),r(9,"i",7),l(10,"span",3)(11,"span",4),i()()(),r(12,"div",8)(13,"p"),o(14,"\xBFEst\xE1s seguro de eliminar este registro de paquete?"),i(),r(15,"p"),o(16,"Toda la informaci\xF3n relacionada con este paquete se perder\xE1."),i()(),r(17,"div",9)(18,"button",10),c("click",function(){return a.close()}),o(19," Cancelar "),i(),r(20,"button",11),f(21,"async"),c("click",function(){return a.delete()}),o(22," Eliminar "),P(23,ot,1,0,"span",12),f(24,"async"),i()()),n&2&&(s(20),d("disabled",h(21,2,a.isLoading)),s(3),d("ngIf",h(24,4,a.isLoading)))},dependencies:[w,S,M,y]})}}return u})();var et=Ie(Qe());var at=["datePicker"],lt=["endDatePicker"];function st(u,t){u&1&&l(0,"span",40)}var ue=class ke{constructor(t){this.fb=t,this.modal=p(k),this.paqueteService=p(x),this.terapiaService=p(pe),this.isLoading=p(F).isLoading,this.paqueteId="",this.es=et.default.es,this.terapiasList=new D,this.onSaveComplete=new L,this.paqueteForm=this.fb.group({nombre:["",m.required],descripcion:[""],num_cambios:[null,[m.required,m.min(1)]],cantidadsesiones:[0,[m.required,m.min(1)]],precioregular:[0,[m.required,m.min(0)]],descuento:[0,[m.required,m.min(0)]],preciopaquete:[0,[m.required,m.min(0)]],fechainicio:[""],fechafin:[""],terapias:[null,m.required],sesionesrestantes:[0,[m.required,m.min(0)]],banner_url:[""]})}ngOnInit(){this.loadTerapias(),typeof this.paqueteId=="string"?this.loadPaqueteData():typeof this.paqueteId=="object"&&this.paqueteId.id_paquetes?this.loadPaqueteData(this.paqueteId.id_paquetes):console.error("ID del paquete no proporcionado o no es una cadena",this.paqueteId),this.paqueteForm.get("precioregular")?.valueChanges.subscribe(()=>this.calculatePreciopaquete()),this.paqueteForm.get("descuento")?.valueChanges.subscribe(()=>this.calculatePreciopaquete()),this.paqueteForm.get("fechainicio")?.valueChanges.subscribe(()=>{this.paqueteForm.get("fechafin")?.value<this.paqueteForm.get("fechainicio")?.value&&this.paqueteForm.get("fechafin")?.setValue(this.paqueteForm.get("fechainicio")?.value)})}loadTerapias(){this.terapiasList=this.terapiaService.getAll().pipe(_(t=>t.data),N(this))}close(){this.modal.dismissAll()}save(){if(this.paqueteForm.valid){let t=new FormData;t.append("nombre",this.paqueteForm.get("nombre")?.value||""),t.append("descripcion",this.paqueteForm.get("descripcion")?.value||""),t.append("cantidadsesiones",this.paqueteForm.get("cantidadsesiones")?.value||""),t.append("num_cambios",this.paqueteForm.get("num_cambios")?.value||""),t.append("precioregular",this.paqueteForm.get("precioregular")?.value||""),t.append("descuento",this.paqueteForm.get("descuento")?.value||""),t.append("preciopaquete",this.paqueteForm.get("preciopaquete")?.value||""),t.append("fechainicio",this.paqueteForm.get("fechainicio")?.value||""),t.append("fechafin",this.paqueteForm.get("fechafin")?.value||""),t.append("terapias",JSON.stringify(this.paqueteForm.get("terapias")?.value)||"[]"),t.append("sesionesrestantes",this.paqueteForm.get("sesionesrestantes")?.value||"");let e=this.paqueteForm.get("banner_url")?.value;e&&t.append("banner_url",e);let n=typeof this.paqueteId=="string"?this.paqueteId:this.paqueteId.id_paquetes;n&&this.paqueteService.update(n,t).subscribe({next:()=>{this.onSaveComplete.emit(),this.modal.dismissAll()},error:a=>{console.error("Error al actualizar paquete:",a.message),alert("No se pudo actualizar el paquete. Intenta nuevamente.")}})}}loadPaqueteData(t){let e=t||(typeof this.paqueteId=="object"?this.paqueteId.id_paquetes:this.paqueteId);e?this.paqueteService.getById(e).subscribe({next:n=>{this.paqueteForm.patchValue(ee(Z({},n.data),{terapias:n.data.terapias.map(a=>a.id_terapia)}))},error:n=>{console.error("Error al cargar datos del paquete:",n)}}):console.error("ID del paquete no proporcionado")}calculatePreciopaquete(){let t=this.paqueteForm.get("precioregular")?.value,e=this.paqueteForm.get("descuento")?.value;if(t&&e!=null){let n=e/100,a=t-t*n;this.paqueteForm.get("preciopaquete")?.setValue(a,{emitEvent:!1})}}evtSelectFile(t){let e=t.target.files?.[0];e&&this.paqueteForm.get("banner_url")?.setValue(e)}static{this.\u0275fac=function(e){return new(e||ke)(j(E))}}static{this.\u0275cmp=q({type:ke,selectors:[["app-editar-modal"]],viewQuery:function(e,n){if(e&1&&(G(at,5),G(lt,5)),e&2){let a;U(a=z())&&(n.datePicker=a.first),U(a=z())&&(n.endDatePicker=a.first)}},inputs:{paqueteId:"paqueteId"},outputs:{onSaveComplete:"onSaveComplete"},standalone:!0,features:[C],decls:71,vars:22,consts:[["datePicker",""],["endDatePicker",""],[1,"modal-header"],["id","modal-basic-title",1,"modal-title","d-flex","align-items-center","gap-1"],[1,"ki-duotone","ki-notepad-edit","text-gray-900","fs-1",2,"vertical-align","top"],[1,"path1"],[1,"path2"],["type","button","aria-label","Close",1,"btn","btn-sm","btn-icon","btn-active-color-primary","btn-color-gray-800",3,"click"],[1,"ki-duotone","ki-cross-square","fs-1"],[1,"modal-body"],[1,"form","d-flex","flex-column","gap-4",3,"formGroup"],[1,"form-group"],["for","nombre",1,"required","form-label"],["type","text","id","nombre","formControlName","nombre",1,"form-control"],["for","imagen",1,"required","form-label"],["type","file","id","imagen","accept","image/*",1,"form-control",3,"change"],["for","descripcion",1,"required","form-label"],["rows","2","id","descripcion","formControlName","descripcion",1,"form-control"],["for","terapias",1,"required","form-label"],["bindValue","id_terapia","bindLabel","nombre","formControlName","terapias","placeholder","Seleccionar","bindLabel","nombre",3,"items","multiple","closeOnSelect","hideSelected","loadingText"],[1,"row"],[1,"form-group","col-4"],["for","cantidadsesiones",1,"required","form-label"],["type","number","id","cantidadsesiones","formControlName","cantidadsesiones","min","1","placeholder","Nro de Sesiones",1,"form-control"],["type","number","id","num_cambios","formControlName","num_cambios","min","1","placeholder","Nro de Cambios",1,"form-control"],["for","precioregular",1,"required","form-label"],["type","number","id","precioregular","formControlName","precioregular","min","0","step","0.01","placeholder","Ingresar Precio",1,"form-control"],[1,"form-group","col-6"],["for","descuento",1,"required","form-label"],["type","number","id","descuento","formControlName","descuento","min","0","step","0.01",1,"form-control"],["for","preciopaquete",1,"required","form-label"],["type","number","id","preciopaquete","formControlName","preciopaquete","min","0","step","0.01",1,"form-control"],["for","fechainicio",1,"form-label"],["id","kt_calendar_datepicker_date","mwlFlatpickr","","formControlName","fechainicio","placeholder","Seleccionar Fecha",1,"form-control",3,"locale","altInput","altFormat","monthSelectorType"],["for","fechafin",1,"form-label"],["id","kt_calendar_datepicker_end_date","formControlName","fechafin","mwlFlatpickr","","placeholder","Seleccionar Fecha",1,"form-control",3,"locale","altInput","altFormat","monthSelectorType"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["class","spinner-border spinner-border-sm align-middle ms-2",4,"ngIf"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"]],template:function(e,n){if(e&1){let a=R();r(0,"div",2)(1,"h4",3)(2,"span")(3,"i",4),l(4,"span",5)(5,"span",6),i()(),o(6," Editar Paquete "),i(),r(7,"button",7),c("click",function(){return g(a),v(n.close())}),r(8,"i",8),l(9,"span",5)(10,"span",6),i()()(),r(11,"div",9)(12,"form",10)(13,"div",11)(14,"label",12),o(15,"Nombre del Paquete"),i(),l(16,"input",13),i(),r(17,"div",11)(18,"label",14),o(19,"Imagen"),i(),r(20,"input",15),c("change",function(be){return g(a),v(n.evtSelectFile(be))}),i()(),r(21,"div",11)(22,"label",16),o(23,"Descripci\xF3n"),i(),l(24,"textarea",17),i(),r(25,"div",11)(26,"label",18),o(27,"Seleccionar Terapia(s) Incluidas"),i(),l(28,"ng-select",19),f(29,"async"),i(),r(30,"div",20)(31,"div",21)(32,"label",22),o(33,"Nro de Sesiones"),i(),l(34,"input",23),i(),r(35,"div",21)(36,"label",22),o(37,"Nro de Cambios"),i(),l(38,"input",24),i(),r(39,"div",21)(40,"label",25),o(41,"Precio Regular"),i(),l(42,"input",26),i()(),r(43,"div",20)(44,"div",27)(45,"label",28),o(46,"Descuento %"),i(),l(47,"input",29),i(),r(48,"div",27)(49,"label",30),o(50,"Precio del Paquete"),i(),l(51,"input",31),i()(),r(52,"div",20)(53,"div",27)(54,"label",32),o(55,"Fecha de Inicio"),i(),l(56,"input",33,0),i(),r(58,"div",27)(59,"label",34),o(60,"Fecha de Fin"),i(),l(61,"input",35,1),i()()()(),r(63,"div",36)(64,"button",37),c("click",function(){return g(a),v(n.close())}),o(65," Cancelar "),i(),r(66,"button",38),f(67,"async"),c("click",function(){return g(a),v(n.save())}),o(68," Guardar "),P(69,st,1,0,"span",39),f(70,"async"),i()()}e&2&&(s(12),d("formGroup",n.paqueteForm),s(16),d("items",h(29,16,n.terapiasList))("multiple",!0)("closeOnSelect",!1)("hideSelected",!0)("loadingText","Cargando.."),s(28),d("locale",n.es)("altInput",!0)("altFormat","d/m/Y")("monthSelectorType","dropdown"),s(5),d("locale",n.es)("altInput",!0)("altFormat","d/m/Y")("monthSelectorType","dropdown"),s(5),d("disabled",n.paqueteForm.invalid||h(67,18,n.isLoading)),s(3),d("ngIf",h(70,20,n.isLoading)))},dependencies:[w,A,Q,re,V,B,oe,$,Y,S,M,y,Je,He,H,W]})}};ue=I([T({checkProperties:!0}),O("design:paramtypes",[E])],ue);function mt(u,t){u&1&&l(0,"span",19)}var fe=class Fe{constructor(t){this.fb=t,this.modal=p(k),this.paqueteService=p(x),this.usuarioService=p($e),this.toast=p(We),this.pacienteService=p(Ke),this.isLoading=p(F).isLoading,this.metodosPago=["Efectivo","Yape","BCP","Interbank","BBVA","Transferencia"],this.paqueteId=null,this.onSaveComplete=new L,this.usuariosList=new D,this.pacientesList=new D,this.form=this.fb.group({usuarioId:[null,m.required],pacienteId:[null,m.required],metodo_pago:[null,m.required]})}ngOnInit(){this.fetchUsuarios(),this.loadPaqueteData()}fetchUsuarios(){this.usuariosList=this.usuarioService.getUsersWithPacientes().pipe(N(this),_(t=>t.data||[]),ve(t=>(console.error("Error al buscar usuarios:",t),ge([]))))}loadPaqueteData(){let t;this.paqueteId&&(typeof this.paqueteId=="string"?t=this.paqueteId:typeof this.paqueteId=="object"&&this.paqueteId.id_paquetes&&(t=this.paqueteId.id_paquetes)),t?this.paqueteService.getById(t).subscribe({next:e=>{console.log("Paquete cargado:",e)},error:e=>{console.error("Error al cargar datos del paquete:",e)}}):console.error("ID del paquete no proporcionado")}onChangeUser(t){this.form.get("pacienteId")?.reset(),this.loadPacientesByUser(t.id)}onPacienteSelect(t){}loadPacientesByUser(t){this.pacientesList=this.pacienteService.getAll().pipe(_(e=>e.data.filter(n=>n.id===t)),ve(e=>(console.error("Error al cargar pacientes:",e),ge([]))))}compareUsers(t,e){return t&&e?t.id===e.id:t===e}close(){this.modal.dismissAll()}purchase(){this.form.valid&&this.paqueteService.purchase(ee(Z({},this.form.value),{paqueteId:this.paqueteId})).subscribe({next:()=>{this.onSaveComplete.emit(),this.modal.dismissAll()},error:t=>{if(t.error.errors){let e=Object.values(t.error.errors).join(`
`);this.toast.error(e,"Error")}else this.toast.error("Ocurri\xF3 un error","Error ")}})}static{this.\u0275fac=function(e){return new(e||Fe)(j(E))}}static{this.\u0275cmp=q({type:Fe,selectors:[["app-comprar-modal"]],inputs:{paqueteId:"paqueteId"},outputs:{onSaveComplete:"onSaveComplete"},standalone:!0,features:[C],decls:36,vars:25,consts:[[1,"modal-header"],["id","modal-basic-title",1,"modal-title","d-flex","align-items-center","gap-1"],[1,"ki-duotone","ki-handcart","me-2","fs-1",2,"vertical-align","middle"],[1,"path1"],[1,"path2"],[1,"path3"],["type","button","aria-label","Close",1,"btn","btn-sm","btn-icon","btn-active-color-primary","btn-color-gray-800",3,"click"],[1,"ki-duotone","ki-cross-square","fs-1"],[1,"modal-body","text-center"],[3,"formGroup"],[1,"col-mb-4","mb-3"],["bindLabel","name","bindValue","id","placeholder","Selecciona un usuario","formControlName","usuarioId",3,"change","items","loading","loadingText","notFoundText","compareWith"],["formControlName","pacienteId","bindLabel","nombre","bindValue","id_paciente","placeholder","Selecciona un paciente",3,"change","items","loading","loadingText","notFoundText"],[1,"col","mb-3"],["placeholder","M\xE9todo de Pago","formControlName","metodo_pago",3,"items"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["class","spinner-border spinner-border-sm align-middle ms-2",4,"ngIf"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"]],template:function(e,n){e&1&&(r(0,"div",0)(1,"h4",1)(2,"span")(3,"i",2),l(4,"span",3)(5,"span",4)(6,"span",5),i()(),o(7," Adquirir Paquete "),i(),r(8,"button",6),c("click",function(){return n.close()}),r(9,"i",7),l(10,"span",3)(11,"span",4),i()()(),r(12,"div",8)(13,"p"),o(14,"\xBFEst\xE1s seguro de comprar este Paquete?"),i(),r(15,"p"),o(16,"Selecciona el usuario y luego el paciente que desees para continuar con la compra."),i(),r(17,"form",9)(18,"div",10)(19,"ng-select",11),f(20,"async"),f(21,"async"),c("change",function(b){return n.onChangeUser(b)}),i()(),r(22,"div",10)(23,"ng-select",12),f(24,"async"),f(25,"async"),c("change",function(b){return n.onPacienteSelect(b)}),i()(),r(26,"div",13),l(27,"ng-select",14),i()()(),r(28,"div",15)(29,"button",16),c("click",function(){return n.close()}),o(30," Cancelar "),i(),r(31,"button",17),f(32,"async"),c("click",function(){return n.purchase()}),o(33," Comprar "),P(34,mt,1,0,"span",18),f(35,"async"),i()()),e&2&&(s(17),d("formGroup",n.form),s(2),d("items",h(20,13,n.usuariosList))("loading",h(21,15,n.isLoading))("loadingText","Cargando..")("notFoundText","Sin resultados")("compareWith",n.compareUsers),s(4),d("items",h(24,17,n.pacientesList))("loading",h(25,19,n.isLoading))("loadingText","Cargando..")("notFoundText","Sin resultados"),s(4),d("items",n.metodosPago),s(4),d("disabled",n.form.invalid||h(32,21,n.isLoading)),s(3),d("ngIf",h(35,23,n.isLoading)))},dependencies:[w,A,V,B,$,Y,Ge,S,M,y,H,W]})}};fe=I([T({checkProperties:!0}),O("design:paramtypes",[E])],fe);var pt=u=>[u],he=class xe{constructor(){this.paqueteService=p(x),this.isLoading=p(F).isLoading,this.theme=p(le),this.modal=p(k),this.localeText=se,this.listPacientes=new D,this.colDefs=[{field:"paciente.nombre",headerName:"Paciente",cellClass:"fw-bold",filter:!0},{field:"paquete.nombre",headerName:"Paquete"},{field:"num_sesiones",headerName:"Sesiones Restantes"}]}ngOnInit(){this.getLista()}getLista(){this.listPacientes=this.paqueteService.getListPacientes().pipe(_(t=>t.data),N(this))}close(){this.modal.dismissAll()}static{this.\u0275fac=function(e){return new(e||xe)}}static{this.\u0275cmp=q({type:xe,selectors:[["app-pacientes-lista"]],standalone:!0,features:[C],decls:18,vars:12,consts:[[1,"modal-body"],[1,"d-flex","py-4","justify-content-between","align-items-center"],[1,"d-flex","align-items-center","gap-3"],["type","button",1,"btn","btn-sm","btn-light-primary",3,"click"],[1,"d-flex","align-items-center"],[1,"fa-solid","fa-rotate-right"],[1,"ms-2"],["type","button","aria-label","Close",1,"btn","btn-sm","btn-icon","btn-active-color-primary","btn-color-gray-800",3,"click"],[1,"ki-duotone","ki-cross-square","fs-1"],[1,"path1"],[1,"path2"],["id","myGrid",2,"height","calc(100dvh - 281px)",3,"ngClass"],[2,"width","100%","height","100%",3,"localeText","pagination","loading","rowData","columnDefs"]],template:function(e,n){e&1&&(r(0,"div",0)(1,"div",1)(2,"h3"),o(3,"Pacientes con Paquetes"),i(),r(4,"div",2)(5,"button",3),c("click",function(){return n.getLista()}),r(6,"span",4),l(7,"span",5),r(8,"span",6),o(9,"Actualizar"),i()()(),r(10,"button",7),c("click",function(){return n.close()}),r(11,"i",8),l(12,"span",9)(13,"span",10),i()()()(),r(14,"div",11),l(15,"ag-grid-angular",12),f(16,"async"),f(17,"async"),i()()),e&2&&(s(14),d("ngClass",ie(10,pt,n.theme.getThemeMode()==="light"?"ag-theme-quartz":"ag-theme-quartz-dark")),s(),d("localeText",n.localeText)("pagination",!0)("loading",h(16,6,n.isLoading))("rowData",h(17,8,n.listPacientes))("columnDefs",n.colDefs))},dependencies:[S,ne,y,ze]})}};he=I([T({checkProperties:!0})],he);var dt=u=>({"img-inventory":u});function ct(u,t){u&1&&(r(0,"div",24)(1,"div",25)(2,"span",26),o(3,"Cargando..."),i()()())}function ut(u,t){if(u&1&&(r(0,"span",42),o(1),i()),u&2){let e=t.$implicit;s(),te(e.nombre)}}function ft(u,t){if(u&1){let e=R();r(0,"div",27)(1,"div",28)(2,"div",29)(3,"div",30)(4,"button",31),c("click",function(){let a=g(e).$implicit,b=J();return v(b.openEditarModal(a))}),l(5,"span",32),i(),r(6,"button",33),c("click",function(){let a=g(e).$implicit,b=J();return v(b.openBorrarModal(a))}),l(7,"span",34),i()(),r(8,"div",35),l(9,"img",36),i()(),r(10,"div",37)(11,"h5",38),o(12),i(),r(13,"div",39)(14,"span",40)(15,"strong"),o(16,"Terapias:"),i()(),r(17,"div",41),Le(18,ut,2,1,"span",42,De),i()(),r(20,"p",40)(21,"strong"),o(22,"N\xB0 de Sesiones:"),i(),o(23),i(),r(24,"p",40),o(25),i(),r(26,"div",43)(27,"span",44)(28,"strong"),o(29),i()(),r(30,"button",45),c("click",function(){let a=g(e).$implicit,b=J();return v(b.openComprarModal(a))}),l(31,"span",46),o(32," Vender "),i()()()()()}if(u&2){let e=t.$implicit,n=J();d("@paquetesListAnimation",void 0),s(9),_e("src",e.banner_url!=null&&e.banner_url.includes("default.png")?n.banner_url:e.banner_url,Ne),_e("alt",e.nombre),d("ngClass",ie(8,dt,e.banner_url==null?null:e.banner_url.includes("default.png"))),s(3),te(e.nombre),s(6),Ve(e.terapias),s(5),qe(" ",e.cantidadsesiones,""),s(2),te(e.descripcion),s(4),qe("S/",e.preciopaquete,"")}}var tt=class Pe{constructor(){this.paquetesService=p(x),this.isLoading=p(F).isLoading,this.theme=p(le),this.modal=p(k),this.banner_url="https://cdn-icons-png.flaticon.com/512/9573/9573235.png",this.localeText=se,this.searchControl=new je(""),this.paquetesSubject=new Me([]),this.paquetesList=we([this.paquetesSubject.asObservable(),this.searchControl.valueChanges.pipe(Te(this.searchControl.value))]).pipe(_(([t,e])=>e?t.filter(n=>n.nombre.toLowerCase().includes(e.toLowerCase())):t))}ngOnInit(){this.loadTabla()}trackByFn(t,e){return e.id_paquetes}openPacientesTable(){this.modal.open(he,{centered:!0,size:"lg"})}loadTabla(){this.paquetesService.getAll().pipe(_(t=>t.data),N(this)).subscribe(t=>{this.paquetesSubject.next(t)})}openCrearModal(){this.modal.open(ce,{size:"350px",animation:!0,centered:!0}).componentInstance.onSaveComplete.subscribe(()=>{this.loadTabla()})}getTerapiasNombres(t){return t.map(e=>e.nombre).join(", ")}openEditarModal(t){let e=this.modal.open(ue);e.componentInstance.paqueteId=t.id_paquetes,e.componentInstance.onSaveComplete.subscribe(()=>{this.loadTabla()})}openBorrarModal(t){if(!t.id_paquetes)return;let e=this.modal.open(Ze,{size:"300px",animation:!0,centered:!0});e.componentInstance.paqueteId=t.id_paquetes,e.componentInstance.onSaveComplete.subscribe(()=>{this.loadTabla()})}openComprarModal(t){let e=this.modal.open(fe,{size:"300px",animation:!0,centered:!0});e.componentInstance.paqueteId=t.id_paquetes}ngOnDestroy(){}static{this.\u0275fac=function(e){return new(e||Pe)}}static{this.\u0275cmp=q({type:Pe,selectors:[["app-paquetes"]],standalone:!0,features:[C],decls:33,vars:8,consts:[["header-title",""],[1,"d-flex","flex-column","text-gray-900","fw-bold","my-1"],[2,"color","white"],[1,"content","d-flex","flex-column","flex-column-fluid"],[1,"container-xxl"],[1,"d-flex","flex-wrap","gap-3","py-4","justify-content-between","align-items-center"],["data-kt-search-element","form","autocomplete","off",1,"position-relative","flex-grow-1","flex-md-grow-0"],[1,"ki-duotone","ki-magnifier","fs-2","search-icon","position-absolute","top-50","translate-middle-y","ms-4"],[1,"path1"],[1,"path2"],["type","search","id","paquete-search","name","search","placeholder","B\xFAsqueda","data-kt-search-element","input",1,"form-control","custom-form-control","ps-13",3,"formControl"],[1,"d-flex","align-items-center","gap-3"],["type","button",1,"btn","btn-light-primary",3,"click"],[1,"d-flex","align-items-center"],[1,"fa-solid","fa-rotate-right"],[1,"ms-2"],[1,"btn","btn-secondary",3,"click"],[1,"ki-solid","ki-abstract-28","fs-4"],["type","button",1,"btn","btn-primary",3,"click"],[1,"ki-solid","ki-plus","text-white","fs-1"],[1,"text-white","ms-2"],["class","loading-container d-flex justify-content-center align-items-center",4,"ngIf"],[1,"row","my-4","justify-content-center"],["class","col-md-4",4,"ngFor","ngForOf","ngForTrackBy"],[1,"loading-container","d-flex","justify-content-center","align-items-center"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"col-md-4"],[1,"paquete-item","card","border-1","border-gray-300","mb-4",2,"transition","all cubic-bezier(0.165, 0.84, 0.44, 1) 0.5s"],[1,"position-relative"],[1,"action-buttons",2,"position","absolute","top","0.445rem","right","10px","z-index","1"],["type","button",1,"btn","btn-icon","btn-sm","bg-success",2,"margin-right","5px",3,"click"],[1,"ki-solid","ki-pencil","text-white"],["type","button",1,"btn","btn-icon","btn-sm","btn-danger",3,"click"],[1,"ki-solid","ki-trash","text-white"],[1,"image-container",2,"border-radius","8px","overflow","hidden"],[1,"card-img-top",2,"width","100%","height","auto",3,"src","ngClass","alt"],[1,"card-body"],[1,"card-title","fs-2"],[1,"d-flex","flex-column","my-4","gap-2"],[1,"card-text"],[1,"d-flex","gap-3","flex-wrap"],[1,"badge","bg-secondary"],[1,"d-flex","justify-content-between","align-items-center"],[1,"card-text","fs-2"],["type","button",1,"btn","btn-primary","btn-sm","d-flex","justify-content-center","align-items-center",3,"click"],[1,"ki-duotone","ki-handcart","text-white","me-2"]],template:function(e,n){e&1&&(r(0,"app-header"),Be(1,0),r(2,"h1",1)(3,"span",2),o(4,"Paquetes"),i()(),Ae(),i(),r(5,"div",3)(6,"div",4)(7,"div",5)(8,"form",6)(9,"i",7),l(10,"span",8)(11,"span",9),i(),l(12,"input",10),i(),r(13,"div",11)(14,"button",12),c("click",function(){return n.loadTabla()}),r(15,"span",13),l(16,"span",14),r(17,"span",15),o(18,"Actualizar"),i()()(),r(19,"button",16),c("click",function(){return n.openPacientesTable()}),l(20,"span",17),r(21,"span",15),o(22,"Pacientes"),i()(),r(23,"button",18),c("click",function(){return n.openCrearModal()}),r(24,"span",13),l(25,"span",19),r(26,"span",20),o(27,"A\xF1adir"),i()()()()(),P(28,ct,4,0,"div",21),f(29,"async"),r(30,"div",22),P(31,ft,33,10,"div",23),f(32,"async"),i()()()),e&2&&(s(12),d("formControl",n.searchControl),s(16),d("ngIf",h(29,4,n.isLoading)),s(3),d("ngForOf",h(32,6,n.paquetesList))("ngForTrackBy",n.trackByFn))},dependencies:[S,ne,Oe,M,y,Ue,w,A,Q,V,B,Re],data:{animation:[Ye("paquetesListAnimation",[ye(":enter",[me({opacity:0,scale:.9}),Ce("300ms",me({opacity:1,scale:1}))]),ye(":leave",[Ce("200ms",me({opacity:0,scale:.9}))])])]}})}};tt=I([T()],tt);export{tt as PaquetesComponent};
