import{a as P,b as j}from"./chunk-MG6ACQDW.js";import{a as F}from"./chunk-X6NFAZFH.js";import{a as M}from"./chunk-NR6WIMHC.js";import{a as L,b as E,c as R,d as D}from"./chunk-QXJCGNJL.js";import"./chunk-MGQU4BYR.js";import{a as w}from"./chunk-PIACHCSP.js";import{a as _}from"./chunk-J6P2CT7J.js";import"./chunk-GKZUPR7X.js";import{j as b,m as I}from"./chunk-APQUY7ND.js";import"./chunk-JS4ZJV2L.js";import{Ba as v,Fc as u,Mb as g,Oc as C,Qc as x,Vb as m,ac as y,f as h,fc as s,gc as a,hc as S,v as p,vc as l,wb as d,xa as o}from"./chunk-B762IU3Y.js";var k=h(L()),r=h(P()),Q=h(j());var A=i=>["/ficha-result",i];function O(i,t){if(i&1&&(s(0,"div",0)(1,"div",2)(2,"h1"),u(3,"Ficha Completada"),a(),s(4,"a",3),u(5,"Ver Contenido"),a()()()),i&2){let e=l();d(4),m("routerLink",x(1,A,e.fichaResultExists.id))}}function V(i,t){if(i&1&&(s(0,"div",1),S(1,"survey",4),a()),i&2){let e=l();d(),m("model",e.survey)}}var T=class f{constructor(){this.route=o(b),this.theme=o(_),this.fichaId=this.route.snapshot.paramMap.get("surveyId"),this.sesionId=this.route.snapshot.paramMap.get("sesionId"),this.fichaService=o(M),this.citaService=o(F),this.fichaResult=o(D),this.showCloseMg=!1,this.fichaResultExists=null}ngOnInit(){this.fichaResultExists||this.getFicha(),this.getFichaExists()}mergePaciente(t){this.citaService.getPacienteInfo(this.sesionId).subscribe(e=>{t.mergeData({nombres:e.data.nombres,diagnostico:e.data.diagnostico,apoderado:e.data.apoderado,fecha_nacimiento:e.data.fecha_nacimiento,edad:e.data.edad,personal:e.data.personal,telefono:e.data.telefono,colegio:e.data.colegio})})}getFichaExists(){this.fichaResult.exists(this.sesionId,this.fichaId).subscribe(t=>{this.fichaResultExists=t.data})}getFicha(){this.fichaService.getById(this.fichaId).subscribe(t=>{this.survey=new k.Model(t.data.body),this.survey.locale="es",this.survey.applyTheme(this.theme.getThemeMode()==="dark"?r.DefaultDark:r.DefaultLight);let e="<h3>Ficha Completada!</h3>";this.survey.completedHtml=e,this.showCloseMg&&(e+='<a href="javascript:window.close();">Ya puede cerrar esta ventana</a>'),this.mergePaciente(this.survey),this.survey.onComplete.add((n,c)=>{c.showSaveInProgress(),this.fichaResult.create({id_sesion:this.sesionId,id_ficha:this.fichaId,body:JSON.stringify(n.data)}).subscribe({next:()=>{this.showCloseMg=!0,console.log(this.showCloseMg),c.showSaveSuccess("Ficha Guardada Correctamente!")},error:()=>{this.showCloseMg=!1,c.showSaveError()}})})})}ngAfterViewInit(){}static{this.\u0275fac=function(e){return new(e||f)}}static{this.\u0275cmp=v({type:f,selectors:[["app-survey"]],standalone:!0,features:[C],decls:2,vars:1,consts:[[2,"position","absolute","left","50%","top","45%","transform","translate(-50%, 0)"],[1,"ficha-container"],[1,"d-flex","flex-column","align-items-center","gap-4","border-2","border-dashed","border-gray-300","bg-gray-300","rounded-1","px-10","py-8"],[1,"btn","btn-info","btn-lg",3,"routerLink"],[3,"model"]],template:function(e,n){e&1&&g(0,O,6,3,"div",0)(1,V,2,1,"div",1),e&2&&y(n.fichaResultExists?0:1)},dependencies:[R,E,I]})}};T=p([w()],T);export{T as SurveyComponent};
