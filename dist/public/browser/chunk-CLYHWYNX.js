import{a as Ve,b as De,c as Ie,d as Oe,e as Le,f as H}from"./chunk-ZR4SGAJ4.js";import{a as Ae}from"./chunk-VCCPH3IT.js";import{ib as Ne,jb as We,lb as Re}from"./chunk-5VBCUYY7.js";import{a as W}from"./chunk-X7PO4PNB.js";import{a as qe}from"./chunk-PVUJZDXO.js";import{a as N}from"./chunk-WXQDA2BM.js";import{a as we}from"./chunk-4JZDPN5V.js";import"./chunk-Q5L65FNE.js";import{a as Ee}from"./chunk-IWNHHSHM.js";import{c as Te,d as Fe}from"./chunk-ZUYGAZX4.js";import{a as Pe,b as Me}from"./chunk-XCZLRYQC.js";import"./chunk-GT4JH6HJ.js";import"./chunk-DUBUW4ZU.js";import{a as ke,b as L}from"./chunk-FKRAWMO5.js";import{b as k,c as be,d as Ce,g as Se,h as ye,k as xe}from"./chunk-XWWCT2EB.js";import{a as O}from"./chunk-PQDQNIDX.js";import"./chunk-OIXA5WM3.js";import{D as ce,E as b,F as pe,G as me,J as ue,K as he,M as fe,P as _e,T as ge,V as I,X as ve,d as q,e as oe,f as re,i as V,k as D,v as le,w as se,x as de}from"./chunk-MFZOMSUD.js";import{Ab as M,Ac as c,B as j,Ba as s,C as Q,Cc as x,Fa as P,Fc as w,Hc as ae,I as y,Ic as ne,Lc as f,Mc as _,Ob as v,Pa as R,Qa as B,Sb as $,Vb as J,Wb as Y,Xb as p,Ya as U,a as E,b as T,bc as Z,ec as r,fa as F,fc as n,gc as m,hc as K,ic as X,kc as G,oa as z,qc as C,rc as h,t as S,wc as ee,xc as te,yc as ie,zb as d}from"./chunk-JQJUQ5FW.js";var He=(o,i)=>({"btn-active-primary active":o,"cursor-not-allowed":i});function je(o,i){if(o&1){let a=G();r(0,"div",12)(1,"label",27),c(2,"Seleccionar Paquete"),n(),r(3,"ng-select",28),f(4,"async"),C("change",function(t){R(a);let l=h();return B(l.changePaquete(t))}),n()()}if(o&2){let a=h();d(3),p("items",_(4,3,a.paquetesList))("loading",a.loadingPaquetes)("loadingText","Cargando...")}}function Qe(o,i){if(o&1&&(r(0,"label",27),c(1,"N\xB0 de Sesiones"),n(),m(2,"input",29)),o&2){let a=h();d(2),Y("max",a.maxSesiones)}}function ze(o,i){o&1&&(r(0,"label",30),c(1,"Hora de Fin"),n(),m(2,"input",31))}function Ue(o,i){if(o&1){let a=G();r(0,"button",36),C("click",function(){let t=R(a).$implicit,l=h(2);return B(l.toggleOption(t))}),c(1),n()}if(o&2){let a=i.$implicit,e=h(2);p("disableTooltip",e.isEnabledDay(a))("disabled",!e.isEnabledDay(a))("ngClass",ne(4,He,e.isOptionSelected(a),!e.isEnabledDay(a))),d(),x(" ",a.label," ")}}function $e(o,i){if(o&1&&(r(0,"div",11)(1,"div",32)(2,"label",33),c(3,"Dias Disponibles"),n(),r(4,"div",34),v(5,Ue,2,7,"button",35),n()()()),o&2){let a=h();d(5),p("ngForOf",a.options)}}function Je(o,i){o&1&&m(0,"span",37)}var g,A=(g=class{constructor(i){this.fb=i,this.personalService=s(N),this.pacienteService=s(we),this.tipoCitaService=s(Ae),this.terapiaService=s(Se),this.paquetesService=s(qe),this.isLoading=s(O).isLoading,this.citaService=s(W),this.toast=s(Ee),this.onSaveComplete=new U,this.modal=s(k),this.personal=null,this.isCitaContinua=!1,this.pacientesList=new S,this.tipoCitasList=new S,this.paquetesList=new S,this.maxSesiones=0,this.isRecurrente=!1,this.isCitaPaquete=!1,this.loadingPacientes=!1,this.loadingPaquetes=!1,this.loadingTipoCitas=!1,this.timeOptions={enableTime:!0,noCalendar:!0,dateFormat:"H:i"},this.options=[{label:"L",value:1},{label:"M",value:2},{label:"MI",value:3},{label:"J",value:4},{label:"V",value:5},{label:"S",value:6}],this.isEnabledDay=a=>{let e=this.createForm.get("hora_inicio")?.value,t=this.createForm.get("hora_fin")?.value;return(this.personal?.horarios).some(u=>u.startTime.substring(0,5)<=e&&u.endTime.substring(0,5)>=t&&u.daysOfWeek.includes(a.value))},this.isOptionSelected=a=>{let e=this.createForm.get("fecha_inicio")?.value,t=new Date(e).getDay()+1,l=this.createForm.get("recurrencia");return l.value.includes(t)||l.push(this.fb.control(t)),a.value===t?!0:l.value.includes(a.value)&&this.isEnabledDay(a)},this.createForm=this.fb.group({id_paciente:[null,b.required],id_tipocita:[null,b.required],id_paquete:[null],fecha_inicio:[null,b.required],hora_inicio:[null,b.required],hora_fin:[null,b.required],descripcion:[null],paquete:[null],num_sesiones:[null],recurrencia:this.fb.array([])})}ngOnInit(){this.loadPacientes(),this.loadTipoCitas(),this.loadPaquetes()}toggleOption(i){let a=this.createForm.get("fecha_inicio")?.value,e=this.createForm.get("recurrencia"),t=new Date(a).getDay()+1;i.value!==t&&(e.value.includes(i.value)?e.removeAt(e.value.indexOf(i.value)):e.push(this.fb.control(i.value)))}changePaquete(i){let a=this.createForm.get("id_paquete"),e=this.createForm.get("num_sesiones");this.maxSesiones=i?.cantidadsesiones,a.value&&e.setValidators(b.required),e.setValue(null),e.updateValueAndValidity()}changeTipoCita(i){this.isRecurrente=i?.recurrente,this.isCitaPaquete=i?.nombre==="Paquete";let a=this.createForm.get("id_paquete"),e=this.createForm.get("num_sesiones");this.isCitaPaquete?a?.setValidators(b.required):(a?.clearValidators(),a?.setValue(null),e?.setValue(null),e?.clearValidators()),a?.updateValueAndValidity(),e?.updateValueAndValidity()}closeModal(){this.modal.dismissAll()}loadTipoCitas(){this.loadingTipoCitas=!0,this.tipoCitasList=this.tipoCitaService.getAll().pipe(y(i=>i.data),F(()=>this.loadingTipoCitas=!1),L(this))}loadPaquetes(){this.loadingPaquetes=!0,this.paquetesList=this.terapiaService.getPaquetesByTerapia(this.personal?.terapia.id_terapia).pipe(y(i=>i.data),F(()=>this.loadingPaquetes=!1),L(this))}loadPacientes(){this.loadingPacientes=!0,this.pacientesList=this.pacienteService.getAll().pipe(y(i=>i.data),F(()=>this.loadingPacientes=!1),L(this))}createCita(){this.createForm.valid&&this.citaService.createForTherapy(T(E({},this.createForm.value),{id_sede:this.personal?.sede.id_sede,id_terapia:this.personal?.terapia.id_terapia,id_personal:this.personal?.id_personal})).subscribe({next:i=>{this.onSaveComplete.emit(),this.closeModal(),i.message&&this.toast.info(i.message,"Cita Creada",{timeOut:6500,progressBar:!0,progressAnimation:"increasing"})},error:i=>{if(i.error.errors){let a=Object.values(i.error.errors).join(`
`);this.toast.error(a,"Error")}else this.toast.error("Ocurri\xF3 un error al crear la cita","Error")}})}},g.\u0275fac=function(a){return new(a||g)(M(I))},g.\u0275cmp=P({type:g,selectors:[["app-create-modal"]],outputs:{onSaveComplete:"onSaveComplete"},standalone:!0,features:[w],decls:47,vars:24,consts:[[1,"modal-header"],[1,"modal-title"],[1,"text-primary"],[1,"ki-duotone","ki-add-files","text-gray-900","fs-1",2,"vertical-align","text-top"],[1,"path1"],[1,"path2"],[1,"path3"],["type","button","aria-label","Close",1,"btn","btn-sm","btn-icon","btn-active-color-primary","btn-color-gray-800",3,"click"],[1,"ki-duotone","ki-cross-square","fs-1"],[1,"modal-body"],[1,"form","d-flex","flex-column","gap-4",3,"formGroup"],[1,"row"],[1,"form-group","col-6"],["for","kt_calendar_datepicker_date",1,"form-label"],["bindValue","id_paciente","placeholder","Seleccionar","bindLabel","nombre","formControlName","id_paciente",3,"items","loading","loadingText"],[1,"form-label"],["bindValue","id_tipocita","placeholder","Seleccionar","bindLabel","nombre","formControlName","id_tipocita",3,"change","items","loading","loadingText"],["class","form-group col-6",4,"ngIf"],[1,"form-group","col","mb-3"],["type","text","id","kt_calendar_datepicker_date","formControlName","fecha_inicio","mwlFlatpickr","","readonly","","placeholder","Seleccionar Fecha(s)",1,"form-control",3,"noCalendar","altInput","altFormat"],["for","kt_calendar_datepicker_start_time",1,"form-label"],["type","text","id","kt_calendar_datepicker_start_time","formControlName","hora_inicio","readonly","","placeholder","Seleccionar Hora de Inicio",1,"form-control"],["class","row",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-light",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["class","spinner-border spinner-border-sm align-middle ms-2",4,"ngIf"],["for","",1,"form-label"],["bindValue","id_paquetes","placeholder","Seleccionar Paquete","bindLabel","nombre","formControlName","id_paquete",3,"change","items","loading","loadingText"],["type","number","min","2","step","1","formControlName","num_sesiones",1,"form-control"],["for","kt_calendar_datepicker_end_time",1,"form-label"],["type","text","id","kt_calendar_datepicker_end_time","formControlName","hora_fin","readonly","","placeholder","Seleccionar Hora de Fin",1,"form-control"],[1,"form-group","d-flex","flex-column","col","mb-3"],["for","kt_calendar_datepicker_end_date",1,"form-label"],[1,"btn-group"],["ngbTooltip","No Disponible","class","btn btn-outline",3,"disableTooltip","disabled","ngClass","click",4,"ngFor","ngForOf"],["ngbTooltip","No Disponible",1,"btn","btn-outline",3,"click","disableTooltip","disabled","ngClass"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"]],template:function(a,e){if(a&1&&(r(0,"div",0)(1,"h4",1)(2,"span",2)(3,"i",3),m(4,"span",4)(5,"span",5)(6,"span",6),n()(),c(7),n(),r(8,"button",7),C("click",function(){return e.closeModal()}),r(9,"i",8),m(10,"span",4)(11,"span",5),n()()(),r(12,"div",9)(13,"form",10)(14,"section",11)(15,"div",12)(16,"label",13),c(17,"Seleccionar Paciente"),n(),m(18,"ng-select",14),f(19,"async"),n(),r(20,"div",12)(21,"label",15),c(22,"Seleccionar Tipo de Cita"),n(),r(23,"ng-select",16),f(24,"async"),C("change",function(l){return e.changeTipoCita(l)}),n()()(),v(25,je,5,5,"div",17),r(26,"div",11)(27,"div",18)(28,"label",13),c(29,"Fecha"),n(),m(30,"input",19),n(),r(31,"div",18)(32,"label",20),c(33,"Hora de Inicio"),n(),m(34,"input",21),n(),r(35,"div",18),v(36,Qe,3,1)(37,ze,3,0),n()(),v(38,$e,6,1,"div",22),n()(),r(39,"div",23)(40,"button",24),C("click",function(){return e.closeModal()}),c(41,"Cancelar"),n(),r(42,"button",25),f(43,"async"),C("click",function(){return e.createCita()}),c(44," Registrar "),v(45,Je,1,0,"span",26),f(46,"async"),n()()),a&2){let t;d(7),x(" Registrar Cita para ",e.personal==null?null:e.personal.nombre," "),d(6),p("formGroup",e.createForm),d(5),p("items",_(19,16,e.pacientesList))("loading",e.loadingPacientes)("loadingText","Cargando..."),d(5),p("items",_(24,18,e.tipoCitasList))("loading",e.loadingTipoCitas)("loadingText","Cargando..."),d(2),p("ngIf",e.isCitaPaquete),d(5),p("noCalendar",!0)("altInput",!0)("altFormat","d/m/Y"),d(6),Z((t=e.createForm.get("id_paquete"))!=null&&t.value?36:37),d(2),p("ngIf",e.isRecurrente),d(4),p("disabled",!e.createForm.valid||_(43,20,e.isLoading)),d(3),p("ngIf",_(46,22,e.isLoading))}},dependencies:[ve,ue,ce,he,pe,me,ge,fe,_e,Me,Pe,Fe,Te,D,q,oe,re,V,Ce,be]}),g);A=j([ke({checkProperties:!0}),Q("design:paramtypes",[I])],A);var Ye=["calendar"],Ze=()=>[Ne,q,V],Ke=o=>({"opacity-50":o});function Xe(o,i){if(o&1&&(m(0,"full-calendar",10,0),f(2,"async"),f(3,"async")),o&2){let a=h();p("events",_(2,3,a.citasEvent))("ngClass",ae(7,Ke,_(3,5,a.isLoading)))("options",a.calendarOptions)}}function et(o,i){o&1&&(r(0,"h1"),c(1,"Loading..."),n())}var Zt=(()=>{let i=class i{get bodyParams(){return{id_personal:this.personalId,startWeek:this.startWeek,endWeek:this.endWeek}}constructor(e){this.route=e,this.isLoading=s(O).isLoading,this.modal=s(k),this.loadingCalendar=!1,this.citasService=s(W),this.personalService=s(N),this.modalService=s(k),this.router=s(de),this.citasEvent=new S,this.personalId=this.route.snapshot.params.terapist,this.startWeek=H().startOfWeek,this.endWeek=H().endOfWeek,this.calendarOptions={plugins:[Ve,De,Ie,Oe],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},eventMaxStack:1,allDaySlot:!1,expandRows:!0,slotLabelInterval:"00:05:00",slotMinTime:"08:00",slotMaxTime:"20:00:00",slotLabelFormat:{hour:"numeric",minute:"2-digit",omitZeroMinute:!1,meridiem:"narrow"},eventTimeFormat:{hour:"numeric",minute:"2-digit",meridiem:"short"},selectConstraint:"businessHours",initialView:"timeGridWeek",weekends:!0,editable:!0,loading:t=>{this.loadingCalendar=t},select:t=>this.handleClick(t),eventClick:this.handleEventClick.bind(this),selectAllow:t=>{let l=this.calendar?.getApi()?.view.type=="timeGridWeek",u=new Date;return u.setHours(0,0,0,0),t.start>=u&&l},selectable:!0,selectMirror:!0,dayMaxEvents:!0,locale:Le,datesSet:t=>{this.startWeek=t.view.activeStart,this.endWeek=t.view.activeEnd,this.loadCitas(this.bodyParams)}},this.route.params.subscribe(()=>{this.startWeek=this.calendar?.getApi()?.view.activeStart,this.endWeek=this.calendar?.getApi()?.view.activeEnd})}ngOnInit(){this.route.params.pipe(z(({terapist:e})=>this.personalId=e)).subscribe(e=>{this.loadCitas(this.bodyParams)}),this.route.data.subscribe(e=>{this.currentPersonal=e.personal,this.calendarOptions=T(E({},this.calendarOptions),{businessHours:this.currentPersonal?.horarios,slotDuration:this.currentPersonal?.terapia.duracion})})}handleClick(e){let t=this.modal.open(A,{size:"lg",centered:!0});t.componentInstance.personal=this.currentPersonal,t.componentInstance.onSaveComplete.subscribe(()=>{this.loadCitas(this.bodyParams)}),t.componentInstance.createForm.patchValue({fecha_inicio:e.startStr.substring(0,10),hora_inicio:e.startStr.substring(11,16),hora_fin:e.endStr.substring(11,16)})}handleEventClick(e){let t=e.event,l=this.modalService.open(Re,{centered:!0,size:"100",scrollable:!0,backdrop:"static"});window.document.body.classList.add("modal-open"),l.componentInstance.eventId=t.id,l.componentInstance.citaId=t.extendedProps.id_cita,l.componentInstance.eventUpdated.subscribe(()=>{this.loadCitas(this.bodyParams)})}loadCitas(e){if(this.currentPersonal)return this.citasEvent=this.citasService.getByPersonal(e).pipe(y(t=>t.data))}};i.\u0275fac=function(t){return new(t||i)(M(le))},i.\u0275cmp=P({type:i,selectors:[["app-especialista"]],viewQuery:function(t,l){if(t&1&&ee(Ye,5),t&2){let u;te(u=ie())&&(l.calendar=u.first)}},standalone:!0,features:[w],decls:17,vars:1,consts:[["calendar",""],["header-title",""],[1,"d-flex","align-items-center","text-white","fw-bold","my-1"],[1,"content","d-flex","flex-column","flex-column-fluid"],["id","kt_content_container",1,"container-xxl"],[1,"card"],[1,"card-header"],[1,"card-toolbar","d-flex","ms-auto","justify-content-end"],[1,"card-body",2,"border","none","box-shadow","0 4px 8px rgba(0, 0, 0, 0.1)","border-radius","0 0 15px 15px"],[1,"demo-app-main"],[3,"events","ngClass","options"]],template:function(t,l){t&1&&(r(0,"app-header"),K(1,1),r(2,"h1",2),c(3),n(),X(),n(),r(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6)(8,"div",7),m(9,"app-dropdown"),n()(),r(10,"div",8)(11,"div",9),v(12,Xe,4,9)(13,et,2,0),$(14,12,Ze,null,13),J(0,-1),n()()()()(),m(16,"router-outlet")),t&2&&(d(3),x(" ",l.currentPersonal==null?null:l.currentPersonal.nombre," "))},dependencies:[xe,ye,We,D,se]});let o=i;return o})();export{Zt as EspecialistaComponent};
