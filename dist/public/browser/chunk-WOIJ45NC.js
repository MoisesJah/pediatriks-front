import{a as I}from"./chunk-ZK2D5MUY.js";import{a as te}from"./chunk-UU7FDT6A.js";import{a as De}from"./chunk-UAJD3ZHR.js";import{a as Ve}from"./chunk-K7PIUIFR.js";import{a as Me}from"./chunk-IJFH7NGW.js";import{a as we,e as j,f as G}from"./chunk-6DZXAK53.js";import{a as Te,b as Ne}from"./chunk-JKPBS6JL.js";import{a as ee}from"./chunk-GT4JH6HJ.js";import"./chunk-EBZKSOFQ.js";import{a as D,b as V}from"./chunk-KG3B2A6X.js";import{a as Pe}from"./chunk-U2EAJGNN.js";import{o as k,u as Ie}from"./chunk-CZPC3FHQ.js";import{a as x}from"./chunk-NMGGHNE5.js";import"./chunk-A3C2G7L3.js";import{a as xe}from"./chunk-KNEUCQQI.js";import"./chunk-GKZUPR7X.js";import{A as W,C as K,F as X,J as Z,M as q,N as ke,O as N,r as $,s,t as Y,u as H,z as J}from"./chunk-R7YU5FNY.js";import{m as Ee,n as Fe,o as y,t as E,v as F}from"./chunk-DP3M2V7L.js";import{Aa as S,Ac as z,C as M,Gc as C,Ic as ye,Ka as g,La as v,Lb as _,Nc as f,Oc as h,S as me,Ta as T,Ub as c,a as ge,b as ve,bc as r,cc as i,dc as l,ec as Se,f as qe,fc as Ce,hc as A,n as P,nc as m,oc as Q,pb as _e,rc as de,uc as O,v as w,vb as p,vc as R,w as L,wa as d,wb as B,wc as U,y as pe,yc as o,zc as ce}from"./chunk-B7JMKZ3I.js";var ie=qe(Ve());var Ue=["datePicker"],je=["endDatePicker"];function Ge(b,e){b&1&&l(0,"span",42)}var ne=class ue{constructor(e){this.fb=e,this.modal=d(k),this.paqueteService=d(I),this.loadingService=d(x),this.terapiaService=d(te),this.isLoading=this.loadingService.isLoading,this.terapiaid="",this.terapiasList=new P,this.onSaveComplete=new T,this.paqueteForm=this.fb.group({nombre:["",s.required],descripcion:[""],num_cambios:[null,[s.required,s.min(1)]],cantidadsesiones:["",[s.required,s.min(1)]],precioregular:["",[s.required,s.min(0),s.pattern("^[0-9]+(\\.[0-9]{1,2})?$")]],descuento:["",[s.required,s.min(0),s.max(100),s.pattern("^[0-9]+(\\.[0-9]{1,2})?$")]],preciopaquete:["",[s.required,s.min(0),s.pattern("^[0-9]+(\\.[0-9]{1,2})?$")]],fechainicio:[""],fechafin:[""],terapias:[null,s.required],banner_url:[""]})}evtSelectFile(e){let t=e.target.files;this.paqueteForm.get("banner_url")?.setValue(t?.item(0))}ngOnInit(){this.loadTerapias(),this.paqueteForm.get("precioregular")?.valueChanges.subscribe(()=>this.calculatePreciopaquete()),this.paqueteForm.get("descuento")?.valueChanges.subscribe(()=>this.calculatePreciopaquete()),this.paqueteForm.get("fechainicio")?.valueChanges.subscribe(()=>{this.paqueteForm.get("fechafin")?.value<this.paqueteForm.get("fechainicio")?.value&&this.paqueteForm.get("fechafin")?.setValue(this.paqueteForm.get("fechainicio")?.value)})}loadTerapias(){this.terapiasList=this.terapiaService.getAll().pipe(M(e=>e.data),V(this))}ngAfterViewInit(){let e=new Date;this.datePicker&&this.datePicker.nativeElement&&ee(this.datePicker.nativeElement,{locale:ie.Spanish,altFormat:"d/m/Y",altInput:!0,minDate:e,onChange:t=>{let n=t[0];if(this.endDatePicker&&this.endDatePicker.nativeElement){let a=ee(this.endDatePicker.nativeElement,{locale:ie.Spanish,altFormat:"d/m/Y",altInput:!0,minDate:n});this.paqueteForm.get("fechafin")?.value<n&&(this.paqueteForm.get("fechafin")?.setValue(n),a.setDate(n))}}}),this.endDatePicker&&this.endDatePicker.nativeElement&&ee(this.endDatePicker.nativeElement,{locale:ie.Spanish,altInput:!0,altFormat:"d/m/Y",minDate:e})}close(){this.modal.dismissAll()}save(){let e=new FormData;Object.keys(this.paqueteForm.value).forEach(t=>{let n=this.paqueteForm.get(t);Array.isArray(n?.value)?e.append(t,JSON.stringify(n?.value)):e.append(t,n?.value)}),this.paqueteService.create(e).subscribe({next:()=>{this.modal.dismissAll(),this.onSaveComplete.emit()},error:t=>{console.log(t)}})}calculatePreciopaquete(){let e=this.paqueteForm.get("precioregular")?.value,t=this.paqueteForm.get("descuento")?.value;if(e&&t!=null){let n=t/100,a=e-e*n;this.paqueteForm.get("preciopaquete")?.setValue(a.toFixed(2),{emitEvent:!1})}}static{this.\u0275fac=function(t){return new(t||ue)(B(q))}}static{this.\u0275cmp=S({type:ue,selectors:[["app-crear-modal"]],viewQuery:function(t,n){if(t&1&&(O(Ue,5),O(je,5)),t&2){let a;R(a=U())&&(n.datePicker=a.first),R(a=U())&&(n.endDatePicker=a.first)}},inputs:{terapiaid:"terapiaid"},outputs:{onSaveComplete:"onSaveComplete"},standalone:!0,features:[C],decls:72,vars:14,consts:[["datePicker",""],["endDatePicker",""],[1,"modal-header"],["id","modal-basic-title",1,"modal-title","d-flex","align-items-center","gap-1"],[1,"text-primary"],[1,"ki-duotone","ki-add-files","text-gray-900","fs-1",2,"vertical-align","text-top"],[1,"path1"],[1,"path2"],[1,"path3"],["type","button","aria-label","Close",1,"btn","btn-sm","btn-icon","btn-active-color-primary","btn-color-gray-800",3,"click"],[1,"ki-duotone","ki-cross-square","fs-1"],[1,"modal-body"],[1,"form","d-flex","flex-column","gap-4",3,"formGroup"],[1,"form-group"],["for","nombre",1,"required","form-label"],["type","text","id","nombre","formControlName","nombre","placeholder","Ingresa Nombre del Paquete",1,"form-control"],["for","",1,"required","form-label"],["type","file","id","imagen","accept","image/*",1,"form-control",3,"change"],["for","descripcion",1,"form-label"],["cols","3","rows","2","id","descripcion","formControlName","descripcion","placeholder","Ingresa Descripci\xF3n del Paquete",1,"form-control"],["for","terapias",1,"required","form-label"],["bindValue","id_terapia","bindLabel","nombre","formControlName","terapias","placeholder","Seleccionar","bindLabel","nombre",3,"items","multiple","closeOnSelect","hideSelected","loadingText"],[1,"row"],[1,"form-group","col-4"],["for","cantidadsesiones",1,"required","form-label"],["type","number","id","cantidadsesiones","formControlName","cantidadsesiones","min","1","placeholder","Nro de Sesiones",1,"form-control"],["type","number","id","num_cambios","formControlName","num_cambios","min","1","placeholder","Nro de Cambios",1,"form-control"],["for","precioregular",1,"required","form-label"],["type","number","id","precioregular","formControlName","precioregular","min","0","step","0.01","placeholder","Ingresar Precio",1,"form-control"],[1,"form-group","col-6"],["for","descuento",1,"required","form-label"],["type","number","id","descuento","formControlName","descuento","min","0","step","0.01","placeholder","Ingresar Descuento %",1,"form-control"],["for","preciopaquete",1,"required","form-label"],["type","number","id","preciopaquete","formControlName","preciopaquete","min","0","step","0.01","placeholder","Precio Total",1,"form-control"],["for","fechainicio",1,"form-label"],["type","text","id","kt_calendar_datepicker_date","formControlName","fechainicio","placeholder","Seleccionar Fecha",1,"form-control"],["for","fechafin",1,"form-label"],["type","text","id","kt_calendar_datepicker_end_date","formControlName","fechafin","placeholder","Seleccionar Fecha",1,"form-control"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["class","spinner-border spinner-border-sm align-middle ms-2",4,"ngIf"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"]],template:function(t,n){if(t&1){let a=A();r(0,"div",2)(1,"h4",3)(2,"span",4)(3,"i",5),l(4,"span",6)(5,"span",7)(6,"span",8),i()(),o(7," A\xF1adir Paquete "),i(),r(8,"button",9),m("click",function(){return g(a),v(n.close())}),r(9,"i",10),l(10,"span",6)(11,"span",7),i()()(),r(12,"div",11)(13,"form",12)(14,"div",13)(15,"label",14),o(16,"Nombre del Paquete"),i(),l(17,"input",15),i(),r(18,"div",13)(19,"label",16),o(20,"Imagen"),i(),r(21,"input",17),m("change",function(se){return g(a),v(n.evtSelectFile(se))}),i()(),r(22,"div",13)(23,"label",18),o(24,"Descripci\xF3n"),i(),l(25,"textarea",19),i(),r(26,"div",13)(27,"label",20),o(28,"Seleccionar Terapia(s) Incluidas"),i(),l(29,"ng-select",21),f(30,"async"),i(),r(31,"div",22)(32,"div",23)(33,"label",24),o(34,"Nro de Sesiones"),i(),l(35,"input",25),i(),r(36,"div",23)(37,"label",24),o(38,"Nro de Cambios"),i(),l(39,"input",26),i(),r(40,"div",23)(41,"label",27),o(42,"Precio Regular"),i(),l(43,"input",28),i()(),r(44,"div",22)(45,"div",29)(46,"label",30),o(47,"Descuento %"),i(),l(48,"input",31),i(),r(49,"div",29)(50,"label",32),o(51,"Precio del Paquete"),i(),l(52,"input",33),i()(),r(53,"div",22)(54,"div",29)(55,"label",34),o(56,"Fecha de Inicio"),i(),l(57,"input",35,0),i(),r(59,"div",29)(60,"label",36),o(61,"Fecha de Fin"),i(),l(62,"input",37,1),i()()()(),r(64,"div",38)(65,"button",39),m("click",function(){return g(a),v(n.close())}),o(66," Cancelar "),i(),r(67,"button",40),f(68,"async"),m("click",function(){return g(a),v(n.save())}),o(69," Guardar "),_(70,Ge,1,0,"span",41),f(71,"async"),i()()}t&2&&(p(13),c("formGroup",n.paqueteForm),p(16),c("items",h(30,8,n.terapiasList))("multiple",!0)("closeOnSelect",!1)("hideSelected",!0)("loadingText","Cargando.."),p(38),c("disabled",n.paqueteForm.invalid||h(68,10,n.isLoading)),p(3),c("ngIf",h(71,12,n.isLoading)))},dependencies:[N,J,$,W,Y,H,Z,K,X,F,y,E,G,j]})}};ne=w([D({checkProperties:!0}),L("design:paramtypes",[q])],ne);function Qe(b,e){b&1&&l(0,"span",13)}var Ae=(()=>{class b{constructor(){this.modal=d(k),this.paqueteService=d(I),this.isLoading=d(x).isLoading,this.paqueteId="",this.onSaveComplete=new T}close(){this.modal.dismissAll()}delete(){let t=typeof this.paqueteId=="string"?this.paqueteId:this.paqueteId.id_paquetes;t?this.paqueteService.delete(t).subscribe({next:()=>{this.onSaveComplete.emit(),this.modal.dismissAll()},error:n=>{console.error("Error al eliminar paquete:",n)}}):console.error("ID del paquete no proporcionado o en formato incorrecto")}static{this.\u0275fac=function(n){return new(n||b)}}static{this.\u0275cmp=S({type:b,selectors:[["app-borrar-modal"]],inputs:{paqueteId:"paqueteId"},outputs:{onSaveComplete:"onSaveComplete"},standalone:!0,features:[C],decls:25,vars:6,consts:[[1,"modal-header"],["id","modal-basic-title",1,"modal-title","d-flex","align-items-center","gap-1"],[1,"ki-duotone","ki-information","text-danger","fs-2hx",2,"vertical-align","middle"],[1,"path1"],[1,"path2"],[1,"path3"],["type","button","aria-label","Close",1,"btn","btn-sm","btn-icon","btn-active-color-primary","btn-color-gray-800",3,"click"],[1,"ki-duotone","ki-cross-square","fs-1"],[1,"modal-body","text-center"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-danger",3,"click","disabled"],["class","spinner-border spinner-border-sm align-middle ms-2",4,"ngIf"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"]],template:function(n,a){n&1&&(r(0,"div",0)(1,"h4",1)(2,"span")(3,"i",2),l(4,"span",3)(5,"span",4)(6,"span",5),i()(),o(7," Eliminar Paquete "),i(),r(8,"button",6),m("click",function(){return a.close()}),r(9,"i",7),l(10,"span",3)(11,"span",4),i()()(),r(12,"div",8)(13,"p"),o(14,"\xBFEst\xE1s seguro de eliminar este registro de paquete?"),i(),r(15,"p"),o(16,"Toda la informaci\xF3n relacionada con este paquete se perder\xE1."),i()(),r(17,"div",9)(18,"button",10),m("click",function(){return a.close()}),o(19," Cancelar "),i(),r(20,"button",11),f(21,"async"),m("click",function(){return a.delete()}),o(22," Eliminar "),_(23,Qe,1,0,"span",12),f(24,"async"),i()()),n&2&&(p(20),c("disabled",h(21,2,a.isLoading)),p(3),c("ngIf",h(24,4,a.isLoading)))},dependencies:[N,F,y,E]})}}return b})();var Oe=qe(Ve());var ze=["datePicker"],$e=["endDatePicker"];function Ye(b,e){b&1&&l(0,"span",40)}var ae=class fe{constructor(e){this.fb=e,this.modal=d(k),this.paqueteService=d(I),this.terapiaService=d(te),this.isLoading=d(x).isLoading,this.paqueteId="",this.es=Oe.default.es,this.terapiasList=new P,this.onSaveComplete=new T,this.paqueteForm=this.fb.group({nombre:["",s.required],descripcion:[""],num_cambios:[null,[s.required,s.min(1)]],cantidadsesiones:[0,[s.required,s.min(1)]],precioregular:[0,[s.required,s.min(0)]],descuento:[0,[s.required,s.min(0)]],preciopaquete:[0,[s.required,s.min(0)]],fechainicio:[""],fechafin:[""],terapias:[null,s.required],sesionesrestantes:[0,[s.required,s.min(0)]],banner_url:[""]})}ngOnInit(){this.loadTerapias(),typeof this.paqueteId=="string"?this.loadPaqueteData():typeof this.paqueteId=="object"&&this.paqueteId.id_paquetes?this.loadPaqueteData(this.paqueteId.id_paquetes):console.error("ID del paquete no proporcionado o no es una cadena",this.paqueteId),this.paqueteForm.get("precioregular")?.valueChanges.subscribe(()=>this.calculatePreciopaquete()),this.paqueteForm.get("descuento")?.valueChanges.subscribe(()=>this.calculatePreciopaquete()),this.paqueteForm.get("fechainicio")?.valueChanges.subscribe(()=>{this.paqueteForm.get("fechafin")?.value<this.paqueteForm.get("fechainicio")?.value&&this.paqueteForm.get("fechafin")?.setValue(this.paqueteForm.get("fechainicio")?.value)})}loadTerapias(){this.terapiasList=this.terapiaService.getAll().pipe(M(e=>e.data),V(this))}close(){this.modal.dismissAll()}save(){if(this.paqueteForm.valid){let e=new FormData;e.append("nombre",this.paqueteForm.get("nombre")?.value||""),e.append("descripcion",this.paqueteForm.get("descripcion")?.value||""),e.append("cantidadsesiones",this.paqueteForm.get("cantidadsesiones")?.value||""),e.append("num_cambios",this.paqueteForm.get("num_cambios")?.value||""),e.append("precioregular",this.paqueteForm.get("precioregular")?.value||""),e.append("descuento",this.paqueteForm.get("descuento")?.value||""),e.append("preciopaquete",this.paqueteForm.get("preciopaquete")?.value||""),e.append("fechainicio",this.paqueteForm.get("fechainicio")?.value||""),e.append("fechafin",this.paqueteForm.get("fechafin")?.value||""),e.append("terapias",JSON.stringify(this.paqueteForm.get("terapias")?.value)||"[]"),e.append("sesionesrestantes",this.paqueteForm.get("sesionesrestantes")?.value||"");let t=this.paqueteForm.get("banner_url")?.value;t&&e.append("banner_url",t);let n=typeof this.paqueteId=="string"?this.paqueteId:this.paqueteId.id_paquetes;n&&this.paqueteService.update(n,e).subscribe({next:()=>{this.onSaveComplete.emit(),this.modal.dismissAll()},error:a=>{console.error("Error al actualizar paquete:",a.message),alert("No se pudo actualizar el paquete. Intenta nuevamente.")}})}}loadPaqueteData(e){let t=e||(typeof this.paqueteId=="object"?this.paqueteId.id_paquetes:this.paqueteId);t?this.paqueteService.getById(t).subscribe({next:n=>{this.paqueteForm.patchValue(ve(ge({},n.data),{terapias:n.data.terapias.map(a=>a.id_terapia)}))},error:n=>{console.error("Error al cargar datos del paquete:",n)}}):console.error("ID del paquete no proporcionado")}calculatePreciopaquete(){let e=this.paqueteForm.get("precioregular")?.value,t=this.paqueteForm.get("descuento")?.value;if(e&&t!=null){let n=t/100,a=e-e*n;this.paqueteForm.get("preciopaquete")?.setValue(a,{emitEvent:!1})}}evtSelectFile(e){let t=e.target.files?.[0];t&&this.paqueteForm.get("banner_url")?.setValue(t)}static{this.\u0275fac=function(t){return new(t||fe)(B(q))}}static{this.\u0275cmp=S({type:fe,selectors:[["app-editar-modal"]],viewQuery:function(t,n){if(t&1&&(O(ze,5),O($e,5)),t&2){let a;R(a=U())&&(n.datePicker=a.first),R(a=U())&&(n.endDatePicker=a.first)}},inputs:{paqueteId:"paqueteId"},outputs:{onSaveComplete:"onSaveComplete"},standalone:!0,features:[C],decls:71,vars:22,consts:[["datePicker",""],["endDatePicker",""],[1,"modal-header"],["id","modal-basic-title",1,"modal-title","d-flex","align-items-center","gap-1"],[1,"ki-duotone","ki-notepad-edit","text-gray-900","fs-1",2,"vertical-align","top"],[1,"path1"],[1,"path2"],["type","button","aria-label","Close",1,"btn","btn-sm","btn-icon","btn-active-color-primary","btn-color-gray-800",3,"click"],[1,"ki-duotone","ki-cross-square","fs-1"],[1,"modal-body"],[1,"form","d-flex","flex-column","gap-4",3,"formGroup"],[1,"form-group"],["for","nombre",1,"required","form-label"],["type","text","id","nombre","formControlName","nombre",1,"form-control"],["for","imagen",1,"required","form-label"],["type","file","id","imagen","accept","image/*",1,"form-control",3,"change"],["for","descripcion",1,"required","form-label"],["rows","2","id","descripcion","formControlName","descripcion",1,"form-control"],["for","terapias",1,"required","form-label"],["bindValue","id_terapia","bindLabel","nombre","formControlName","terapias","placeholder","Seleccionar","bindLabel","nombre",3,"items","multiple","closeOnSelect","hideSelected","loadingText"],[1,"row"],[1,"form-group","col-4"],["for","cantidadsesiones",1,"required","form-label"],["type","number","id","cantidadsesiones","formControlName","cantidadsesiones","min","1","placeholder","Nro de Sesiones",1,"form-control"],["type","number","id","num_cambios","formControlName","num_cambios","min","1","placeholder","Nro de Cambios",1,"form-control"],["for","precioregular",1,"required","form-label"],["type","number","id","precioregular","formControlName","precioregular","min","0","step","0.01","placeholder","Ingresar Precio",1,"form-control"],[1,"form-group","col-6"],["for","descuento",1,"required","form-label"],["type","number","id","descuento","formControlName","descuento","min","0","step","0.01",1,"form-control"],["for","preciopaquete",1,"required","form-label"],["type","number","id","preciopaquete","formControlName","preciopaquete","min","0","step","0.01",1,"form-control"],["for","fechainicio",1,"form-label"],["id","kt_calendar_datepicker_date","mwlFlatpickr","","formControlName","fechainicio","placeholder","Seleccionar Fecha",1,"form-control",3,"locale","altInput","altFormat","monthSelectorType"],["for","fechafin",1,"form-label"],["id","kt_calendar_datepicker_end_date","formControlName","fechafin","mwlFlatpickr","","placeholder","Seleccionar Fecha",1,"form-control",3,"locale","altInput","altFormat","monthSelectorType"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["class","spinner-border spinner-border-sm align-middle ms-2",4,"ngIf"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"]],template:function(t,n){if(t&1){let a=A();r(0,"div",2)(1,"h4",3)(2,"span")(3,"i",4),l(4,"span",5)(5,"span",6),i()(),o(6," Editar Paquete "),i(),r(7,"button",7),m("click",function(){return g(a),v(n.close())}),r(8,"i",8),l(9,"span",5)(10,"span",6),i()()(),r(11,"div",9)(12,"form",10)(13,"div",11)(14,"label",12),o(15,"Nombre del Paquete"),i(),l(16,"input",13),i(),r(17,"div",11)(18,"label",14),o(19,"Imagen"),i(),r(20,"input",15),m("change",function(se){return g(a),v(n.evtSelectFile(se))}),i()(),r(21,"div",11)(22,"label",16),o(23,"Descripci\xF3n"),i(),l(24,"textarea",17),i(),r(25,"div",11)(26,"label",18),o(27,"Seleccionar Terapia(s) Incluidas"),i(),l(28,"ng-select",19),f(29,"async"),i(),r(30,"div",20)(31,"div",21)(32,"label",22),o(33,"Nro de Sesiones"),i(),l(34,"input",23),i(),r(35,"div",21)(36,"label",22),o(37,"Nro de Cambios"),i(),l(38,"input",24),i(),r(39,"div",21)(40,"label",25),o(41,"Precio Regular"),i(),l(42,"input",26),i()(),r(43,"div",20)(44,"div",27)(45,"label",28),o(46,"Descuento %"),i(),l(47,"input",29),i(),r(48,"div",27)(49,"label",30),o(50,"Precio del Paquete"),i(),l(51,"input",31),i()(),r(52,"div",20)(53,"div",27)(54,"label",32),o(55,"Fecha de Inicio"),i(),l(56,"input",33,0),i(),r(58,"div",27)(59,"label",34),o(60,"Fecha de Fin"),i(),l(61,"input",35,1),i()()()(),r(63,"div",36)(64,"button",37),m("click",function(){return g(a),v(n.close())}),o(65," Cancelar "),i(),r(66,"button",38),f(67,"async"),m("click",function(){return g(a),v(n.save())}),o(68," Guardar "),_(69,Ye,1,0,"span",39),f(70,"async"),i()()}t&2&&(p(12),c("formGroup",n.paqueteForm),p(16),c("items",h(29,16,n.terapiasList))("multiple",!0)("closeOnSelect",!1)("hideSelected",!0)("loadingText","Cargando.."),p(28),c("locale",n.es)("altInput",!0)("altFormat","d/m/Y")("monthSelectorType","dropdown"),p(5),c("locale",n.es)("altInput",!0)("altFormat","d/m/Y")("monthSelectorType","dropdown"),p(5),c("disabled",n.paqueteForm.invalid||h(67,18,n.isLoading)),p(3),c("ngIf",h(70,20,n.isLoading)))},dependencies:[N,J,$,W,Y,H,Z,K,X,F,y,E,Ne,Te,G,j]})}};ae=w([D({checkProperties:!0}),L("design:paramtypes",[q])],ae);function He(b,e){b&1&&l(0,"span",16)}var le=class he{constructor(e){this.fb=e,this.modal=d(k),this.paqueteService=d(I),this.usuarioService=d(Me),this.toast=d(we),this.pacienteService=d(De),this.isLoading=d(x).isLoading,this.paqueteId=null,this.onSaveComplete=new T,this.usuariosList=new P,this.pacientesList=new P,this.selectedUser=null,this.selectedPaciente=null,this.form=this.fb.group({usuario:[null,s.required],paciente:[null,s.required]})}ngOnInit(){this.fetchUsuarios(),this.loadPaqueteData()}fetchUsuarios(){this.usuariosList=this.usuarioService.getPacientes().pipe(V(this),M(e=>e.data||[]),me(e=>(console.error("Error al buscar usuarios:",e),pe([]))))}loadPaqueteData(){let e;this.paqueteId&&(typeof this.paqueteId=="string"?e=this.paqueteId:typeof this.paqueteId=="object"&&this.paqueteId.id_paquetes&&(e=this.paqueteId.id_paquetes)),console.log("ID del paquete:",e),e?this.paqueteService.getById(e).subscribe({next:t=>{console.log("Paquete cargado:",t)},error:t=>{console.error("Error al cargar datos del paquete:",t)}}):console.error("ID del paquete no proporcionado")}onUserSelect(e){this.selectedUser=e,this.form.controls.paciente.reset(),this.loadPacientesByUser(e.id)}onPacienteSelect(e){this.selectedPaciente=e}loadPacientesByUser(e){this.pacientesList=this.pacienteService.getAll().pipe(M(t=>t.data.filter(n=>n.id===e)),me(t=>(console.error("Error al cargar pacientes:",t),pe([]))))}compareUsers(e,t){return e&&t?e.id===t.id:e===t}close(){this.modal.dismissAll()}purchase(){if(this.paqueteId===null){console.error("ID del paquete no est\xE1 disponible"),alert("Por favor, selecciona un paquete v\xE1lido.");return}let e=typeof this.paqueteId=="string"?this.paqueteId:this.paqueteId.id_paquetes;if(!e){console.error("ID del paquete no est\xE1 disponible"),alert("Por favor, selecciona un paquete v\xE1lido.");return}if(!this.selectedUser){console.error("Usuario no seleccionado"),alert("Por favor, selecciona un usuario.");return}if(!this.selectedPaciente){console.error("Paciente no seleccionado"),alert("Por favor, selecciona un paciente.");return}let t=this.selectedPaciente.id_paciente,n=this.selectedUser.id;this.paqueteService.purchase(e,t,n).subscribe({next:()=>{console.log("Compra realizada con \xE9xito"),this.onSaveComplete.emit(),this.modal.dismissAll()},error:a=>{if(a.error.errors){let u=Object.values(a.error.errors).join(`
`);this.toast.error(u,"Error")}else this.toast.error("Ocurri\xF3 un error","Error ")}})}static{this.\u0275fac=function(t){return new(t||he)(B(q))}}static{this.\u0275cmp=S({type:he,selectors:[["app-comprar-modal"]],inputs:{paqueteId:"paqueteId"},outputs:{onSaveComplete:"onSaveComplete"},standalone:!0,features:[C],decls:33,vars:23,consts:[[1,"modal-header"],["id","modal-basic-title",1,"modal-title","d-flex","align-items-center","gap-1"],[1,"ki-duotone","ki-handcart","text-white","me-2","fs-2hx",2,"vertical-align","middle"],[1,"path1"],[1,"path2"],[1,"path3"],["type","button","aria-label","Close",1,"btn","btn-sm","btn-icon","btn-active-color-primary","btn-color-gray-800",3,"click"],[1,"ki-duotone","ki-cross-square","fs-1"],[1,"modal-body","text-center"],[1,"col-mb-4","mb-3"],["bindLabel","name","bindValue","id","placeholder","Selecciona un usuario",3,"change","items","loading","loadingText","notFoundText","compareWith"],["bindLabel","nombre","bindValue","id","placeholder","Selecciona un paciente",3,"change","items","loading","loadingText","notFoundText"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["class","spinner-border spinner-border-sm align-middle ms-2",4,"ngIf"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"h4",1)(2,"span")(3,"i",2),l(4,"span",3)(5,"span",4)(6,"span",5),i()(),o(7," Adquirir Paquete "),i(),r(8,"button",6),m("click",function(){return n.close()}),r(9,"i",7),l(10,"span",3)(11,"span",4),i()()(),r(12,"div",8)(13,"p"),o(14,"\xBFEst\xE1s seguro de comprar este Paquete?"),i(),r(15,"p"),o(16,"Selecciona el usuario y luego el paciente que desees para continuar con la compra."),i(),r(17,"div",9)(18,"ng-select",10),f(19,"async"),f(20,"async"),m("change",function(u){return n.onUserSelect(u)}),i()(),r(21,"div",9)(22,"ng-select",11),f(23,"async"),f(24,"async"),m("change",function(u){return n.onPacienteSelect(u)}),i()()(),r(25,"div",12)(26,"button",13),m("click",function(){return n.close()}),o(27," Cancelar "),i(),r(28,"button",14),f(29,"async"),m("click",function(){return n.purchase()}),o(30," Comprar "),_(31,He,1,0,"span",15),f(32,"async"),i()()),t&2&&(p(18),c("items",h(19,11,n.usuariosList))("loading",h(20,13,n.isLoading))("loadingText","Cargando..")("notFoundText","Sin resultados")("compareWith",n.compareUsers),p(4),c("items",h(23,15,n.pacientesList))("loading",h(24,17,n.isLoading))("loadingText","Cargando..")("notFoundText","Sin resultados"),p(6),c("disabled",h(29,19,n.isLoading)||!n.selectedUser||!n.selectedPaciente),p(3),c("ngIf",h(32,21,n.isLoading)))},dependencies:[N,ke,F,y,E,G,j]})}};le=w([D({checkProperties:!0}),L("design:paramtypes",[q])],le);var Je=b=>({"img-inventory":b});function We(b,e){b&1&&(r(0,"div",21)(1,"div",22)(2,"span",23),o(3,"Cargando..."),i()()())}function Ke(b,e){if(b&1){let t=A();r(0,"div",24)(1,"div",25)(2,"div",26)(3,"div",27)(4,"button",28),m("click",function(){let a=g(t).$implicit,u=Q();return v(u.openEditarModal(a))}),l(5,"span",29),i(),r(6,"button",30),m("click",function(){let a=g(t).$implicit,u=Q();return v(u.openBorrarModal(a))}),l(7,"span",31),i()(),r(8,"div",32),l(9,"img",33),i()(),r(10,"div",34)(11,"h5",35),o(12),i(),r(13,"p",36)(14,"strong"),o(15,"Terapias:"),i(),o(16),i(),r(17,"p",36)(18,"strong"),o(19,"N\xB0 de Sesiones:"),i(),o(20),i(),r(21,"p",36),o(22),i(),r(23,"p",36)(24,"strong"),o(25),i()(),r(26,"button",37),m("click",function(){let a=g(t).$implicit,u=Q();return v(u.openComprarModal(a))}),l(27,"span",38),o(28," Vender "),i()()()()}if(b&2){let t=e.$implicit,n=Q();p(9),de("src",t.banner_url!=null&&t.banner_url.includes("default.png")?n.banner_url:t.banner_url,_e),de("alt",t.nombre),c("ngClass",ye(8,Je,t.banner_url==null?null:t.banner_url.includes("default.png"))),p(3),ce(t.nombre),p(4),z(" ",n.getTerapiasNombres(t.terapias),""),p(4),z(" ",t.cantidadsesiones,""),p(2),ce(t.descripcion),p(3),z("$",t.preciopaquete,"")}}var Re=class be{constructor(){this.paquetesService=d(I),this.isLoading=d(x).isLoading,this.theme=d(xe),this.modal=d(k),this.banner_url="https://cdn-icons-png.flaticon.com/512/9573/9573235.png",this.paquetesList=new P,this.localeText=Pe}ngOnInit(){this.fetchPaquetes()}fetchPaquetes(){this.paquetesList=this.paquetesService.getAll().pipe(M(e=>(console.log("Paquetes recibidos:",e.data),e.data)),V(this))}loadTabla(){this.fetchPaquetes()}gridReady(e){this.gridApi=e.api}onFilterTextBoxChanged(){this.gridApi.setGridOption("quickFilterText",document.getElementById("paquete-search").value)}openCrearModal(){this.modal.open(ne,{size:"350px",animation:!0,centered:!0}).componentInstance.onSaveComplete.subscribe(()=>{this.fetchPaquetes()})}getTerapiasNombres(e){return e.map(t=>t.nombre).join(", ")}openEditarModal(e){let t=this.modal.open(ae);t.componentInstance.paqueteId=e.id_paquetes,t.componentInstance.onSaveComplete.subscribe(()=>{this.fetchPaquetes()})}openBorrarModal(e){if(!e.id_paquetes){console.error("El paquete no tiene un id_paquete definido.");return}let t=this.modal.open(Ae,{size:"300px",animation:!0,centered:!0});t.componentInstance.paqueteId=e.id_paquetes,t.componentInstance.onSaveComplete.subscribe(()=>{this.fetchPaquetes()})}openComprarModal(e){console.log("Paquete seleccionado:",e);let t=this.modal.open(le,{size:"300px",animation:!0,centered:!0});t.componentInstance.paqueteId=e.id_paquetes}ngOnDestroy(){}static{this.\u0275fac=function(t){return new(t||be)}}static{this.\u0275cmp=S({type:be,selectors:[["app-paquetes"]],standalone:!0,features:[C],decls:28,vars:6,consts:[["header-title",""],[1,"d-flex","flex-column","text-gray-900","fw-bold","my-1"],[2,"color","white"],[1,"content","d-flex","flex-column","flex-column-fluid"],[1,"container-xxl"],[1,"d-flex","py-4","justify-content-between","align-items-center"],["data-kt-search-element","form","autocomplete","off",1,"position-relative"],["type","hidden"],[1,"ki-duotone","ki-magnifier","fs-2","search-icon","position-absolute","top-50","translate-middle-y","ms-4"],["type","search","id","paquete-search","name","search","placeholder","B\xFAsqueda","data-kt-search-element","input",1,"form-control","custom-form-control","ps-13",3,"input"],[1,"d-flex","align-items-center","gap-3"],["type","button",1,"btn","btn-light-primary",3,"click"],[1,"d-flex","align-items-center"],[1,"fa-solid","fa-rotate-right"],[1,"ms-2"],["type","button",1,"btn","btn-primary",3,"click"],[1,"ki-solid","ki-plus","text-white","fs-1"],[1,"text-white","ms-2"],["class","loading-container d-flex justify-content-center align-items-center",4,"ngIf"],[1,"row","justify-content-center"],["class","col-md-4",4,"ngFor","ngForOf"],[1,"loading-container","d-flex","justify-content-center","align-items-center"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"col-md-4"],[1,"card","border-1","border-gray-300","mb-4",2,"width","22rem","padding","5px"],[1,"position-relative",2,"padding-top","40px"],[1,"action-buttons",2,"position","absolute","top","0","right","10px","z-index","1"],["type","button",1,"btn","btn-icon","btn-sm","bg-success",2,"margin-right","5px",3,"click"],[1,"ki-solid","ki-pencil","text-white"],["type","button",1,"btn","btn-icon","btn-sm","btn-danger",3,"click"],[1,"ki-solid","ki-trash","text-white"],[1,"image-container",2,"border-radius","8px","overflow","hidden"],[1,"card-img-top",2,"width","100%","height","auto",3,"src","ngClass","alt"],[1,"card-body"],[1,"card-title"],[1,"card-text"],["type","button",1,"btn","btn-primary","btn-lg","w-100","d-flex","justify-content-center","align-items-center",3,"click"],[1,"ki-duotone","ki-handcart","text-white","me-2"]],template:function(t,n){t&1&&(r(0,"app-header"),Se(1,0),r(2,"h1",1)(3,"span",2),o(4,"Paquetes"),i()(),Ce(),i(),r(5,"div",3)(6,"div",4)(7,"div",5)(8,"form",6),l(9,"input",7)(10,"i",8),r(11,"input",9),m("input",function(){return n.onFilterTextBoxChanged()}),i()(),r(12,"div",10)(13,"button",11),m("click",function(){return n.loadTabla()}),r(14,"span",12),l(15,"span",13),r(16,"span",14),o(17,"Actualizar"),i()()(),r(18,"button",15),m("click",function(){return n.openCrearModal()}),r(19,"span",12),l(20,"span",16),r(21,"span",17),o(22,"A\xF1adir"),i()()()()(),_(23,We,4,0,"div",18),f(24,"async"),r(25,"div",19),_(26,Ke,29,10,"div",20),f(27,"async"),i()()()),t&2&&(p(23),c("ngIf",h(24,2,n.isLoading)),p(3),c("ngForOf",h(27,4,n.paquetesList)))},dependencies:[F,Ee,Fe,y,E,Ie]})}};Re=w([D()],Re);export{Re as PaquetesComponent};
