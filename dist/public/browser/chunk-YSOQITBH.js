import{a as Ie,b as Ne,c as Oe,d as Ve,e as We,f as X}from"./chunk-MRY44RQF.js";import{a as Le}from"./chunk-Q4VFHCA5.js";import{ib as Ae,jb as Re,lb as Be,mb as Ge}from"./chunk-DTQJYYMN.js";import{a as Q}from"./chunk-TWOZQJ7G.js";import{a as Pe,c as Me}from"./chunk-SGWZHZFB.js";import{a as qe}from"./chunk-3LUZQXRF.js";import"./chunk-DUBUW4ZU.js";import{a as Je}from"./chunk-U5GNHINA.js";import{a as we}from"./chunk-3YJPJYYE.js";import{c as Ee,d as U}from"./chunk-VW7FZU7U.js";import{a as Fe,b as De}from"./chunk-WAKZQXFB.js";import"./chunk-GT4JH6HJ.js";import{a as H,b as D}from"./chunk-73QAVBZN.js";import{a as j}from"./chunk-C4LB5HPP.js";import{b as B,c as ye,d as Te,g as G,h as ke,j as xe}from"./chunk-FR665RP3.js";import{e as fe,f as C,g as ge,h as _e,l as be,o as ve,r as Ce,u as R,w as Se}from"./chunk-O36CONK3.js";import{e as O,f as me,g as ue,j as V,l as W,t as A,v as he}from"./chunk-FM6AGUVW.js";import{$c as N,B as M,C as L,Da as q,Ec as I,Gc as ce,Hc as pe,I as _,Kb as T,Kc as u,Lc as h,Na as $,Oa as K,Ob as ae,Rb as ne,Tb as p,Wa as Y,Y as ee,a as w,ac as r,b as P,ba as te,bc as a,ca as ie,cc as m,dc as re,ea as x,ec as oe,f as ze,gc as Z,ma as J,mc as b,nc as v,sc as le,t as S,tc as se,uc as de,wb as c,wc as l,xb as E,yc as F,za as d}from"./chunk-6QDZBSPE.js";var je=ze(Je());var Ye=(s,i)=>({"btn-active-primary active":s,"cursor-not-allowed":i});function Ze(s,i){if(s&1){let t=Z();r(0,"div",12)(1,"label",17),l(2,"Seleccionar Paquete"),a(),r(3,"ng-select",32),u(4,"async"),b("change",function(n){$(t);let o=v();return K(o.changePaquete(n))}),a()()}if(s&2){let t=v();c(3),p("items",h(4,3,t.paquetesList))("loading",t.loadingPaquetes)("loadingText","Cargando...")}}function Xe(s,i){if(s&1){let t=Z();r(0,"button",37),b("click",function(){let n=$(t).$implicit,o=v(2);return K(o.toggleOption(n))}),l(1),a()}if(s&2){let t=i.$implicit,e=v(2);p("disableTooltip",e.isEnabledDay(t))("disabled",!e.isEnabledDay(t))("ngClass",pe(4,Ye,e.isOptionSelected(t),!e.isEnabledDay(t))),c(),F(" ",t.label," ")}}function et(s,i){if(s&1&&(r(0,"div",11)(1,"div",33)(2,"label",34),l(3,"Dias Disponibles"),a(),r(4,"div",35),T(5,Xe,2,7,"button",36),a()()()),s&2){let t=v();c(5),p("ngForOf",t.options)}}var f,z=(f=class{constructor(i){this.fb=i,this.modal=d(B),this.toast=d(Pe),this.sedesService=d(Le),this.personalService=d(Me),this.pacienteService=d(we),this.tipoCitaService=d(Be),this.terapiaService=d(G),this.paquetesService=d(qe),this.isLoading=d(j).isLoading,this.citaService=d(Q),this.eventSubmitted=new Y,this.eventDeleted=new Y,this.es=je.default.es,this.isRecurrente=!1,this.isCitaPaquete=!1,this.sedesList=new S,this.pacientesList=new S,this.personalList=[],this.tipoCitasList=new S,this.paquetesList=new S,this.loadingPacientes=!1,this.loadingSedes=!1,this.loadingPaquetes=!1,this.loadingTipoCitas=!1,this.timeOptions={enableTime:!0,noCalendar:!0,dateFormat:"H:i"},this.options=[{label:"L",value:1},{label:"M",value:2},{label:"MI",value:3},{label:"J",value:4},{label:"V",value:5},{label:"S",value:6}],this.isEnabledDay=t=>{let e=this.createForm.get("id_personal")?.value,n=this.createForm.get("hora_inicio")?.value,o=this.createForm.get("hora_fin")?.value;return this.personalList.some(y=>y.horarios?.some(k=>k.hora_inicio.substring(0,5)<=n&&k.hora_fin.substring(0,5)>=o&&k.dia_semana===t.value&&y.id_personal===e))},this.isOptionSelected=t=>{let e=this.createForm.get("fecha_inicio")?.value,n=new Date(e).getDay()+1,o=this.createForm.get("recurrencia");return o.value.includes(n)||(console.log(n),o.push(this.fb.control(n))),t.value===n?!0:o.value.includes(t.value)&&this.isEnabledDay(t)},this.createForm=this.fb.group({id_sede:[null,C.required],id_paciente:[null,C.required],id_personal:[null,C.required],id_tipocita:[null,C.required],id_paquete:[null],fecha_inicio:[null,C.required],hora_inicio:[null,C.required],hora_fin:[null,C.required],descripcion:[null],paquete:[null],num_sesiones:[null],recurrencia:this.fb.array([])})}onChangeSede(i){this.createForm.get("id_personal")?.setValue(null)}onStartTimeChange(i){let[t,e]=i.dateString.split(":").map(Number),n=new Date;n.setHours(t,e+5),this.createForm.get("hora_fin").setValue(n.toTimeString().slice(0,5))}changePaquete(i){this.createForm.get("num_sesiones").setValue(i?.cantidadsesiones)}toggleOption(i){let t=this.createForm.get("fecha_inicio")?.value,e=this.createForm.get("recurrencia"),n=new Date(t).getDay()+1;i.value!==n&&(e.value.includes(i.value)?e.removeAt(e.value.indexOf(i.value)):e.push(this.fb.control(i.value)))}closeModal(){this.modal.dismissAll()}changeTipoCita(i){this.isRecurrente=i&&i?.recurrente,this.isCitaPaquete=i&&i?.nombre==="Paquete"}ngOnInit(){this.loadSedes(),this.loadPacientes(),this.loadTipoCitas(),this.loadPaquetes()}ngAfterViewInit(){this.createForm.valueChanges.pipe(ie("id_sede")).subscribe(i=>{let{id_sede:t,fecha_inicio:e,hora_inicio:n,hora_fin:o,id_personal:y}=i,k=[t,e,n,o],Ue={id_sede:t,fecha_inicio:e,hora_inicio:n,hora_fin:o,id_terapia:this.terapia.id_terapia};k.every(Boolean)?this.citaService.getAvailablePersonal(Ue).pipe(ee(500)).subscribe(Qe=>{this.personalList=Qe.data}):(this.personalList=[],this.createForm.get("id_personal")?.setValue(null))})}loadSedes(){this.loadingSedes=!0,this.sedesList=this.sedesService.getAll().pipe(_(i=>i.data),x(()=>this.loadingSedes=!1),D(this))}loadTipoCitas(){this.loadingTipoCitas=!0,this.tipoCitasList=this.tipoCitaService.getAll().pipe(_(i=>i.data),x(()=>this.loadingTipoCitas=!1),D(this))}loadPaquetes(){this.loadingPaquetes=!0,this.paquetesList=this.terapiaService.getPaquetesByTerapia(this.terapia.id_terapia).pipe(_(i=>i.data),x(()=>this.loadingPaquetes=!1),D(this))}loadPacientes(){this.loadingPacientes=!0,this.pacientesList=this.pacienteService.getAll().pipe(_(i=>i.data),x(()=>this.loadingPacientes=!1),D(this))}createCita(){this.createForm.valid&&this.citaService.createForTherapy(P(w({},this.createForm.value),{id_terapia:this.terapia.id_terapia})).subscribe({next:()=>{this.eventSubmitted.emit(),this.closeModal()},error:i=>{if(i.error.errors){let t=Object.values(i.error.errors).join(`
`);this.toast.error(t,"Error")}else this.toast.error("Ocurri\xF3 un error al crear la cita","Error")}})}},f.\u0275fac=function(t){return new(t||f)(E(R))},f.\u0275cmp=q({type:f,selectors:[["app-crear-modal"]],outputs:{eventSubmitted:"eventSubmitted",eventDeleted:"eventDeleted"},standalone:!0,features:[I],decls:62,vars:31,consts:[[1,"modal-header"],[1,"modal-title"],[1,"text-primary"],[1,"ki-duotone","ki-add-files","text-gray-900","fs-1",2,"vertical-align","text-top"],[1,"path1"],[1,"path2"],[1,"path3"],["type","button","aria-label","Close",1,"btn","btn-sm","btn-icon","btn-active-color-primary","btn-color-gray-800",3,"click"],[1,"ki-duotone","ki-cross-square","fs-1"],[1,"modal-body"],[1,"form","d-flex","flex-column","gap-4",3,"formGroup"],[1,"row"],[1,"form-group","col-6"],["for","kt_calendar_datepicker_date",1,"form-label"],["bindValue","id_paciente","placeholder","Seleccionar","bindLabel","nombre","formControlName","id_paciente",3,"items","loading","loadingText"],[1,"form-label"],["bindValue","id_tipocita","placeholder","Seleccionar","bindLabel","nombre","formControlName","id_tipocita",3,"change","items","loading","loadingText"],["for","",1,"form-label"],["bindValue","id_sede","placeholder","Seleccionar Sede","bindLabel","nombre","formControlName","id_sede",3,"change","items","loading","loadingText"],["class","form-group col-6",4,"ngIf"],[1,"form-group","col","mb-3"],["type","text","id","kt_calendar_datepicker_date","formControlName","fecha_inicio","mwlFlatpickr","","readonly","","placeholder","Seleccionar Fecha(s)",1,"form-control",3,"noCalendar","altInput","altFormat"],["for","kt_calendar_datepicker_start_time",1,"form-label"],["type","text","id","kt_calendar_datepicker_start_time","formControlName","hora_inicio","readonly","","placeholder","Seleccionar Hora de Inicio",1,"form-control"],["for","kt_calendar_datepicker_end_time",1,"form-label"],["type","text","id","kt_calendar_datepicker_end_time","formControlName","hora_fin","readonly","","placeholder","Seleccionar Hora de Fin",1,"form-control"],["type","text","readonly","",1,"form-control",3,"value"],["bindValue","id_personal","placeholder","Seleccionar","bindLabel","nombre","formControlName","id_personal",3,"items","loading","loadingText"],["class","row",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-light",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["bindValue","id_paquetes","placeholder","Seleccionar Paquete","bindLabel","nombre","formControlName","id_paquete",3,"change","items","loading","loadingText"],[1,"form-group","d-flex","flex-column","col","mb-3"],["for","kt_calendar_datepicker_end_date",1,"form-label"],[1,"btn-group"],["ngbTooltip","No Disponible","placement","bottom","class","btn btn-outline",3,"disableTooltip","disabled","ngClass","click",4,"ngFor","ngForOf"],["ngbTooltip","No Disponible","placement","bottom",1,"btn","btn-outline",3,"click","disableTooltip","disabled","ngClass"]],template:function(t,e){if(t&1&&(r(0,"div",0)(1,"h4",1)(2,"span",2)(3,"i",3),m(4,"span",4)(5,"span",5)(6,"span",6),a()(),l(7),a(),r(8,"button",7),b("click",function(){return e.closeModal()}),r(9,"i",8),m(10,"span",4)(11,"span",5),a()()(),r(12,"div",9)(13,"form",10)(14,"section",11)(15,"div",12)(16,"label",13),l(17,"Seleccionar Paciente"),a(),m(18,"ng-select",14),u(19,"async"),a(),r(20,"div",12)(21,"label",15),l(22,"Seleccionar Tipo de Cita"),a(),r(23,"ng-select",16),u(24,"async"),b("change",function(o){return e.changeTipoCita(o)}),a()()(),r(25,"section",11)(26,"div",12)(27,"label",17),l(28,"Seleccionar Sede"),a(),r(29,"ng-select",18),u(30,"async"),b("change",function(o){return e.onChangeSede(o)}),a()(),T(31,Ze,5,5,"div",19),a(),r(32,"div",11)(33,"div",20)(34,"label",13),l(35,"Fecha"),a(),m(36,"input",21),a(),r(37,"div",20)(38,"label",22),l(39,"Hora de Inicio"),a(),m(40,"input",23),a(),r(41,"div",20)(42,"label",24),l(43,"Hora de Fin"),a(),m(44,"input",25),a()(),r(45,"div",11)(46,"div",12)(47,"label",17),l(48,"Terapia Asignada"),a(),m(49,"input",26),a(),r(50,"div",12)(51,"label",17),l(52,"Seleccionar Terapista Disponible"),a(),m(53,"ng-select",27),u(54,"async"),a()(),T(55,et,6,1,"div",28),a()(),r(56,"div",29)(57,"button",30),b("click",function(){return e.closeModal()}),l(58,"Cancelar"),a(),r(59,"button",31),u(60,"async"),b("click",function(){return e.createCita()}),l(61,"Registrar"),a()()),t&2){let n;c(7),F(" Registrar Cita de ",e.terapia==null?null:e.terapia.nombre," "),c(6),p("formGroup",e.createForm),c(5),p("items",h(19,21,e.pacientesList))("loading",e.loadingPacientes)("loadingText","Cargando..."),c(5),p("items",h(24,23,e.tipoCitasList))("loading",e.loadingTipoCitas)("loadingText","Cargando..."),c(6),p("items",h(30,25,e.sedesList))("loading",e.loadingSedes)("loadingText","Cargando..."),c(2),p("ngIf",e.isCitaPaquete),c(5),p("noCalendar",!0)("altInput",!0)("altFormat","d/m/Y"),c(13),p("value",e.terapia==null?null:e.terapia.nombre),c(4),p("items",e.personalList)("loading",h(54,27,e.isLoading))("loadingText","Cargando..."),c(2),p("ngIf",((n=e.createForm.get("id_personal"))==null?null:n.value)&&e.isRecurrente),c(4),p("disabled",e.createForm.invalid||h(60,29,e.isLoading))}},dependencies:[U,Ee,Te,ye,W,O,me,ue,V,Se,be,fe,ge,_e,ve,Ce,De,Fe]}),f);z=M([H({checkProperties:!0}),L("design:paramtypes",[R])],z);var tt=["calendar"],it=()=>[Ae,O,V],at=s=>({"opacity-50":s});function nt(s,i){if(s&1&&(m(0,"full-calendar",10,0),u(2,"async"),u(3,"async")),s&2){let t=v();p("ngClass",ce(7,at,h(2,3,t.isLoading)))("events",h(3,5,t.citasEvent))("options",t.calendarOptions)}}function rt(s,i){s&1&&(r(0,"h1"),l(1,"Loading..."),a())}var g,He=(g=class{get bodyParams(){return{id_terapia:this.terapiaId,startWeek:this.startWeek,endWeek:this.endWeek}}constructor(i,t){this.route=i,this.changeDetector=t,this.citasService=d(Q),this.modalService=d(B),this.isLoading=d(j).isLoading,this.terapiasService=d(G),this.router=d(he),this.terapiaId=this.route.snapshot.params.tag,this.loading=!0,this.startWeek=X().startOfWeek,this.endWeek=X().endOfWeek,this.citasEvent=new S,this.calendarOptions={plugins:[Ie,Ne,Oe,Ve],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},initialView:"timeGridWeek",allDaySlot:!1,expandRows:!0,slotLabelInterval:"00:05:00",slotMinTime:"08:00",slotMaxTime:"20:00:00",slotLabelFormat:{hour:"numeric",minute:"2-digit",omitZeroMinute:!1,meridiem:"narrow"},selectAllow:e=>{let n=new Date,o=this.calendar?.getApi()?.view.type=="timeGridWeek",y=new Date(n.setDate(n.getDate()-n.getDay()+1));return y.setHours(0,0,0,0),e.start>=y&&o},selectable:!0,selectLongPressDelay:10,weekends:!0,editable:!0,selectMirror:!0,dayMaxEvents:!0,eventTimeFormat:{hour:"numeric",minute:"2-digit",meridiem:"short"},eventClick:this.handleEventClick.bind(this),loading:e=>{this.loading=e},locale:We,select:this.handleDateSelect.bind(this),datesSet:e=>{this.startWeek=e.view.activeStart,this.endWeek=e.view.activeEnd,this.loadCitas(this.bodyParams)}},this.route.params.subscribe(()=>{this.startWeek=this.calendar?.getApi()?.view.activeStart,this.endWeek=this.calendar?.getApi()?.view.activeEnd})}ngOnInit(){this.route.params.pipe(J(({tag:i})=>this.terapiaId=i)).subscribe(i=>{this.loadCurrentTerapia(),this.loadCitas(this.bodyParams)})}handleDateSelect(i){let t=this.modalService.open(z,{size:"lg",centered:!0});t.componentInstance.terapia=this.currentTerapia,t.componentInstance.createForm.patchValue({fecha_inicio:i.startStr.substring(0,10),hora_inicio:i.startStr.substring(11,16),hora_fin:i.endStr.substring(11,16)}),t.componentInstance.eventSubmitted.subscribe(()=>{this.loadCitas(this.bodyParams)})}handleEventClick(i){let t=i.event,e=this.modalService.open(Ge,{centered:!0,size:"100",scrollable:!0,backdrop:"static"});window.document.body.classList.add("modal-open"),e.componentInstance.eventId=t.id,e.componentInstance.citaId=t.extendedProps.id_cita,e.componentInstance.eventUpdated.subscribe(()=>{this.loadCitas(this.bodyParams)})}loadCitas(i){if(this.terapiaId)return this.citasEvent=this.citasService.getByTerapia(i).pipe(te((t,e)=>JSON.stringify(t)===JSON.stringify(e)),_(t=>t.data))}loadCurrentTerapia(){return this.terapiasService.getById(this.terapiaId).pipe(_(i=>this.currentTerapia=i.data),J(()=>this.calendarOptions=P(w({},this.calendarOptions),{slotDuration:this.currentTerapia?.duracion}))).subscribe()}},g.\u0275fac=function(t){return new(t||g)(E(A),E(N))},g.\u0275cmp=q({type:g,selectors:[["app-cronograma"]],viewQuery:function(t,e){if(t&1&&le(tt,5),t&2){let n;se(n=de())&&(e.calendar=n.first)}},standalone:!0,features:[I],decls:16,vars:1,consts:[["calendar",""],["header-title",""],[1,"d-flex","flex-column","text-white","fw-bold","my-1"],[1,"content","d-flex","flex-column","flex-column-fluid"],["id","kt_content_container",1,"container-xxl"],[1,"card"],[1,"card-header"],[1,"card-toolbar","d-flex","ms-auto","justify-content-end"],[1,"card-body",2,"border","none","box-shadow","0 4px 8px rgba(0, 0, 0, 0.1)","border-radius","0 0 15px 15px"],[1,"demo-app-main"],[3,"ngClass","events","options"]],template:function(t,e){t&1&&(r(0,"app-header"),re(1,1),r(2,"h1",2),l(3),a(),oe(),a(),r(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6)(8,"div",7),m(9,"app-dropdown"),a()(),r(10,"div",8)(11,"div",9),T(12,nt,4,9)(13,rt,2,0),ae(14,12,it,null,13),ne(0,-1),a()()()()()),t&2&&(c(3),F(" ",e.currentTerapia==null?null:e.currentTerapia.nombre," "))},dependencies:[Re,W,xe,U,ke]}),g);He=M([H({checkProperties:!0}),L("design:paramtypes",[A,N])],He);export{He as CronogramaComponent};
