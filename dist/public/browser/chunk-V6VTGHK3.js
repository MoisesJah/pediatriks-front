import{a as w,b as ae}from"./chunk-O3YCT3LC.js";import{a as ie}from"./chunk-ZCULIXAH.js";import{a as te}from"./chunk-TS646TIG.js";import"./chunk-EBZKSOFQ.js";import{c as Y}from"./chunk-I3M22XFA.js";import{a as A}from"./chunk-FMZGRIZ6.js";import{o as k}from"./chunk-KLLKZ3UM.js";import"./chunk-MGQU4BYR.js";import{a as ne}from"./chunk-UZO5QNZS.js";import{c as Z,d as $}from"./chunk-XKOQY6PJ.js";import{a as ee}from"./chunk-U2EAJGNN.js";import{a as D}from"./chunk-RQ4VGEOD.js";import{a as T,b as X}from"./chunk-PIACHCSP.js";import{a as W}from"./chunk-J6P2CT7J.js";import"./chunk-GKZUPR7X.js";import"./chunk-APQUY7ND.js";import{m as y,o as K,t as x,u as Q,w as S}from"./chunk-JS4ZJV2L.js";import{Ba as C,C as q,Fc as s,Hc as F,Ic as U,La as H,Ma as M,Mb as f,Oc as b,Qb as O,Qc as v,Sb as j,Ua as V,Vb as m,Vc as h,Wc as g,Xc as J,aa as N,ac as G,fc as i,gc as n,hc as c,ic as P,jc as z,lc as B,n as R,uc as d,v as _,vc as u,wb as l,xa as r}from"./chunk-B762IU3Y.js";var ce=o=>({"mb-3":o});function me(o,e){if(o&1&&(i(0,"div",15)(1,"div",17)(2,"div",18)(3,"i",19),c(4,"span",4)(5,"span",5)(6,"span",11),n(),i(7,"span"),s(8),n()()()()),o&2){let t=u();l(8),F("Asistencia despu\xE9s de ",t.todayHorario," se marcar\xE1 como tarde")}}var E=class I{constructor(){this.showBanner=!1,this.modal=r(k),this.asistenciaService=r(w),this.tosat=r(te),this.auth=r(A).user()?.personal,this.isLoading=r(D).isLoading,this.onRequestComplete=new V,this.todayHorario="",this.currentDate=new Date}close(){this.modal.dismissAll()}confirmAsistencia(){this.asistenciaService.create({id_personal:this.auth?.id_personal,fecha:this.currentDate,hora_asistencia:this.currentDate.toTimeString().slice(0,8),id_status:this.showBanner?2:1}).subscribe({next:()=>{this.onRequestComplete.emit(),this.close()},error:e=>{if(e.error.errors){let t=Object.values(e.error.errors).join(`
`);this.tosat.error(t,"Error")}else this.tosat.error("Ocurrio un error al crear la asistencia","Error")}})}static{this.\u0275fac=function(t){return new(t||I)}}static{this.\u0275cmp=C({type:I,selectors:[["app-check-asistencia"]],outputs:{onRequestComplete:"onRequestComplete"},standalone:!0,features:[b],decls:29,vars:13,consts:[[1,"modal-header"],["id","modal-basic-title",1,"modal-title","d-flex","align-items-center","gap-1"],[1,"text-primary"],[1,"ki-duotone","ki-time","text-gray-900","fs-2x",2,"vertical-align","text-top"],[1,"path1"],[1,"path2"],["type","button","aria-label","Close",1,"btn","btn-sm","btn-icon","btn-active-color-primary","btn-color-gray-800",3,"click"],[1,"ki-duotone","ki-cross-square","fs-1"],[1,"modal-body"],[1,"d-flex","gap-3","alert","alert-primary","rounded","align-items-center"],[1,"ki-duotone","ki-timer","text-primary","fs-3x"],[1,"path3"],[1,"d-flex","flex-column","gap-2",3,"ngClass"],[1,"d-flex","fs-5","align-items-center","gap-2"],[1,"fw-bold","fs-3"],[1,"alert","alert-warning","rounded"],["type","button",1,"btn","btn-success","w-100",3,"click","disabled"],[1,"d-flex","fs-6","gap-3","align-items-start"],[1,"d-flex","gap-3"],[1,"ki-duotone","ki-information","text-warning","fs-1"]],template:function(t,a){t&1&&(i(0,"div",0)(1,"h4",1)(2,"span",2)(3,"i",3),c(4,"span",4)(5,"span",5),n()(),s(6," Confirmar Asistencia "),n(),i(7,"button",6),d("click",function(){return a.close()}),i(8,"i",7),c(9,"span",4)(10,"span",5),n()()(),i(11,"div",8)(12,"div",9)(13,"i",10),c(14,"span",4)(15,"span",5)(16,"span",11),n(),i(17,"div",12)(18,"span",13)(19,"strong"),s(20,"Hora Actual:"),n(),s(21),h(22,"date"),n(),i(23,"span",14),s(24),n()()(),f(25,me,9,1,"div",15),i(26,"button",16),h(27,"async"),d("click",function(){return a.confirmAsistencia()}),s(28,"Marcar Asistencia"),n()()),t&2&&(l(17),m("ngClass",v(11,ce,!a.showBanner)),l(4),F(" ",J(22,6,a.currentDate,"HH:mm")," "),l(3),U("",a.auth==null?null:a.auth.nombre," \u2022 ",a.auth==null?null:a.auth.terapia.nombre,""),l(),G(a.showBanner?25:-1),l(),m("disabled",g(27,9,a.isLoading)))},dependencies:[S,y,x,Q]})}};E=_([T()],E);var de=()=>[x,Z],pe=o=>[o];function ue(o,e){if(o&1){let t=B();i(0,"button",19),d("click",function(){H(t);let p=u();return M(p.openConfirmModal())}),s(1,"Marcar Asistencia"),n()}if(o&2){let t=u();m("disabled",t.loadingHorario)}}function he(o,e){if(o&1){let t=B();i(0,"ag-grid-angular",20),h(1,"async"),h(2,"async"),d("gridReady",function(p){H(t);let re=u();return M(re.gridReady(p))}),n()}if(o&2){let t=u();m("rowData",g(1,7,t.asistenciaList))("columnDefs",t.colDefs)("enableCellTextSelection",!0)("localeText",t.localeText)("ariaHidden",!0)("pagination",!0)("loading",g(2,9,t.isLoading))}}function fe(o,e){o&1&&(i(0,"div",21)(1,"div",22)(2,"span",23),s(3,"Loading..."),n()()())}var oe=class L{constructor(){this.personalService=r(ie),this.horarios=[],this.auth=r(A).user()?.personal,this.asistenciaService=r(w),this.isLoading=r(D).isLoading,this.theme=r(W),this.modal=r(k),this.asistenciaList=new R,this.loadingHorario=!1,this.btnVisible=!0,this.localeText=ee,this.colDefs=[{headerName:"Fecha",field:"fecha",filter:"agDateColumnFilter",valueFormatter:e=>ne(e.value)},{headerName:"Hora de Marcado",field:"hora_asistencia",filter:"agDateColumnFilter"},{field:"status.nombre",headerName:"Status",filter:!0,cellRenderer:ae}],this.currentDay=new Date().getDay()}ngOnInit(){this.getHorarios(),this.getAsistencia()}loadTabla(){this.getAsistencia()}gridReady(e){this.gridApi=e.api}onFilterTextBoxChanged(){this.gridApi.setGridOption("quickFilterText",document.getElementById("asistencia-search").value)}getAsistencia(){this.asistenciaList=this.asistenciaService.getByPersonal(this.auth?.id_personal).pipe(q(e=>e.data))}getHorarios(){this.loadingHorario=!0,this.personalService.getHorario(this.auth?.id_personal).pipe(N(()=>this.loadingHorario=!1),X(this)).subscribe(e=>{this.horarios=e.data})}get showBanner(){return this.horarios?.some(e=>e.dia_semana===this.currentDay&&this.convertTimeToMinutes(e.hora_inicio)<this.convertTimeToMinutes(new Date().toTimeString().slice(0,5)))}get todayHorario(){return(this.horarios?.find(t=>t.dia_semana===this.currentDay)).hora_inicio}convertTimeToMinutes(e){let[t,a]=e.split(":").map(Number);return t*60+a}get isCurrentDayInSchedule(){return this.horarios?.some(e=>e.dia_semana===this.currentDay)}openConfirmModal(){let e=this.modal.open(E,{centered:!0,scrollable:!0,backdrop:"static"});e.componentInstance.todayHorario=this.todayHorario,e.componentInstance.showBanner=this.showBanner,e.componentInstance.onRequestComplete.subscribe(()=>{this.btnVisible=!1,this.getAsistencia()})}static{this.\u0275fac=function(t){return new(t||L)}}static{this.\u0275cmp=C({type:L,selectors:[["app-asistencia"]],standalone:!0,features:[b],decls:26,vars:4,consts:[["header-title",""],[1,"d-flex","align-items-center","text-white","fw-bold","my-1"],[1,"content","d-flex","flex-column","flex-column-fluid"],[1,"container-xxl"],[1,"card","shadow","p-2","px-4"],[1,"d-flex","py-4","justify-content-between","align-items-center"],["data-kt-search-element","form","autocomplete","off",1,"position-relative"],["type","hidden"],[1,"ki-duotone","ki-magnifier","fs-2","search-icon","position-absolute","top-50","translate-middle-y","ms-4"],[1,"path1"],[1,"path2"],["type","search","id","asistencia-search","name","search","value","","placeholder","B\xFAsqueda","data-kt-search-element","input",1,"form-control","custom-form-control","ps-13",3,"input"],[1,"d-flex","align-items-center","gap-3"],["type","button","class","btn btn-secondary",3,"disabled","click",4,"ngIf"],["type","button",1,"btn","btn-light-primary",3,"click"],[1,"d-flex","align-items-center"],[1,"fa-solid","fa-rotate-right"],[1,"ms-2"],[2,"height","calc(100dvh - 281px)",3,"ngClass"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],["loadingMessage","Cargando...",2,"width","100%","height","100%",3,"gridReady","rowData","columnDefs","enableCellTextSelection","localeText","ariaHidden","pagination","loading"],[1,"d-flex","justify-content-center","align-items-center",2,"height","100%"],["role","status",1,"spinner-border"],[1,"visually-hidden"]],template:function(t,a){t&1&&(i(0,"app-header"),P(1,0),i(2,"h1",1),s(3," Historial de Asistencia "),n(),z(),n(),i(4,"div",2)(5,"div",3)(6,"div",4)(7,"div",5)(8,"form",6),c(9,"input",7),i(10,"i",8),c(11,"span",9)(12,"span",10),n(),i(13,"input",11),d("input",function(){return a.onFilterTextBoxChanged()}),n()(),i(14,"div",12),f(15,ue,2,1,"button",13),i(16,"button",14),d("click",function(){return a.loadTabla()}),i(17,"span",15),c(18,"span",16),i(19,"span",17),s(20,"Actualizar"),n()()()()(),i(21,"div",18),f(22,he,3,11)(23,fe,4,0),O(24,22,de,23),j(),n()()()()),t&2&&(l(15),m("ngIf",a.btnVisible&&a.isCurrentDayInSchedule),l(6),m("ngClass",v(2,pe,a.theme.getThemeMode()==="light"?"ag-theme-quartz":"ag-theme-quartz-dark")))},dependencies:[Y,S,y,K,$]})}};oe=_([T()],oe);export{oe as AsistenciaComponent};
