import{a as m,b as F,c as M}from"./chunk-HC5HCKLL.js";import{a as R}from"./chunk-4JVWF6E6.js";import"./chunk-47BWZHPK.js";import"./chunk-JV7DKPVM.js";import{a as O}from"./chunk-U2EAJGNN.js";import{a as B}from"./chunk-MKNMNAUM.js";import"./chunk-TA6YOJTR.js";import{a as G}from"./chunk-T5KXAZJZ.js";import"./chunk-GKZUPR7X.js";import"./chunk-P5QLGDHL.js";import{m as I,t as L,w as N}from"./chunk-CWIGPBJP.js";import{Ba as c,C as _,Fc as l,La as g,Ma as h,Mb as C,Qb as y,Qc as P,Sb as T,Sc as k,Vb as f,Xc as S,Yc as b,fc as a,gc as r,hc as A,ic as D,jc as w,lc as E,n as v,uc as d,vc as u,wb as x,xa as s}from"./chunk-JCDSCFF6.js";var V=(()=>{class i{constructor(){this.authService=s(R),this.solicitudInventarioService=s(m),this.user=this.authService.user()}ngOnInit(){}agInit(e){this.params=e,this.solicitud=e.data}aceptarSolicitud(){this.params?.onAcepted(this.solicitud.id_solicitud,this.user.id)}negarSolicitud(){this.params?.onDenied(this.solicitud.id_solicitud,this.user.id)}refresh(e){return this.solicitud=e.data,!0}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=c({type:i,selectors:[["app-solicitudes-action-buttons"]],decls:5,vars:0,consts:[[1,"d-flex","align-items-center","gap-2",2,"padding-block","0.15rem"],[1,"btn","btn-sm","btn-success","me-2",3,"click"],[1,"btn","btn-sm","btn-danger","me-2",3,"click"]],template:function(t,n){t&1&&(a(0,"div",0)(1,"button",1),d("click",function(){return n.aceptarSolicitud()}),l(2," Aceptar "),r(),a(3,"button",2),d("click",function(){return n.negarSolicitud()}),l(4," Negar "),r()())}})}}return i})();var q=()=>[L,import("./chunk-I6V2XIWU.js").then(i=>i.AgGridAngular)],H=i=>[i];function W(i,j){if(i&1){let e=E();a(0,"ag-grid-angular",13),S(1,"async"),S(2,"async"),d("gridReady",function(n){g(e);let o=u();return h(o.gridReady(n))})("gridReady",function(n){g(e);let o=u();return h(o.gridReady(n))}),r()}if(i&2){let e=u();f("rowData",b(1,6,e.solicitudes))("columnDefs",e.colDefs)("enableCellTextSelection",!0)("localeText",e.localeText)("pagination",!0)("loading",b(2,8,e.isLoading))}}function Z(i,j){i&1&&(a(0,"div",14)(1,"div",15)(2,"span",16),l(3,"Loading..."),r()()())}var ce=(()=>{class i{constructor(){this.solicitudInventarioService=s(m),this.solicitudEventService=s(F),this.solicitudes=new v,this.isLoading=s(B).isLoading,this.theme=s(G),this.localeText=O,this.solicitudesPendientes=[],this.colDefs=[{headerName:"Personal Solicitante",valueGetter:e=>e.data.personal_solicita?.nombre||"N/A",sortable:!0,filter:!0},{headerName:"\xCDtem Solicitado",valueGetter:e=>e.data.item?.nombre||"N/A",sortable:!0,filter:!0},{field:"cantidad",headerName:"Cantidad",sortable:!0,filter:!0},{headerName:"Stock Terapista",field:"stock_terapista",sortable:!0,filter:!0,valueGetter:e=>e.data.stock_terapista||"0"},{headerName:"Estado",valueGetter:e=>e.data.estado?.nombre||"N/A",cellRenderer:e=>{let t=e.value;switch(t){case"aceptado":return'<span class="badge badge-lg badge-light-success">'+t+"</span>";case"negado":return'<span class="badge badge-lg badge-light-danger">'+t+"</span>";case"pendiente":return'<span class="badge badge-lg badge-light-warning">'+t+"</span>"}},sortable:!0,filter:!0},{headerName:"Fecha Solicitud",valueGetter:e=>e.data.fecha_solicitud||"N/A",sortable:!0,filter:!0,valueFormatter:e=>new Date(e.value).toLocaleString("es-PE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",timeZone:"America/Lima"})},{headerName:"Acciones",cellRendererSelector:e=>e.data.estado?.nombre.toLowerCase()==="pendiente"?{component:V}:void 0,cellRendererParams:e=>({habilitado:(e.data.estado?.nombre||"").toLowerCase()==="pendiente",onAcepted:(o,p)=>{this.aceptarSolicitud(o,p)},onDenied:(o,p)=>{this.negarSolicitud(o,p)}}),maxWidth:200,resizable:!1}]}ngOnInit(){this.fetchSolicitudes()}fetchSolicitudes(){this.solicitudes=this.solicitudInventarioService.cargarTodasLasSolicitudes().pipe(_(e=>e.data))}loadPendientes(){return this.solicitudInventarioService.cargarSolicitudesPendientes().subscribe()}loadTabla(){this.fetchSolicitudes()}gridReady(e){}aceptarSolicitud(e,t){this.solicitudInventarioService.aceptarSolicitud(e,t).subscribe({next:()=>{this.solicitudesPendientes=this.solicitudesPendientes.filter(n=>n.id_solicitud!==e),this.fetchSolicitudes(),this.solicitudEventService.notifySolicitudProcesada(e),this.loadPendientes()},error:n=>{console.error("Error al aceptar solicitud:",n)}})}negarSolicitud(e,t){this.solicitudInventarioService.negarSolicitud(e,t).subscribe({next:()=>{this.solicitudesPendientes=this.solicitudesPendientes.filter(n=>n.id_solicitud!==e),this.fetchSolicitudes(),this.solicitudEventService.notifySolicitudProcesada(e),this.loadPendientes()},error:n=>{console.error("Error al negar solicitud:",n)}})}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=c({type:i,selectors:[["app-tabla-solicitudes"]],standalone:!0,features:[P],decls:20,vars:3,consts:[["header-title",""],[1,"d-flex","flex-column","text-gray-900","fw-bold","my-1"],[2,"color","white"],[1,"content","d-flex","flex-column","flex-column-fluid"],[1,"container-xxl"],[1,"card","p-2","px-4"],[1,"d-flex","py-4","justify-content-between","align-items-center"],[1,"d-flex","align-items-center","gap-3"],["type","button",1,"btn","btn-light-primary",3,"click"],[1,"d-flex","align-items-center"],[1,"fa-solid","fa-rotate-right"],[1,"ms-2"],["id","myGrid",2,"height","calc(100dvh - 281px)",3,"ngClass"],["loadingMessage","Cargando...",2,"width","100%","height","100%",3,"gridReady","rowData","columnDefs","enableCellTextSelection","localeText","pagination","loading"],[1,"d-flex","justify-content-center","align-items-center",2,"height","100%"],["role","status",1,"spinner-border"],[1,"visually-hidden"]],template:function(t,n){t&1&&(a(0,"app-header"),D(1,0),a(2,"h1",1)(3,"span",2),l(4,"Solicitudes de Inventario"),r()(),w(),r(),a(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6)(9,"div",7)(10,"button",8),d("click",function(){return n.loadTabla()}),a(11,"span",9),A(12,"span",10),a(13,"span",11),l(14,"Actualizar"),r()()()()(),a(15,"div",12),C(16,W,3,10)(17,Z,4,0),y(18,16,q,17),T(),r()()()()),t&2&&(x(15),f("ngClass",k(1,H,n.theme.getThemeMode()==="light"?"ag-theme-quartz":"ag-theme-quartz-dark")))},dependencies:[N,I,M]})}}return i})();export{ce as TablaSolicitudesComponent};
