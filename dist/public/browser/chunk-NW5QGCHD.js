import{a as we,b as Me,c as De,d as Pe,e as Ie,f as A}from"./chunk-MRY44RQF.js";import{ib as Le,jb as Oe,lb as Ne,mb as We}from"./chunk-DTQJYYMN.js";import{a as q}from"./chunk-TWOZQJ7G.js";import{a as Fe,c as W}from"./chunk-SGWZHZFB.js";import{a as Te}from"./chunk-3LUZQXRF.js";import"./chunk-DUBUW4ZU.js";import"./chunk-U5GNHINA.js";import{a as Ee}from"./chunk-3YJPJYYE.js";import{c as ye,d as Se}from"./chunk-VW7FZU7U.js";import{a as ke,b as xe}from"./chunk-WAKZQXFB.js";import"./chunk-GT4JH6HJ.js";import{a as Ce,b as N}from"./chunk-73QAVBZN.js";import{a as O}from"./chunk-C4LB5HPP.js";import{b as x,c as fe,d as be,g as ve,h as _e,j as ge}from"./chunk-FR665RP3.js";import{e as se,f as S,g as de,h as ce,l as pe,o as me,r as ue,u as L,w as he}from"./chunk-O36CONK3.js";import{e as D,f as ne,g as ae,j as P,l as I,t as oe,u as re,v as le}from"./chunk-FM6AGUVW.js";import{B as G,C as R,Da as T,Ec as M,Gc as te,Hc as ie,I as _,Kb as g,Kc as u,Lc as h,Na as j,Oa as Q,Ob as U,Rb as $,Tb as p,Wa as z,a as E,ac as o,b as F,bc as a,cc as m,dc as J,ec as Y,gc as Z,ma as H,mc as C,nc as y,sc as K,t as v,tc as X,uc as ee,wb as c,wc as d,xb as w,yc as k,za as l}from"./chunk-6QDZBSPE.js";var Ae=(r,t)=>({"btn-active-primary active":r,"cursor-not-allowed":t});function Be(r,t){if(r&1){let n=Z();o(0,"button",32),C("click",function(){let i=j(n).$implicit,s=y(2);return Q(s.toggleOption(i))}),d(1),a()}if(r&2){let n=t.$implicit,e=y(2);p("disableTooltip",e.isEnabledDay(n))("disabled",!e.isEnabledDay(n))("ngClass",ie(4,Ae,e.isOptionSelected(n),!e.isEnabledDay(n))),c(),k(" ",n.label," ")}}function Ge(r,t){if(r&1&&(o(0,"div",11)(1,"div",28)(2,"label",29),d(3,"Dias Disponibles"),a(),o(4,"div",30),g(5,Be,2,7,"button",31),a()()()),r&2){let n=y();c(5),p("ngForOf",n.options)}}function Re(r,t){r&1&&m(0,"span",33)}var f,V=(f=class{constructor(t){this.fb=t,this.personalService=l(W),this.pacienteService=l(Ee),this.tipoCitaService=l(Ne),this.terapiaService=l(ve),this.paquetesService=l(Te),this.isLoading=l(O).isLoading,this.citaService=l(q),this.toast=l(Fe),this.onSaveComplete=new z,this.modal=l(x),this.personal=null,this.isCitaContinua=!1,this.pacientesList=new v,this.tipoCitasList=new v,this.paquetesList=new v,this.timeOptions={enableTime:!0,noCalendar:!0,dateFormat:"H:i"},this.options=[{label:"L",value:1},{label:"M",value:2},{label:"MI",value:3},{label:"J",value:4},{label:"V",value:5},{label:"S",value:6}],this.isEnabledDay=n=>{let e=this.createForm.get("hora_inicio")?.value,i=this.createForm.get("hora_fin")?.value;return(this.personal?.horarios).some(b=>b.startTime.substring(0,5)<=e&&b.endTime.substring(0,5)>=i&&b.daysOfWeek.includes(n.value))},this.isOptionSelected=n=>this.createForm.get("recurrencia").value.includes(n.value)&&this.isEnabledDay(n),this.createForm=this.fb.group({id_paciente:[null,S.required],id_tipocita:[null,S.required],id_paquete:[null],fecha_inicio:[null,S.required],hora_inicio:[null,S.required],hora_fin:[null,S.required],descripcion:[null],paquete:[null],num_sesiones:[null],recurrencia:this.fb.array([])})}ngOnInit(){this.loadPacientes(),this.loadTipoCitas()}toggleOption(t){let n=this.createForm.get("recurrencia");n.value.includes(t.value)?n.removeAt(n.value.indexOf(t.value)):n.push(this.fb.control(t.value))}changePaquete(t){this.createForm.get("num_sesiones").setValue(t?.cantidadsesiones)}changeTipoCita(t){this.isCitaContinua=t&&t?.nombre!=="Evaluaci\xF3n"}closeModal(){this.modal.dismissAll()}loadTipoCitas(){this.tipoCitasList=this.tipoCitaService.getAll().pipe(_(t=>t.data),N(this))}loadPaquetes(){this.paquetesList=this.terapiaService.getPaquetesByTerapia(this.personal?.terapia.id_terapia).pipe(_(t=>t.data),N(this))}loadPacientes(){this.pacientesList=this.pacienteService.getAll().pipe(_(t=>t.data),N(this))}createCita(){this.citaService.createForTherapy(F(E({},this.createForm.value),{id_sede:this.personal?.sede.id_sede,id_terapia:this.personal?.terapia.id_terapia,id_personal:this.personal?.id_personal})).subscribe({next:()=>{this.onSaveComplete.emit(),this.closeModal()},error:t=>{if(t.error.errors){let n=Object.values(t.error.errors).join(`
`);this.toast.error(n,"Error")}else this.toast.error("Ocurri\xF3 un error al crear la cita","Error")}})}},f.\u0275fac=function(n){return new(n||f)(w(L))},f.\u0275cmp=T({type:f,selectors:[["app-create-modal"]],outputs:{onSaveComplete:"onSaveComplete"},standalone:!0,features:[M],decls:49,vars:26,consts:[[1,"modal-header"],[1,"modal-title"],[1,"text-primary"],[1,"ki-duotone","ki-add-files","text-gray-900","fs-1",2,"vertical-align","text-top"],[1,"path1"],[1,"path2"],[1,"path3"],["type","button","aria-label","Close",1,"btn","btn-sm","btn-icon","btn-active-color-primary","btn-color-gray-800",3,"click"],[1,"ki-duotone","ki-cross-square","fs-1"],[1,"modal-body"],[1,"form","d-flex","flex-column","gap-4",3,"formGroup"],[1,"row"],[1,"form-group","col-6"],["for","kt_calendar_datepicker_date",1,"form-label"],["bindValue","id_paciente","placeholder","Seleccionar","bindLabel","nombre","formControlName","id_paciente",3,"items","loading","loadingText"],[1,"form-label"],["bindValue","id_tipocita","placeholder","Seleccionar","bindLabel","nombre","formControlName","id_tipocita",3,"change","items","loading","loadingText"],[1,"form-group","col","mb-3"],["type","text","id","kt_calendar_datepicker_date","formControlName","fecha_inicio","mwlFlatpickr","","readonly","","placeholder","Seleccionar Fecha(s)",1,"form-control",3,"noCalendar","altInput","altFormat"],["for","kt_calendar_datepicker_start_time",1,"form-label"],["type","text","id","kt_calendar_datepicker_start_time","formControlName","hora_inicio","readonly","","placeholder","Seleccionar Hora de Inicio",1,"form-control"],["for","kt_calendar_datepicker_end_time",1,"form-label"],["type","text","id","kt_calendar_datepicker_end_time","formControlName","hora_fin","readonly","","placeholder","Seleccionar Hora de Fin",1,"form-control"],["class","row",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-light",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["class","spinner-border spinner-border-sm align-middle ms-2",4,"ngIf"],[1,"form-group","d-flex","flex-column","col","mb-3"],["for","kt_calendar_datepicker_end_date",1,"form-label"],[1,"btn-group"],["ngbTooltip","No Disponible","class","btn btn-outline",3,"disableTooltip","disabled","ngClass","click",4,"ngFor","ngForOf"],["ngbTooltip","No Disponible",1,"btn","btn-outline",3,"click","disableTooltip","disabled","ngClass"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"]],template:function(n,e){n&1&&(o(0,"div",0)(1,"h4",1)(2,"span",2)(3,"i",3),m(4,"span",4)(5,"span",5)(6,"span",6),a()(),d(7),a(),o(8,"button",7),C("click",function(){return e.closeModal()}),o(9,"i",8),m(10,"span",4)(11,"span",5),a()()(),o(12,"div",9)(13,"form",10)(14,"section",11)(15,"div",12)(16,"label",13),d(17,"Seleccionar Paciente"),a(),m(18,"ng-select",14),u(19,"async"),u(20,"async"),a(),o(21,"div",12)(22,"label",15),d(23,"Seleccionar Tipo de Cita"),a(),o(24,"ng-select",16),u(25,"async"),u(26,"async"),C("change",function(s){return e.changeTipoCita(s)}),a()()(),o(27,"div",11)(28,"div",17)(29,"label",13),d(30,"Fecha"),a(),m(31,"input",18),a(),o(32,"div",17)(33,"label",19),d(34,"Hora de Inicio"),a(),m(35,"input",20),a(),o(36,"div",17)(37,"label",21),d(38,"Hora de Fin"),a(),m(39,"input",22),a()(),g(40,Ge,6,1,"div",23),a()(),o(41,"div",24)(42,"button",25),C("click",function(){return e.closeModal()}),d(43,"Cancelar"),a(),o(44,"button",26),u(45,"async"),C("click",function(){return e.createCita()}),d(46," Registrar "),g(47,Re,1,0,"span",27),u(48,"async"),a()()),n&2&&(c(7),k(" Registrar Cita para ",e.personal==null?null:e.personal.nombre," "),c(6),p("formGroup",e.createForm),c(5),p("items",h(19,14,e.pacientesList))("loading",h(20,16,e.isLoading))("loadingText","Cargando..."),c(6),p("items",h(25,18,e.tipoCitasList))("loading",h(26,20,e.isLoading))("loadingText","Cargando..."),c(7),p("noCalendar",!0)("altInput",!0)("altFormat","d/m/Y"),c(9),p("ngIf",e.isCitaContinua),c(4),p("disabled",!e.createForm.valid||h(45,22,e.isLoading)),c(3),p("ngIf",h(48,24,e.isLoading)))},dependencies:[he,pe,se,de,ce,me,ue,xe,ke,Se,ye,I,D,ne,ae,P,be,fe]}),f);V=G([Ce({checkProperties:!0}),R("design:paramtypes",[L])],V);var He=["calendar"],je=()=>[Le,D,P],Qe=r=>({"opacity-50":r});function ze(r,t){if(r&1&&(m(0,"full-calendar",10,0),u(2,"async"),u(3,"async")),r&2){let n=y();p("events",h(2,3,n.citasEvent))("ngClass",te(7,Qe,h(3,5,n.isLoading)))("options",n.calendarOptions)}}function Ue(r,t){r&1&&(o(0,"h1"),d(1,"Loading..."),a())}var jt=(()=>{let t=class t{get bodyParams(){return{id_personal:this.personalId,startWeek:this.startWeek,endWeek:this.endWeek}}constructor(e){this.route=e,this.isLoading=l(O).isLoading,this.modal=l(x),this.loadingCalendar=!1,this.citasService=l(q),this.personalService=l(W),this.modalService=l(x),this.router=l(le),this.citasEvent=new v,this.personalId=this.route.snapshot.params.terapist,this.startWeek=A().startOfWeek,this.endWeek=A().endOfWeek,this.calendarOptions={plugins:[we,Me,De,Pe],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},allDaySlot:!1,expandRows:!0,slotLabelInterval:"00:05:00",slotMinTime:"08:00",slotMaxTime:"20:00:00",slotLabelFormat:{hour:"numeric",minute:"2-digit",omitZeroMinute:!1,meridiem:"narrow"},eventTimeFormat:{hour:"numeric",minute:"2-digit",meridiem:"short"},selectConstraint:"businessHours",initialView:"timeGridWeek",weekends:!0,editable:!0,loading:i=>{this.loadingCalendar=i},select:i=>this.handleClick(i),eventClick:this.handleEventClick.bind(this),selectAllow:i=>{let s=new Date,b=this.calendar?.getApi()?.view.type=="timeGridWeek",B=new Date(s.setDate(s.getDate()-s.getDay()+1));return B.setHours(0,0,0,0),i.start>=B&&b},selectable:!0,selectMirror:!0,dayMaxEvents:!0,locale:Ie,datesSet:i=>{this.startWeek=i.view.activeStart,this.endWeek=i.view.activeEnd,this.loadCitas(this.bodyParams)}},this.route.params.subscribe(()=>{this.startWeek=this.calendar?.getApi()?.view.activeStart,this.endWeek=this.calendar?.getApi()?.view.activeEnd})}ngOnInit(){this.route.params.pipe(H(({terapist:e})=>this.personalId=e)).subscribe(e=>{this.loadCitas(this.bodyParams)}),this.route.data.subscribe(e=>{this.currentPersonal=e.personal,this.calendarOptions=F(E({},this.calendarOptions),{businessHours:this.currentPersonal?.horarios,slotDuration:this.currentPersonal?.terapia.duracion})})}handleClick(e){let i=this.modal.open(V,{size:"lg",centered:!0});i.componentInstance.personal=this.currentPersonal,i.componentInstance.onSaveComplete.subscribe(()=>{this.loadCitas(this.bodyParams)}),i.componentInstance.createForm.patchValue({fecha_inicio:e.startStr.substring(0,10),hora_inicio:e.startStr.substring(11,16),hora_fin:e.endStr.substring(11,16)})}handleEventClick(e){let i=e.event,s=this.modalService.open(We,{centered:!0,size:"100",scrollable:!0,backdrop:"static"});window.document.body.classList.add("modal-open"),s.componentInstance.eventId=i.id,s.componentInstance.citaId=i.extendedProps.id_cita,s.componentInstance.eventUpdated.subscribe(()=>{this.loadCitas(this.bodyParams)})}loadCitas(e){if(this.currentPersonal)return this.citasEvent=this.citasService.getByPersonal(e).pipe(_(i=>i.data))}};t.\u0275fac=function(i){return new(i||t)(w(oe))},t.\u0275cmp=T({type:t,selectors:[["app-especialista"]],viewQuery:function(i,s){if(i&1&&K(He,5),i&2){let b;X(b=ee())&&(s.calendar=b.first)}},standalone:!0,features:[M],decls:17,vars:1,consts:[["calendar",""],["header-title",""],[1,"d-flex","flex-column","text-white","fw-bold","my-1"],[1,"content","d-flex","flex-column","flex-column-fluid"],["id","kt_content_container",1,"container-xxl"],[1,"card"],[1,"card-header"],[1,"card-toolbar","d-flex","ms-auto","justify-content-end"],[1,"card-body",2,"border","none","box-shadow","0 4px 8px rgba(0, 0, 0, 0.1)","border-radius","0 0 15px 15px"],[1,"demo-app-main"],[3,"events","ngClass","options"]],template:function(i,s){i&1&&(o(0,"app-header"),J(1,1),o(2,"h1",2),d(3),a(),Y(),a(),o(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6)(8,"div",7),m(9,"app-dropdown"),a()(),o(10,"div",8)(11,"div",9),g(12,ze,4,9)(13,Ue,2,0),U(14,12,je,null,13),$(0,-1),a()()()()(),m(16,"router-outlet")),i&2&&(c(3),k(" ",s.currentPersonal.nombre," "))},dependencies:[ge,_e,Oe,I,re]});let r=t;return r})();export{jt as EspecialistaComponent};
