import{a as F}from"./chunk-2XWCVMUI.js";import"./chunk-EPQZSVFD.js";import{a as Te}from"./chunk-H5QD6PNF.js";import{a as Me}from"./chunk-YDOVIL34.js";import{a as Ie}from"./chunk-TYDUCOLU.js";import{c as Y,d as H}from"./chunk-4UFJURU5.js";import{a as Pe,b as we}from"./chunk-QW23U5T4.js";import{a as J}from"./chunk-GT4JH6HJ.js";import{a as Fe}from"./chunk-MYRVSVX3.js";import{a as A,b as O}from"./chunk-DSXEMTTM.js";import{a as I}from"./chunk-QZNTIITD.js";import{b as k,g as oe,i as xe,j as ke}from"./chunk-D2QAFCA3.js";import"./chunk-RCZZN26A.js";import{C as K,D as s,E as X,F as Z,I as ee,J as te,L as ie,O as ne,P as re,R as _,S as Ee,T as B,e as Ce,f as C,i as E,k as x}from"./chunk-EJJY6ZUA.js";import{Ac as be,B as L,C as R,Da as y,Dc as S,E as ce,I as w,Jc as f,Kc as h,Mb as q,Na as g,Oa as v,Vb as u,W as ue,Wa as V,a as ge,b as ve,cc as r,dc as t,ec as l,f as qe,fc as ye,gc as Se,ic as U,oc as d,pc as G,sb as _e,sc as fe,t as P,uc as Q,vc as z,wc as $,xb as p,yb as j,yc as a,za as c,zc as he}from"./chunk-D6LKZNPK.js";var ae=qe(Te());var Ae=["datePicker"],Oe=["endDatePicker"];function Re(b,e){b&1&&l(0,"span",40)}var M,le=(M=class{constructor(e){this.fb=e,this.modal=c(k),this.paqueteService=c(F),this.loadingService=c(I),this.terapiaService=c(oe),this.isLoading=this.loadingService.isLoading,this.terapiaid="",this.terapiasList=new P,this.onSaveComplete=new V,this.paqueteForm=this.fb.group({nombre:["",s.required],descripcion:[""],cantidadsesiones:["",[s.required,s.min(1)]],precioregular:["",[s.required,s.min(0),s.pattern("^[0-9]+(\\.[0-9]{1,2})?$")]],descuento:["",[s.required,s.min(0),s.max(100),s.pattern("^[0-9]+(\\.[0-9]{1,2})?$")]],preciopaquete:["",[s.required,s.min(0),s.pattern("^[0-9]+(\\.[0-9]{1,2})?$")]],fechainicio:["",s.required],fechafin:["",s.required],terapias:[null,s.required],banner_url:[""]})}evtSelectFile(e){let i=e.target.files;this.paqueteForm.get("banner_url")?.setValue(i?.item(0))}ngOnInit(){this.loadTerapias(),this.paqueteForm.get("precioregular")?.valueChanges.subscribe(()=>this.calculatePreciopaquete()),this.paqueteForm.get("descuento")?.valueChanges.subscribe(()=>this.calculatePreciopaquete()),this.paqueteForm.get("fechainicio")?.valueChanges.subscribe(()=>{this.paqueteForm.get("fechafin")?.value<this.paqueteForm.get("fechainicio")?.value&&this.paqueteForm.get("fechafin")?.setValue(this.paqueteForm.get("fechainicio")?.value)})}loadTerapias(){this.terapiasList=this.terapiaService.getAll().pipe(w(e=>e.data),O(this))}ngAfterViewInit(){let e=new Date;this.datePicker&&this.datePicker.nativeElement&&J(this.datePicker.nativeElement,{locale:ae.Spanish,altFormat:"d/m/Y",altInput:!0,minDate:e,onChange:i=>{let n=i[0];if(this.endDatePicker&&this.endDatePicker.nativeElement){let o=J(this.endDatePicker.nativeElement,{locale:ae.Spanish,altFormat:"d/m/Y",altInput:!0,minDate:n});this.paqueteForm.get("fechafin")?.value<n&&(this.paqueteForm.get("fechafin")?.setValue(n),o.setDate(n))}}}),this.endDatePicker&&this.endDatePicker.nativeElement&&J(this.endDatePicker.nativeElement,{locale:ae.Spanish,altInput:!0,altFormat:"d/m/Y",minDate:e})}close(){this.modal.dismissAll()}save(){let e=new FormData;Object.keys(this.paqueteForm.value).forEach(i=>{let n=this.paqueteForm.get(i);Array.isArray(n?.value)?e.append(i,JSON.stringify(n?.value)):e.append(i,n?.value)}),this.paqueteService.create(e).subscribe({next:()=>{this.modal.dismissAll(),this.onSaveComplete.emit()},error:i=>{console.log(i)}})}calculatePreciopaquete(){let e=this.paqueteForm.get("precioregular")?.value,i=this.paqueteForm.get("descuento")?.value;if(e&&i!=null){let n=i/100,o=e-e*n;this.paqueteForm.get("preciopaquete")?.setValue(o.toFixed(2),{emitEvent:!1})}}},M.\u0275fac=function(i){return new(i||M)(j(_))},M.\u0275cmp=y({type:M,selectors:[["app-crear-modal"]],viewQuery:function(i,n){if(i&1&&(Q(Ae,5),Q(Oe,5)),i&2){let o;z(o=$())&&(n.datePicker=o.first),z(o=$())&&(n.endDatePicker=o.first)}},inputs:{terapiaid:"terapiaid"},outputs:{onSaveComplete:"onSaveComplete"},standalone:!0,features:[S],decls:68,vars:14,consts:[["datePicker",""],["endDatePicker",""],[1,"modal-header"],["id","modal-basic-title",1,"modal-title","d-flex","align-items-center","gap-1"],[1,"text-primary"],[1,"ki-duotone","ki-add-files","text-gray-900","fs-1",2,"vertical-align","text-top"],[1,"path1"],[1,"path2"],[1,"path3"],["type","button","aria-label","Close",1,"btn","btn-sm","btn-icon","btn-active-color-primary","btn-color-gray-800",3,"click"],[1,"ki-duotone","ki-cross-square","fs-1"],[1,"modal-body"],[1,"form","d-flex","flex-column","gap-4",3,"formGroup"],[1,"form-group"],["for","nombre",1,"required","form-label"],["type","text","id","nombre","formControlName","nombre","placeholder","Ingresa Nombre del Paquete",1,"form-control"],["for","",1,"required","form-label"],["type","file","id","imagen","accept","image/*",1,"form-control",3,"change"],["for","descripcion",1,"form-label"],["cols","3","rows","2","id","descripcion","formControlName","descripcion","placeholder","Ingresa Descripci\xF3n del Paquete",1,"form-control"],["for","terapias",1,"required","form-label"],["bindValue","id_terapia","bindLabel","nombre","formControlName","terapias","placeholder","Seleccionar","bindLabel","nombre",3,"items","multiple","closeOnSelect","hideSelected","loadingText"],[1,"row"],[1,"form-group","col-6"],["for","cantidadsesiones",1,"required","form-label"],["type","number","id","cantidadsesiones","formControlName","cantidadsesiones","min","1","placeholder","Nro de Sesiones",1,"form-control"],["for","precioregular",1,"required","form-label"],["type","number","id","precioregular","formControlName","precioregular","min","0","step","0.01","placeholder","Ingresar Precio",1,"form-control"],["for","descuento",1,"required","form-label"],["type","number","id","descuento","formControlName","descuento","min","0","step","0.01","placeholder","Ingresar Descuento %",1,"form-control"],["for","preciopaquete",1,"required","form-label"],["type","number","id","preciopaquete","formControlName","preciopaquete","min","0","step","0.01","placeholder","Precio Total",1,"form-control"],["for","fechainicio",1,"required","form-label"],["type","text","id","kt_calendar_datepicker_date","formControlName","fechainicio","placeholder","Seleccionar Fecha",1,"form-control"],["for","fechafin",1,"required","form-label"],["type","text","id","kt_calendar_datepicker_end_date","formControlName","fechafin","placeholder","Seleccionar Fecha",1,"form-control"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["class","spinner-border spinner-border-sm align-middle ms-2",4,"ngIf"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"]],template:function(i,n){if(i&1){let o=U();r(0,"div",2)(1,"h4",3)(2,"span",4)(3,"i",5),l(4,"span",6)(5,"span",7)(6,"span",8),t()(),a(7," A\xF1adir Paquete "),t(),r(8,"button",9),d("click",function(){return g(o),v(n.close())}),r(9,"i",10),l(10,"span",6)(11,"span",7),t()()(),r(12,"div",11)(13,"form",12)(14,"div",13)(15,"label",14),a(16,"Nombre del Paquete"),t(),l(17,"input",15),t(),r(18,"div",13)(19,"label",16),a(20,"Imagen"),t(),r(21,"input",17),d("change",function(W){return g(o),v(n.evtSelectFile(W))}),t()(),r(22,"div",13)(23,"label",18),a(24,"Descripci\xF3n"),t(),l(25,"textarea",19),t(),r(26,"div",13)(27,"label",20),a(28,"Seleccionar Terapia(s) Incluidas"),t(),l(29,"ng-select",21),f(30,"async"),t(),r(31,"div",22)(32,"div",23)(33,"label",24),a(34,"Cantidad de Sesiones"),t(),l(35,"input",25),t(),r(36,"div",23)(37,"label",26),a(38,"Precio Regular"),t(),l(39,"input",27),t()(),r(40,"div",22)(41,"div",23)(42,"label",28),a(43,"Descuento %"),t(),l(44,"input",29),t(),r(45,"div",23)(46,"label",30),a(47,"Precio del Paquete"),t(),l(48,"input",31),t()(),r(49,"div",22)(50,"div",23)(51,"label",32),a(52,"Fecha de Inicio"),t(),l(53,"input",33,0),t(),r(55,"div",23)(56,"label",34),a(57,"Fecha de Fin"),t(),l(58,"input",35,1),t()()()(),r(60,"div",36)(61,"button",37),d("click",function(){return g(o),v(n.close())}),a(62," Cancelar "),t(),r(63,"button",38),f(64,"async"),d("click",function(){return g(o),v(n.save())}),a(65," Guardar "),q(66,Re,1,0,"span",39),f(67,"async"),t()()}i&2&&(p(13),u("formGroup",n.paqueteForm),p(16),u("items",h(30,8,n.terapiasList))("multiple",!0)("closeOnSelect",!1)("hideSelected",!0)("loadingText","Cargando.."),p(34),u("disabled",n.paqueteForm.invalid||h(64,10,n.isLoading)),p(3),u("ngIf",h(67,12,n.isLoading)))},dependencies:[B,ee,K,te,X,Z,re,ie,ne,x,C,E,H,Y]}),M);le=L([A({checkProperties:!0}),R("design:paramtypes",[_])],le);function je(b,e){b&1&&l(0,"span",13)}var Le=(()=>{let e=class e{constructor(){this.modal=c(k),this.paqueteService=c(F),this.isLoading=c(I).isLoading,this.paqueteId="",this.onSaveComplete=new V}close(){this.modal.dismissAll()}delete(){let n=typeof this.paqueteId=="string"?this.paqueteId:this.paqueteId.id_paquetes;n?this.paqueteService.delete(n).subscribe({next:()=>{this.onSaveComplete.emit(),this.modal.dismissAll()},error:o=>{console.error("Error al eliminar paquete:",o)}}):console.error("ID del paquete no proporcionado o en formato incorrecto")}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=y({type:e,selectors:[["app-borrar-modal"]],inputs:{paqueteId:"paqueteId"},outputs:{onSaveComplete:"onSaveComplete"},standalone:!0,features:[S],decls:25,vars:6,consts:[[1,"modal-header"],["id","modal-basic-title",1,"modal-title","d-flex","align-items-center","gap-1"],[1,"ki-duotone","ki-information","text-danger","fs-2hx",2,"vertical-align","middle"],[1,"path1"],[1,"path2"],[1,"path3"],["type","button","aria-label","Close",1,"btn","btn-sm","btn-icon","btn-active-color-primary","btn-color-gray-800",3,"click"],[1,"ki-duotone","ki-cross-square","fs-1"],[1,"modal-body","text-center"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-danger",3,"click","disabled"],["class","spinner-border spinner-border-sm align-middle ms-2",4,"ngIf"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"]],template:function(o,m){o&1&&(r(0,"div",0)(1,"h4",1)(2,"span")(3,"i",2),l(4,"span",3)(5,"span",4)(6,"span",5),t()(),a(7," Eliminar Paquete "),t(),r(8,"button",6),d("click",function(){return m.close()}),r(9,"i",7),l(10,"span",3)(11,"span",4),t()()(),r(12,"div",8)(13,"p"),a(14,"\xBFEst\xE1s seguro de eliminar este registro de paquete?"),t(),r(15,"p"),a(16,"Toda la informaci\xF3n relacionada con este paquete se perder\xE1."),t()(),r(17,"div",9)(18,"button",10),d("click",function(){return m.close()}),a(19," Cancelar "),t(),r(20,"button",11),f(21,"async"),d("click",function(){return m.delete()}),a(22," Eliminar "),q(23,je,1,0,"span",12),f(24,"async"),t()()),o&2&&(p(20),u("disabled",h(21,2,m.isLoading)),p(3),u("ngIf",h(24,4,m.isLoading)))},dependencies:[B,x,C,E]});let b=e;return b})();var Ve=qe(Te());var Ue=["datePicker"],Ge=["endDatePicker"];function Qe(b,e){b&1&&l(0,"span",36)}var T,de=(T=class{constructor(e){this.fb=e,this.modal=c(k),this.paqueteService=c(F),this.terapiaService=c(oe),this.isLoading=c(I).isLoading,this.paqueteId="",this.es=Ve.default.es,this.terapiasList=new P,this.onSaveComplete=new V,this.paqueteForm=this.fb.group({nombre:["",s.required],descripcion:["",s.required],cantidadsesiones:[0,[s.required,s.min(0)]],precioregular:[0,[s.required,s.min(0)]],descuento:[0,[s.required,s.min(0)]],preciopaquete:[0,[s.required,s.min(0)]],fechainicio:["",s.required],fechafin:["",s.required],terapias:[null,s.required],sesionesrestantes:[0,[s.required,s.min(0)]]})}ngOnInit(){this.loadTerapias(),typeof this.paqueteId=="string"?this.loadPaqueteData():typeof this.paqueteId=="object"&&this.paqueteId.id_paquetes?this.loadPaqueteData(this.paqueteId.id_paquetes):console.error("ID del paquete no proporcionado o no es una cadena",this.paqueteId),this.paqueteForm.get("precioregular")?.valueChanges.subscribe(()=>this.calculatePreciopaquete()),this.paqueteForm.get("descuento")?.valueChanges.subscribe(()=>this.calculatePreciopaquete()),this.paqueteForm.get("fechainicio")?.valueChanges.subscribe(()=>{this.paqueteForm.get("fechafin")?.value<this.paqueteForm.get("fechainicio")?.value&&this.paqueteForm.get("fechafin")?.setValue(this.paqueteForm.get("fechainicio")?.value)})}loadTerapias(){this.terapiasList=this.terapiaService.getAll().pipe(w(e=>e.data),O(this))}close(){this.modal.dismissAll()}save(){if(this.paqueteForm.valid){let e=this.paqueteForm.value;typeof this.paqueteId=="string"?this.paqueteService.update(this.paqueteId,e).subscribe({next:()=>{this.onSaveComplete.emit(),this.modal.dismissAll()},error:i=>{console.error("Error al actualizar paquete:",i.message)}}):typeof this.paqueteId=="object"&&this.paqueteId.id_paquetes?this.paqueteService.update(this.paqueteId.id_paquetes,e).subscribe({next:()=>{this.onSaveComplete.emit(),this.modal.dismissAll()},error:i=>{console.error("Error al actualizar paquete:",i.message)}}):console.error("ID del paquete no proporcionado o en formato incorrecto")}}loadPaqueteData(e){let i=e||(typeof this.paqueteId=="object"?this.paqueteId.id_paquetes:this.paqueteId);i?this.paqueteService.getById(i).subscribe({next:n=>{this.paqueteForm.patchValue(ve(ge({},n.data),{terapias:n.data.terapias.map(o=>o.id_terapia)}))},error:n=>{console.error("Error al cargar datos del paquete:",n)}}):console.error("ID del paquete no proporcionado")}calculatePreciopaquete(){let e=this.paqueteForm.get("precioregular")?.value,i=this.paqueteForm.get("descuento")?.value;if(e&&i!=null){let n=i/100,o=e-e*n;this.paqueteForm.get("preciopaquete")?.setValue(o,{emitEvent:!1})}}},T.\u0275fac=function(i){return new(i||T)(j(_))},T.\u0275cmp=y({type:T,selectors:[["app-editar-modal"]],viewQuery:function(i,n){if(i&1&&(Q(Ue,5),Q(Ge,5)),i&2){let o;z(o=$())&&(n.datePicker=o.first),z(o=$())&&(n.endDatePicker=o.first)}},inputs:{paqueteId:"paqueteId"},outputs:{onSaveComplete:"onSaveComplete"},standalone:!0,features:[S],decls:63,vars:22,consts:[["datePicker",""],["endDatePicker",""],[1,"modal-header"],["id","modal-basic-title",1,"modal-title","d-flex","align-items-center","gap-1"],[1,"ki-duotone","ki-notepad-edit","text-gray-900","fs-1",2,"vertical-align","top"],[1,"path1"],[1,"path2"],["type","button","aria-label","Close",1,"btn","btn-sm","btn-icon","btn-active-color-primary","btn-color-gray-800",3,"click"],[1,"ki-duotone","ki-cross-square","fs-1"],[1,"modal-body"],[1,"form","d-flex","flex-column","gap-4",3,"formGroup"],[1,"form-group"],["for","nombre",1,"required","form-label"],["type","text","id","nombre","formControlName","nombre",1,"form-control"],["for","descripcion",1,"required","form-label"],["rows","2","id","descripcion","formControlName","descripcion",1,"form-control"],["for","terapias",1,"required","form-label"],["bindValue","id_terapia","bindLabel","nombre","formControlName","terapias","placeholder","Seleccionar","bindLabel","nombre",3,"items","multiple","closeOnSelect","hideSelected","loadingText"],[1,"row"],[1,"form-group","col-6"],["for","cantidadsesiones",1,"required","form-label"],["type","number","id","cantidadsesiones","formControlName","cantidadsesiones","min","1",1,"form-control"],["for","precioregular",1,"required","form-label"],["type","number","id","precioregular","formControlName","precioregular","min","0","step","0.01",1,"form-control"],["for","descuento",1,"required","form-label"],["type","number","id","descuento","formControlName","descuento","min","0","step","0.01",1,"form-control"],["for","preciopaquete",1,"required","form-label"],["type","number","id","preciopaquete","formControlName","preciopaquete","min","0","step","0.01",1,"form-control"],["for","fechainicio",1,"required","form-label"],["id","kt_calendar_datepicker_date","mwlFlatpickr","","formControlName","fechainicio","placeholder","Seleccionar Fecha",1,"form-control",3,"locale","altInput","altFormat","monthSelectorType"],["for","fechafin",1,"required","form-label"],["id","kt_calendar_datepicker_end_date","formControlName","fechafin","mwlFlatpickr","","placeholder","Seleccionar Fecha",1,"form-control",3,"locale","altInput","altFormat","monthSelectorType"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["class","spinner-border spinner-border-sm align-middle ms-2",4,"ngIf"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"]],template:function(i,n){if(i&1){let o=U();r(0,"div",2)(1,"h4",3)(2,"span")(3,"i",4),l(4,"span",5)(5,"span",6),t()(),a(6," Editar Paquete "),t(),r(7,"button",7),d("click",function(){return g(o),v(n.close())}),r(8,"i",8),l(9,"span",5)(10,"span",6),t()()(),r(11,"div",9)(12,"form",10)(13,"div",11)(14,"label",12),a(15,"Nombre del Paquete"),t(),l(16,"input",13),t(),r(17,"div",11)(18,"label",14),a(19,"Descripci\xF3n"),t(),l(20,"textarea",15),t(),r(21,"div",11)(22,"label",16),a(23,"Seleccionar Terapia(s) Incluidas"),t(),l(24,"ng-select",17),f(25,"async"),t(),r(26,"div",18)(27,"div",19)(28,"label",20),a(29,"Cantidad de Sesiones"),t(),l(30,"input",21),t(),r(31,"div",19)(32,"label",22),a(33,"Precio Regular"),t(),l(34,"input",23),t()(),r(35,"div",18)(36,"div",19)(37,"label",24),a(38,"Descuento %"),t(),l(39,"input",25),t(),r(40,"div",19)(41,"label",26),a(42,"Precio del Paquete"),t(),l(43,"input",27),t()(),r(44,"div",18)(45,"div",19)(46,"label",28),a(47,"Fecha de Inicio"),t(),l(48,"input",29,0),t(),r(50,"div",19)(51,"label",30),a(52,"Fecha de Fin"),t(),l(53,"input",31,1),t()()()(),r(55,"div",32)(56,"button",33),d("click",function(){return g(o),v(n.close())}),a(57," Cancelar "),t(),r(58,"button",34),f(59,"async"),d("click",function(){return g(o),v(n.save())}),a(60," Guardar "),q(61,Qe,1,0,"span",35),f(62,"async"),t()()}i&2&&(p(12),u("formGroup",n.paqueteForm),p(12),u("items",h(25,16,n.terapiasList))("multiple",!0)("closeOnSelect",!1)("hideSelected",!0)("loadingText","Cargando.."),p(24),u("locale",n.es)("altInput",!0)("altFormat","d/m/Y")("monthSelectorType","dropdown"),p(5),u("locale",n.es)("altInput",!0)("altFormat","d/m/Y")("monthSelectorType","dropdown"),p(5),u("disabled",n.paqueteForm.invalid||h(59,18,n.isLoading)),p(3),u("ngIf",h(62,20,n.isLoading)))},dependencies:[B,ee,K,te,X,Z,re,ie,ne,x,C,E,we,Pe,H,Y]}),T);de=L([A({checkProperties:!0}),R("design:paramtypes",[_])],de);function ze(b,e){b&1&&l(0,"span",16)}var D,me=(D=class{constructor(e){this.fb=e,this.modal=c(k),this.paqueteService=c(F),this.usuarioService=c(Ie),this.pacienteService=c(Me),this.isLoading=c(I).isLoading,this.paqueteId=null,this.onSaveComplete=new V,this.usuariosList=new P,this.pacientesList=new P,this.selectedUser=null,this.selectedPaciente=null,this.form=this.fb.group({usuario:[null,s.required],paciente:[null,s.required]})}ngOnInit(){this.fetchUsuarios(),this.loadPaqueteData()}fetchUsuarios(){this.usuariosList=this.usuarioService.getPacientes().pipe(O(this),w(e=>e.data||[]),ue(e=>(console.error("Error al buscar usuarios:",e),ce([]))))}loadPaqueteData(){let e;this.paqueteId&&(typeof this.paqueteId=="string"?e=this.paqueteId:typeof this.paqueteId=="object"&&this.paqueteId.id_paquetes&&(e=this.paqueteId.id_paquetes)),console.log("ID del paquete:",e),e?this.paqueteService.getById(e).subscribe({next:i=>{console.log("Paquete cargado:",i)},error:i=>{console.error("Error al cargar datos del paquete:",i)}}):console.error("ID del paquete no proporcionado")}onUserSelect(e){this.selectedUser=e,this.form.controls.paciente.reset(),this.loadPacientesByUser(e.id)}onPacienteSelect(e){this.selectedPaciente=e}loadPacientesByUser(e){this.pacientesList=this.pacienteService.getAll().pipe(w(i=>i.data.filter(n=>n.id===e)),ue(i=>(console.error("Error al cargar pacientes:",i),ce([]))))}compareUsers(e,i){return e&&i?e.id===i.id:e===i}close(){this.modal.dismissAll()}purchase(){if(this.paqueteId===null){console.error("ID del paquete no est\xE1 disponible"),alert("Por favor, selecciona un paquete v\xE1lido.");return}let e=typeof this.paqueteId=="string"?this.paqueteId:this.paqueteId.id_paquetes;if(!e){console.error("ID del paquete no est\xE1 disponible"),alert("Por favor, selecciona un paquete v\xE1lido.");return}if(!this.selectedUser){console.error("Usuario no seleccionado"),alert("Por favor, selecciona un usuario.");return}if(!this.selectedPaciente){console.error("Paciente no seleccionado"),alert("Por favor, selecciona un paciente.");return}let i=this.selectedPaciente.id_paciente,n=this.selectedUser.id;this.paqueteService.purchase(e,i,n).subscribe({next:()=>{console.log("Compra realizada con \xE9xito"),this.onSaveComplete.emit(),this.modal.dismissAll()},error:o=>{console.error("Error al comprar paquete:",o),alert("Ocurri\xF3 un error al realizar la compra. Int\xE9ntalo de nuevo.")}})}},D.\u0275fac=function(i){return new(i||D)(j(_))},D.\u0275cmp=y({type:D,selectors:[["app-comprar-modal"]],inputs:{paqueteId:"paqueteId"},outputs:{onSaveComplete:"onSaveComplete"},standalone:!0,features:[S],decls:33,vars:23,consts:[[1,"modal-header"],["id","modal-basic-title",1,"modal-title","d-flex","align-items-center","gap-1"],[1,"ki-duotone","ki-handcart","text-white","me-2","fs-2hx",2,"vertical-align","middle"],[1,"path1"],[1,"path2"],[1,"path3"],["type","button","aria-label","Close",1,"btn","btn-sm","btn-icon","btn-active-color-primary","btn-color-gray-800",3,"click"],[1,"ki-duotone","ki-cross-square","fs-1"],[1,"modal-body","text-center"],[1,"col-mb-4","mb-3"],["bindLabel","name","bindValue","id","placeholder","Selecciona un usuario",3,"change","items","loading","loadingText","notFoundText","compareWith"],["bindLabel","nombre","bindValue","id","placeholder","Selecciona un paciente",3,"change","items","loading","loadingText","notFoundText"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["class","spinner-border spinner-border-sm align-middle ms-2",4,"ngIf"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"]],template:function(i,n){i&1&&(r(0,"div",0)(1,"h4",1)(2,"span")(3,"i",2),l(4,"span",3)(5,"span",4)(6,"span",5),t()(),a(7," Adquirir Paquete "),t(),r(8,"button",6),d("click",function(){return n.close()}),r(9,"i",7),l(10,"span",3)(11,"span",4),t()()(),r(12,"div",8)(13,"p"),a(14,"\xBFEst\xE1s seguro de comprar este Paquete?"),t(),r(15,"p"),a(16,"Selecciona el usuario y luego el paciente que desees para continuar con la compra."),t(),r(17,"div",9)(18,"ng-select",10),f(19,"async"),f(20,"async"),d("change",function(m){return n.onUserSelect(m)}),t()(),r(21,"div",9)(22,"ng-select",11),f(23,"async"),f(24,"async"),d("change",function(m){return n.onPacienteSelect(m)}),t()()(),r(25,"div",12)(26,"button",13),d("click",function(){return n.close()}),a(27," Cancelar "),t(),r(28,"button",14),f(29,"async"),d("click",function(){return n.purchase()}),a(30," Comprar "),q(31,ze,1,0,"span",15),f(32,"async"),t()()),i&2&&(p(18),u("items",h(19,11,n.usuariosList))("loading",h(20,13,n.isLoading))("loadingText","Cargando..")("notFoundText","Sin resultados")("compareWith",n.compareUsers),p(4),u("items",h(23,15,n.pacientesList))("loading",h(24,17,n.isLoading))("loadingText","Cargando..")("notFoundText","Sin resultados"),p(6),u("disabled",h(29,19,n.isLoading)||!n.selectedUser||!n.selectedPaciente),p(3),u("ngIf",h(32,21,n.isLoading)))},dependencies:[B,Ee,x,C,E,H,Y]}),D);me=L([A({checkProperties:!0}),R("design:paramtypes",[_])],me);function $e(b,e){b&1&&(r(0,"div",21)(1,"div",22)(2,"span",23),a(3,"Cargando..."),t()()())}function Ye(b,e){b&1&&(r(0,"div",24)(1,"p"),a(2,"No se encontraron paquetes."),t()())}function He(b,e){if(b&1){let i=U();r(0,"div",27)(1,"div",28)(2,"div",29)(3,"div",30)(4,"button",31),d("click",function(){let o=g(i).$implicit,m=G(2);return v(m.openEditarModal(o))}),l(5,"span",32),t(),r(6,"button",33),d("click",function(){let o=g(i).$implicit,m=G(2);return v(m.openBorrarModal(o))}),l(7,"span",34),t()(),r(8,"div",35),l(9,"img",36),t()(),r(10,"div",37)(11,"h5",38),a(12),t(),r(13,"p",39)(14,"strong"),a(15,"Terapias:"),t(),a(16),t(),r(17,"p",39),a(18),t(),r(19,"p",39)(20,"strong"),a(21),t()(),r(22,"button",40),d("click",function(){let o=g(i).$implicit,m=G(2);return v(m.openComprarModal(o))}),l(23,"span",41),a(24," Vender "),t()()()()}if(b&2){let i=e.$implicit,n=G(2);p(9),fe("src",i.banner_url,_e),fe("alt",i.nombre),p(3),he(i.nombre),p(4),be(" ",n.getTerapiasNombres(i.terapias),""),p(2),he(i.descripcion),p(3),be("$",i.preciopaquete,"")}}function We(b,e){if(b&1&&(r(0,"div",25),q(1,He,25,6,"div",26),f(2,"async"),t()),b&2){let i=G();p(),u("ngForOf",h(2,1,i.paquetesList))}}var N,Be=(N=class{constructor(){this.paquetesService=c(F),this.isLoading=c(I).isLoading,this.theme=c(xe),this.modal=c(k),this.paquetesList=new P,this.localeText=Fe}ngOnInit(){this.fetchPaquetes()}fetchPaquetes(){this.paquetesList=this.paquetesService.getAll().pipe(w(e=>(console.log("Paquetes recibidos:",e.data),e.data)),O(this))}loadTabla(){this.fetchPaquetes()}gridReady(e){this.gridApi=e.api}onFilterTextBoxChanged(){this.gridApi.setGridOption("quickFilterText",document.getElementById("paquete-search").value)}openCrearModal(){this.modal.open(le,{size:"350px",animation:!0,centered:!0}).componentInstance.onSaveComplete.subscribe(()=>{this.fetchPaquetes()})}getTerapiasNombres(e){return e.map(i=>i.nombre).join(", ")}openEditarModal(e){let i=this.modal.open(de);i.componentInstance.paqueteId=e.id_paquetes,i.componentInstance.onSaveComplete.subscribe(()=>{this.fetchPaquetes()})}openBorrarModal(e){if(!e.id_paquetes){console.error("El paquete no tiene un id_paquete definido.");return}let i=this.modal.open(Le,{size:"300px",animation:!0,centered:!0});i.componentInstance.paqueteId=e.id_paquetes,i.componentInstance.onSaveComplete.subscribe(()=>{this.fetchPaquetes()})}openComprarModal(e){console.log("Paquete seleccionado:",e);let i=this.modal.open(me,{size:"300px",animation:!0,centered:!0});i.componentInstance.paqueteId=e.id_paquetes}ngOnDestroy(){}},N.\u0275fac=function(i){return new(i||N)},N.\u0275cmp=y({type:N,selectors:[["app-paquetes"]],standalone:!0,features:[S],decls:30,vars:11,consts:[["header-title",""],[1,"d-flex","flex-column","text-gray-900","fw-bold","my-1"],[2,"color","white"],[1,"content","d-flex","flex-column","flex-column-fluid"],[1,"container-xxl"],[1,"d-flex","py-4","justify-content-between","align-items-center"],["data-kt-search-element","form","autocomplete","off",1,"position-relative"],["type","hidden"],[1,"ki-duotone","ki-magnifier","fs-2","search-icon","position-absolute","top-50","translate-middle-y","ms-4"],["type","search","id","paquete-search","name","search","placeholder","B\xFAsqueda","data-kt-search-element","input",1,"form-control","custom-form-control","ps-13",3,"input"],[1,"d-flex","align-items-center","gap-3"],["type","button",1,"btn","btn-light-primary",3,"click"],[1,"d-flex","align-items-center"],[1,"fa-solid","fa-rotate-right"],[1,"ms-2"],["type","button",1,"btn","btn-primary",3,"click"],[1,"ki-solid","ki-plus","text-white","fs-1"],[1,"text-white","ms-2"],["class","loading-container d-flex justify-content-center align-items-center",4,"ngIf"],["class","text-center",4,"ngIf"],["class","row justify-content-center",4,"ngIf"],[1,"loading-container","d-flex","justify-content-center","align-items-center"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"text-center"],[1,"row","justify-content-center"],["class","col-md-4",4,"ngFor","ngForOf"],[1,"col-md-4"],[1,"card","mb-4",2,"width","18rem","padding","5px"],[1,"position-relative",2,"padding-top","40px"],[1,"action-buttons",2,"position","absolute","top","0","right","10px","z-index","1"],["type","button",1,"btn","btn-icon","btn-sm","bg-success",2,"margin-right","5px",3,"click"],[1,"ki-solid","ki-pencil","text-white"],["type","button",1,"btn","btn-icon","btn-sm","btn-danger",3,"click"],[1,"ki-solid","ki-trash","text-white"],[1,"image-container",2,"box-shadow","0 4px 8px rgba(0, 0, 0, 0.1)","border-radius","8px","overflow","hidden"],[1,"card-img-top",2,"width","100%","height","auto",3,"src","alt"],[1,"card-body"],[1,"card-title"],[1,"card-text"],["type","button",1,"btn","btn-primary","btn-lg","w-100","d-flex","justify-content-center","align-items-center",3,"click"],[1,"ki-duotone","ki-handcart","text-white","me-2"]],template:function(i,n){if(i&1&&(r(0,"app-header"),ye(1,0),r(2,"h1",1)(3,"span",2),a(4,"Paquetes"),t()(),Se(),t(),r(5,"div",3)(6,"div",4)(7,"div",5)(8,"form",6),l(9,"input",7)(10,"i",8),r(11,"input",9),d("input",function(){return n.onFilterTextBoxChanged()}),t()(),r(12,"div",10)(13,"button",11),d("click",function(){return n.loadTabla()}),r(14,"span",12),l(15,"span",13),r(16,"span",14),a(17,"Actualizar"),t()()(),r(18,"button",15),d("click",function(){return n.openCrearModal()}),r(19,"span",12),l(20,"span",16),r(21,"span",17),a(22,"A\xF1adir"),t()()()()(),q(23,$e,4,0,"div",18),f(24,"async"),q(25,Ye,3,0,"div",19),f(26,"async"),f(27,"async"),q(28,We,3,3,"div",20),f(29,"async"),t()()),i&2){let o,m;p(23),u("ngIf",h(24,3,n.isLoading)),p(2),u("ngIf",!h(26,5,n.isLoading)&&!((o=h(27,7,n.paquetesList))!=null&&o.length)),p(3),u("ngIf",((m=h(29,9,n.paquetesList))==null?null:m.length)>0)}},dependencies:[x,Ce,C,E,ke]}),N);Be=L([A()],Be);export{Be as PaquetesComponent};
