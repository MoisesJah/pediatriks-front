import{a as ie}from"./chunk-E6U7EDCE.js";import{A as X,a as z,b as $,c as G,d as U,e as J,f as K,g as Q,z as W}from"./chunk-47BWZHPK.js";import"./chunk-JV7DKPVM.js";import{a as ne}from"./chunk-UQDQJV4D.js";import{c as ee}from"./chunk-QDPNGC45.js";import{a as te}from"./chunk-U2EAJGNN.js";import{a as Z,b as w}from"./chunk-TA6YOJTR.js";import{a as Y}from"./chunk-T5KXAZJZ.js";import"./chunk-GKZUPR7X.js";import{j as V}from"./chunk-P5QLGDHL.js";import{m as k,o as B,t as O,w as R}from"./chunk-CWIGPBJP.js";import{Ba as P,C as _,Fc as l,Gc as L,Ic as I,La as y,Ma as S,Mb as u,Mc as E,Qc as M,Sc as F,Vb as c,Xc as f,Yc as b,aa as v,bc as N,dc as D,ec as j,fc as a,gc as o,hc as g,lc as H,n as h,r as x,uc as C,v as A,vc as m,wb as s,xa as p}from"./chunk-JCDSCFF6.js";var se=r=>[r];function le(r,e){r&1&&(a(0,"div",4)(1,"div",5)(2,"span",6),l(3,"Cargando..."),o()()())}function ce(r,e){if(r&1&&(a(0,"div",22)(1,"span"),l(2,"Total de Sesiones"),o(),a(3,"div",23),g(4,"ngb-progressbar",24),a(5,"span",25),l(6),o()()()),r&2){let t=m().$implicit;s(4),c("value",t.num_sesiones)("max",t.total_sesiones),s(2),I("",t.num_sesiones," / ",t.total_sesiones,"")}}function de(r,e){if(r&1){let t=H();a(0,"div",7),C("shown",function(){let n=y(t).$implicit,d=m();return S(d.loadHistorialData(n.id))}),a(1,"div",8)(2,"div",9)(3,"div",10)(4,"span",11),l(5),o(),u(6,ce,7,4,"div",12),o(),a(7,"button",13),g(8,"i",14),l(9," Historial "),o()(),a(10,"div",15)(11,"div",16)(12,"div",17)(13,"span",18),l(14,"Historial de compras"),o(),a(15,"button",19),C("click",function(){let n=y(t).$implicit,d=m();return S(d.loadHistorialData(n.id,!0))}),l(16,"Actualizar"),o()(),a(17,"div",20),g(18,"ag-grid-angular",21),f(19,"async"),f(20,"async"),o()()()()()}if(r&2){let t=e.$implicit,i=m();c("destroyOnHide",!0),s(5),L(t.paquete),s(),c("ngIf",t.total_sesiones>0),s(11),c("ngClass",F(15,se,i.theme.getThemeMode()==="light"?"ag-theme-quartz":"ag-theme-quartz-dark")),s(),c("rowData",b(19,11,i.getHistorialSubject(t.id)))("columnDefs",i.columnDefs)("loading",b(20,13,i.getLoadingState(t.id)))("localeText",i.localeText)("enableCellTextSelection",!0)("ariaHidden",!0)("pagination",!0)}}function me(r,e){r&1&&(a(0,"div",0)(1,"div",0)(2,"div",26)(3,"span",27),l(4,"No se encontraron paquetes"),o()()()())}var ae=class T{constructor(){this.reporteService=p(ne),this.activatedRoute=p(V),this.paquetesLoading=!1,this.theme=p(Y),this.id_paciente=this.activatedRoute.snapshot.paramMap.get("id"),this.localeText=te,this.historialList=new h,this.paquetesList=new h,this.historialData=[],this.historialSubjects=new Map,this.dataLoaded=new Map,this.loadingStates=new Map,this.columnDefs=[{field:"num_sesiones",headerName:"N\xB0 Sesiones",filter:!0},{field:"metodo_pago",headerName:"M\xE9todo de Pago",filter:!0},{field:"precio",headerName:"Precio",valueFormatter:e=>ie(e.value),filter:!0},{field:"created_at",headerName:"Fecha Compra",filter:"agDateColumnFilter",filterParams:{comparator:(e,t)=>{let i=t;if(i==null)return 0;let n=i.slice(0,10).split("/"),d=Number(n[2]),oe=Number(n[1])-1,re=Number(n[0]),q=new Date(d,oe,re);return q<e?-1:q>e?1:0}},cellClass:"fw-semibold text-gray-600 text-center"}]}ngOnInit(){this.getPaquetes()}getHistorialSubject(e){if(!this.historialSubjects.has(e)){let t=new x([]);this.historialSubjects.set(e,t)}return this.historialSubjects.get(e)}getLoadingState(e){if(!this.loadingStates.has(e)){let t=new x(!1);this.loadingStates.set(e,t)}return this.loadingStates.get(e)}loadHistorialData(e,t=!1){this.getLoadingState(e).next(!0),this.reporteService.getPaquetes(this.id_paciente).pipe(_(i=>i.data.compras.flatMap(n=>n.historial.filter(d=>d.id_paq===e))),v(()=>this.getLoadingState(e).next(!1)),w(this)).subscribe(i=>{this.getHistorialSubject(e).next(i)})}getPaquetes(){this.paquetesLoading=!0,this.paquetesList=this.reporteService.getPaquetes(this.id_paciente).pipe(_(e=>e.data.compras),v(()=>this.paquetesLoading=!1),w(this))}static{this.\u0275fac=function(t){return new(t||T)}}static{this.\u0275cmp=P({type:T,selectors:[["app-tab-paquetes"]],standalone:!0,features:[M],decls:7,vars:4,consts:[[1,"d-flex","flex-column","gap-4"],["class","loading-container d-flex justify-content-center align-items-center",4,"ngIf"],["ngbAccordion","",1,"card","card-body","border-1","border-gray-300","d-flex","gap-4",3,"destroyOnHide"],["class","d-flex flex-column gap-4",4,"ngIf"],[1,"loading-container","d-flex","justify-content-center","align-items-center"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],["ngbAccordion","",1,"card","card-body","border-1","border-gray-300","d-flex","gap-4",3,"shown","destroyOnHide"],["ngbAccordionItem",""],[1,"d-flex","px-4","justify-content-between","align-items-center"],[1,"d-flex","align-items-center","gap-5"],["ngbAccordionHeader","",1,"fw-bold","fs-5"],["class","d-flex flex-column gap-2","style","min-width: 200px;",4,"ngIf"],["ngbAccordionToggle","",1,"btn","btn-sm","btn-outline","btn-secondary"],[1,"ki-outline","ki-eye","fs-4"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],[1,"d-flex","justify-content-between","align-items-center"],[1,"fw-bold","fs-5"],[1,"btn","btn-sm","btn-info","btn-outline","mb-2",3,"click"],[2,"height","300px",3,"ngClass"],[2,"width","100%","height","100%",3,"rowData","columnDefs","loading","localeText","enableCellTextSelection","ariaHidden","pagination"],[1,"d-flex","flex-column","gap-2",2,"min-width","200px"],[1,"d-flex","align-items-center","gap-2"],["type","primary",1,"flex-grow-1",3,"value","max"],[1,"fw-bold"],[1,"d-flex","flex-column","align-items-center","gap-3"],[1,"fw-bold","fs-3","mt-5"]],template:function(t,i){if(t&1&&(a(0,"div",0),E(1),f(2,"async"),u(3,le,4,0,"div",1),D(4,de,21,17,"div",2,N),u(6,me,5,0,"div",3),o()),t&2){let n=b(2,2,i.paquetesList);s(3),c("ngIf",i.paquetesLoading),s(),j(n),s(2),c("ngIf",(n==null?null:n.length)===0)}},dependencies:[ee,R,k,B,O,Q,K,J,U,G,z,$,X,W]})}};ae=A([Z()],ae);export{ae as TabPaquetesComponent};
