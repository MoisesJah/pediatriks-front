import{a as Ie,b as Ne,c as Pe,d as Oe,e as Ve,f as $}from"./chunk-MXIO4LTD.js";import{ib as qe,jb as Ae,lb as Be,mb as We}from"./chunk-RAAGOLWL.js";import{a as j}from"./chunk-7AIUXADS.js";import{a as we}from"./chunk-YBFGVJE5.js";import{a as Me}from"./chunk-PNB2OZ2U.js";import{a as Le}from"./chunk-M7HKYXGK.js";import{a as De}from"./chunk-LPL4PT5K.js";import{a as Qe}from"./chunk-DLC4K37R.js";import{c as xe,d as H}from"./chunk-NQSJXRIC.js";import{a as Ee,b as Fe}from"./chunk-VJX74TKL.js";import"./chunk-GT4JH6HJ.js";import{a as G,b as E}from"./chunk-OWRVEPA3.js";import{a as R}from"./chunk-C7Z7GTCA.js";import{b as B,c as Se,d as ye,g as W,h as ke,j as Te}from"./chunk-PD56GGPI.js";import{e as he,f as v,g as fe,h as be,k as ge,m as ve,p as _e,s as A,u as Ce}from"./chunk-4PY7PIQX.js";import{e as P,f as pe,g as me,j as O,l as V,s as q,u as ue}from"./chunk-VUZMLSUX.js";import{B as w,C as L,Cb as ie,Da as M,Eb as c,I as g,Ic as N,Ma as X,Na as ee,Nb as n,Ob as a,Pb as p,Qb as ae,Rb as ne,Tb as re,Ua as z,Y as K,Yb as C,Zb as S,a as F,b as D,ba as Y,ca as Z,cc as oe,dc as le,ec as se,f as Ue,gc as o,ib as s,ic as x,jb as k,lc as I,ma as J,nc as de,oc as ce,rc as m,sc as u,t as _,vb as T,za as l,zb as te}from"./chunk-UAHLOU27.js";var Re=Ue(Qe());var $e=(d,t)=>({"btn-active-primary active":d,"cursor-not-allowed":t});function Ke(d,t){if(d&1){let e=re();n(0,"button",35),C("click",function(){let r=X(e).$implicit,h=S(2);return ee(h.toggleOption(r))}),o(1),a()}if(d&2){let e=t.$implicit,i=S(2);c("disableTooltip",i.isEnabledDay(e))("disabled",!i.isEnabledDay(e))("ngClass",ce(4,$e,i.isOptionSelected(e),!i.isEnabledDay(e))),s(),x(" ",e.label," ")}}function Ye(d,t){if(d&1&&(n(0,"div",11)(1,"div",31)(2,"label",32),o(3,"Dias Disponibles"),a(),n(4,"div",33),T(5,Ke,2,7,"button",34),a()()()),d&2){let e=S();s(5),c("ngForOf",e.options)}}var f,U=(f=class{constructor(t){this.fb=t,this.modal=l(B),this.sedesService=l(Le),this.personalService=l(we),this.pacienteService=l(De),this.tipoCitaService=l(Be),this.terapiaService=l(W),this.paquetesService=l(Me),this.isLoading=l(R).isLoading,this.citaService=l(j),this.eventSubmitted=new z,this.eventDeleted=new z,this.es=Re.default.es,this.isCitaContinua=!1,this.sedesList=new _,this.pacientesList=new _,this.personalList=[],this.tipoCitasList=new _,this.paquetesList=new _,this.timeOptions={enableTime:!0,noCalendar:!0,dateFormat:"H:i"},this.options=[{label:"L",value:1},{label:"M",value:2},{label:"MI",value:3},{label:"J",value:4},{label:"V",value:5},{label:"S",value:6}],this.isEnabledDay=e=>{let i=this.createForm.get("id_personal")?.value,r=this.createForm.get("hora_inicio")?.value,h=this.createForm.get("hora_fin")?.value;return this.personalList.some(Q=>Q.horarios?.some(y=>y.hora_inicio.substring(0,5)<=r&&y.hora_fin.substring(0,5)>=h&&y.dia_semana===e.value&&Q.id_personal===i))},this.isOptionSelected=e=>this.createForm.get("recurrencia").value.includes(e.value)&&this.isEnabledDay(e),this.createForm=this.fb.group({id_sede:[null,v.required],id_paciente:[null,v.required],id_personal:[null,v.required],id_tipocita:[null,v.required],id_paquete:[null],fecha_inicio:[null,v.required],hora_inicio:[null,v.required],hora_fin:[null,v.required],descripcion:[null],paquete:[null],num_sesiones:[null],recurrencia:this.fb.array([])})}onChangeSede(t){this.createForm.get("id_personal")?.setValue(null)}onStartTimeChange(t){let[e,i]=t.dateString.split(":").map(Number),r=new Date;r.setHours(e,i+5),this.createForm.get("hora_fin").setValue(r.toTimeString().slice(0,5))}changePaquete(t){this.createForm.get("num_sesiones").setValue(t?.cantidadsesiones)}toggleOption(t){let e=this.createForm.get("recurrencia");e.value.includes(t.value)?e.removeAt(e.value.indexOf(t.value)):e.push(this.fb.control(t.value))}closeModal(){this.modal.dismissAll()}changeTipoCita(t){this.isCitaContinua=t&&t?.nombre!=="Evaluaci\xF3n"}ngOnInit(){this.loadSedes(),this.loadPacientes(),this.loadTipoCitas(),this.loadPaquetes()}ngAfterViewInit(){this.createForm.valueChanges.pipe(Z("id_sede")).subscribe(t=>{let{id_sede:e,fecha_inicio:i,hora_inicio:r,hora_fin:h,id_personal:Q}=t,y=[e,i,r,h],He={id_sede:e,fecha_inicio:i,hora_inicio:r,hora_fin:h,id_terapia:this.terapia.id_terapia};y.every(Boolean)?this.citaService.getAvailablePersonal(He).pipe(K(500)).subscribe(je=>{this.personalList=je.data}):(this.personalList=[],this.createForm.get("id_personal")?.setValue(null))})}loadSedes(){this.sedesList=this.sedesService.getAll().pipe(g(t=>t.data),E(this))}loadTipoCitas(){this.tipoCitasList=this.tipoCitaService.getAll().pipe(g(t=>t.data),E(this))}loadPaquetes(){this.paquetesList=this.terapiaService.getPaquetesByTerapia(this.terapia.id_terapia).pipe(g(t=>t.data),E(this))}loadPacientes(){this.pacientesList=this.pacienteService.getAll().pipe(g(t=>t.data),E(this))}createCita(){this.citaService.createForTherapy(D(F({},this.createForm.value),{id_terapia:this.terapia.id_terapia})).subscribe(t=>{this.eventSubmitted.emit(t.data),this.modal.dismissAll()})}},f.\u0275fac=function(e){return new(e||f)(k(A))},f.\u0275cmp=M({type:f,selectors:[["app-crear-modal"]],outputs:{eventSubmitted:"eventSubmitted",eventDeleted:"eventDeleted"},standalone:!0,features:[I],decls:64,vars:36,consts:[[1,"modal-header"],[1,"modal-title"],[1,"text-primary"],[1,"ki-duotone","ki-add-files","text-gray-900","fs-1",2,"vertical-align","text-top"],[1,"path1"],[1,"path2"],[1,"path3"],["type","button","aria-label","Close",1,"btn","btn-sm","btn-icon","btn-active-color-primary","btn-color-gray-800",3,"click"],[1,"ki-duotone","ki-cross-square","fs-1"],[1,"modal-body"],[1,"form","d-flex","flex-column","gap-4",3,"formGroup"],[1,"row"],[1,"form-group","col-6"],["for","kt_calendar_datepicker_date",1,"form-label"],["bindValue","id_paciente","placeholder","Seleccionar","bindLabel","nombre","formControlName","id_paciente",3,"items","loading","loadingText"],[1,"form-label"],["bindValue","id_tipocita","placeholder","Seleccionar","bindLabel","nombre","formControlName","id_tipocita",3,"change","items","loading","loadingText"],["for","",1,"form-label"],["bindValue","id_sede","placeholder","Seleccionar Sede","bindLabel","nombre","formControlName","id_sede",3,"change","items","loading","loadingText"],[1,"form-group","col","mb-3"],["type","text","id","kt_calendar_datepicker_date","formControlName","fecha_inicio","mwlFlatpickr","","readonly","","placeholder","Seleccionar Fecha(s)",1,"form-control",3,"noCalendar","altInput","altFormat"],["for","kt_calendar_datepicker_start_time",1,"form-label"],["type","text","id","kt_calendar_datepicker_start_time","formControlName","hora_inicio","readonly","","placeholder","Seleccionar Hora de Inicio",1,"form-control"],["for","kt_calendar_datepicker_end_time",1,"form-label"],["type","text","id","kt_calendar_datepicker_end_time","formControlName","hora_fin","readonly","","placeholder","Seleccionar Hora de Fin",1,"form-control"],["type","text","readonly","",1,"form-control",3,"value"],["bindValue","id_personal","placeholder","Seleccionar","bindLabel","nombre","formControlName","id_personal",3,"items","loading","loadingText"],["class","row",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-light",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"form-group","d-flex","flex-column","col","mb-3"],["for","kt_calendar_datepicker_end_date",1,"form-label"],[1,"btn-group"],["ngbTooltip","No Disponible","placement","bottom","class","btn btn-outline",3,"disableTooltip","disabled","ngClass","click",4,"ngFor","ngForOf"],["ngbTooltip","No Disponible","placement","bottom",1,"btn","btn-outline",3,"click","disableTooltip","disabled","ngClass"]],template:function(e,i){if(e&1&&(n(0,"div",0)(1,"h4",1)(2,"span",2)(3,"i",3),p(4,"span",4)(5,"span",5)(6,"span",6),a()(),o(7),a(),n(8,"button",7),C("click",function(){return i.closeModal()}),n(9,"i",8),p(10,"span",4)(11,"span",5),a()()(),n(12,"div",9)(13,"form",10)(14,"section",11)(15,"div",12)(16,"label",13),o(17,"Seleccionar Paciente"),a(),p(18,"ng-select",14),m(19,"async"),m(20,"async"),a(),n(21,"div",12)(22,"label",15),o(23,"Seleccionar Tipo de Cita"),a(),n(24,"ng-select",16),m(25,"async"),m(26,"async"),C("change",function(h){return i.changeTipoCita(h)}),a()()(),n(27,"section",11)(28,"div",12)(29,"label",17),o(30,"Seleccionar Sede"),a(),n(31,"ng-select",18),m(32,"async"),m(33,"async"),C("change",function(h){return i.onChangeSede(h)}),a()()(),n(34,"div",11)(35,"div",19)(36,"label",13),o(37,"Fecha"),a(),p(38,"input",20),a(),n(39,"div",19)(40,"label",21),o(41,"Hora de Inicio"),a(),p(42,"input",22),a(),n(43,"div",19)(44,"label",23),o(45,"Hora de Fin"),a(),p(46,"input",24),a()(),n(47,"div",11)(48,"div",12)(49,"label",17),o(50,"Terapia Asignada"),a(),p(51,"input",25),a(),n(52,"div",12)(53,"label",17),o(54,"Seleccionar Terapista Disponible"),a(),p(55,"ng-select",26),m(56,"async"),a()(),T(57,Ye,6,1,"div",27),a()(),n(58,"div",28)(59,"button",29),C("click",function(){return i.closeModal()}),o(60,"Cancelar"),a(),n(61,"button",30),m(62,"async"),C("click",function(){return i.createCita()}),o(63,"Registrar"),a()()),e&2){let r;s(7),x(" Registrar Cita de ",i.terapia==null?null:i.terapia.nombre," "),s(6),c("formGroup",i.createForm),s(5),c("items",u(19,20,i.pacientesList))("loading",u(20,22,i.isLoading))("loadingText","Cargando..."),s(6),c("items",u(25,24,i.tipoCitasList))("loading",u(26,26,i.isLoading))("loadingText","Cargando..."),s(7),c("items",u(32,28,i.sedesList))("loading",u(33,30,i.isLoading))("loadingText","Cargando..."),s(7),c("noCalendar",!0)("altInput",!0)("altFormat","d/m/Y"),s(13),c("value",i.terapia==null?null:i.terapia.nombre),s(4),c("items",i.personalList)("loading",u(56,32,i.isLoading))("loadingText","Cargando..."),s(2),c("ngIf",((r=i.createForm.get("id_personal"))==null?null:r.value)&&i.isCitaContinua),s(4),c("disabled",i.createForm.invalid||u(62,34,i.isLoading))}},dependencies:[H,xe,ye,Se,V,P,pe,me,O,Ce,ge,he,fe,be,ve,_e,Fe,Ee]}),f);U=w([G({checkProperties:!0}),L("design:paramtypes",[A])],U);var Ze=["calendar"],Xe=()=>[qe,P,O],et=d=>({"opacity-50":d});function tt(d,t){if(d&1&&(p(0,"full-calendar",10,0),m(2,"async"),m(3,"async")),d&2){let e=S();c("ngClass",de(7,et,u(2,3,e.isLoading)))("events",u(3,5,e.citasEvent))("options",e.calendarOptions)}}function it(d,t){d&1&&(n(0,"h1"),o(1,"Loading..."),a())}var b,Ge=(b=class{get bodyParams(){return{id_terapia:this.terapiaId,startWeek:this.startWeek,endWeek:this.endWeek}}constructor(t,e){this.route=t,this.changeDetector=e,this.citasService=l(j),this.modalService=l(B),this.isLoading=l(R).isLoading,this.terapiasService=l(W),this.router=l(ue),this.terapiaId=this.route.snapshot.params.tag,this.loading=!0,this.startWeek=$().startOfWeek,this.endWeek=$().endOfWeek,this.citasEvent=new _,this.calendarOptions={plugins:[Ie,Ne,Pe,Oe],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},initialView:"timeGridWeek",allDaySlot:!1,expandRows:!0,eventMinHeight:30,slotLabelInterval:"00:05:00",slotMinTime:"08:00",slotMaxTime:"20:00:00",slotLabelFormat:{hour:"numeric",minute:"2-digit",omitZeroMinute:!1,meridiem:"narrow"},weekends:!0,editable:!0,selectable:!0,selectMirror:!0,dayMaxEvents:!0,eventClick:this.handleEventClick.bind(this),loading:i=>{this.loading=i},locale:Ve,select:this.handleDateSelect.bind(this),datesSet:i=>{this.startWeek=i.view.activeStart,this.endWeek=i.view.activeEnd,this.loadCitas(this.bodyParams)}},this.route.params.subscribe(()=>{this.startWeek=this.calendar?.getApi()?.view.currentStart,this.endWeek=this.calendar?.getApi()?.view.currentEnd})}ngOnInit(){this.route.params.pipe(J(({tag:t})=>this.terapiaId=t)).subscribe(t=>{this.loadCurrentTerapia(),this.loadCitas(this.bodyParams)})}handleDateSelect(t){let e=this.modalService.open(U,{size:"lg",centered:!0});e.componentInstance.terapia=this.currentTerapia,e.componentInstance.createForm.patchValue({fecha_inicio:t.startStr.substring(0,10),hora_inicio:t.startStr.substring(11,16),hora_fin:t.endStr.substring(11,16)}),e.componentInstance.eventSubmitted.subscribe(()=>{this.loadCitas(this.bodyParams)})}handleEventClick(t){let e=t.event,i=this.modalService.open(We,{centered:!0,size:"100",scrollable:!0,backdrop:"static"});window.document.body.classList.add("modal-open"),i.componentInstance.eventId=e.id,i.componentInstance.citaId=e.extendedProps.id_cita,i.componentInstance.eventUpdated.subscribe(()=>{this.loadCitas(this.bodyParams)})}loadCitas(t){if(this.terapiaId)return this.citasEvent=this.citasService.getByTerapia(t).pipe(Y((e,i)=>JSON.stringify(e)===JSON.stringify(i)),g(e=>e.data))}loadCurrentTerapia(){return this.terapiasService.getById(this.terapiaId).pipe(g(t=>this.currentTerapia=t.data),J(()=>this.calendarOptions=D(F({},this.calendarOptions),{slotDuration:this.currentTerapia?.duracion}))).subscribe()}},b.\u0275fac=function(e){return new(e||b)(k(q),k(N))},b.\u0275cmp=M({type:b,selectors:[["app-cronograma"]],viewQuery:function(e,i){if(e&1&&oe(Ze,5),e&2){let r;le(r=se())&&(i.calendar=r.first)}},standalone:!0,features:[I],decls:16,vars:1,consts:[["calendar",""],["header-title",""],[1,"d-flex","flex-column","text-white","fw-bold","my-1"],[1,"content","d-flex","flex-column","flex-column-fluid"],["id","kt_content_container",1,"container-xxl"],[1,"card"],[1,"card-header"],[1,"card-toolbar","d-flex","ms-auto","justify-content-end"],[1,"card-body",2,"border","none","box-shadow","0 4px 8px rgba(0, 0, 0, 0.1)","border-radius","0 0 15px 15px"],[1,"demo-app-main"],[3,"ngClass","events","options"]],template:function(e,i){e&1&&(n(0,"app-header"),ae(1,1),n(2,"h1",2),o(3),a(),ne(),a(),n(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6)(8,"div",7),p(9,"app-dropdown"),a()(),n(10,"div",8)(11,"div",9),T(12,tt,4,9)(13,it,2,0),te(14,12,Xe,null,13),ie(0,-1),a()()()()()),e&2&&(s(3),x(" ",i.currentTerapia==null?null:i.currentTerapia.nombre," "))},dependencies:[Ae,V,Te,H,ke]}),b);Ge=w([G({checkProperties:!0}),L("design:paramtypes",[q,N])],Ge);export{Ge as CronogramaComponent};
