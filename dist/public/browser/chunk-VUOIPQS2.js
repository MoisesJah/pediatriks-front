import{a as B}from"./chunk-U2EAJGNN.js";import{t as m,u as P}from"./chunk-AAYOZ3JU.js";import{a as G}from"./chunk-NMGGHNE5.js";import{a as F}from"./chunk-BIMAMPZW.js";import{a as L}from"./chunk-KNEUCQQI.js";import"./chunk-GKZUPR7X.js";import"./chunk-ZM3MROS5.js";import{m as N,t as k,v as R}from"./chunk-DP3M2V7L.js";import{Aa as d,C as b,Gc as w,Ic as I,Ka as p,La as f,Lb as C,Nc as h,Oc as S,Pb as x,Rb as y,Ub as g,bc as o,cc as r,dc as T,ec as A,fc as D,hc as E,n as _,nc as c,oc as u,vb as v,wa as a,yc as l}from"./chunk-B7JMKZ3I.js";var M=(()=>{class n{constructor(){this.authService=a(F),this.solicitudInventarioService=a(m),this.user=this.authService.user()}ngOnInit(){}agInit(e){this.params=e,this.solicitud=e.data}aceptarSolicitud(e,i){if(!e||!i){console.error("Faltan datos para aceptar la solicitud.");return}this.solicitudInventarioService.aceptarSolicitud(e,i).subscribe({next:()=>{console.log("Solicitud Aceptada"),this.params?.onAcepted&&this.params.onAcepted(this.solicitud)},error:t=>{console.error("Error al aceptar solicitud:",t)}})}negarSolicitud(e,i){if(!e||!i){console.error("Faltan datos para negar la solicitud.");return}this.solicitudInventarioService.negarSolicitud(e,i).subscribe({next:()=>{console.log("Solicitud Negada"),this.params?.onDenied&&this.params.onDenied(this.solicitud)},error:t=>{console.error("Error al negar solicitud:",t)}})}refresh(e){return this.solicitud=e.data,!0}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=d({type:n,selectors:[["app-solicitudes-action-buttons"]],decls:5,vars:0,consts:[[1,"d-flex","align-items-center","gap-2",2,"padding-block","0.15rem"],[1,"btn","btn-sm","btn-success","me-2",3,"click"],[1,"btn","btn-sm","btn-danger","me-2",3,"click"]],template:function(i,t){i&1&&(o(0,"div",0)(1,"button",1),c("click",function(){return t.aceptarSolicitud(t.solicitud==null?null:t.solicitud.id_solicitud,t.user==null?null:t.user.id)}),l(2,"Aceptar"),r(),o(3,"button",2),c("click",function(){return t.negarSolicitud(t.solicitud==null?null:t.solicitud.id_solicitud,t.user==null?null:t.user.id)}),l(4,"Negar"),r()())}})}}return n})();var V=()=>[k,import("./chunk-TDDSBCRP.js").then(n=>n.AgGridAngular)],j=n=>[n];function q(n,z){if(n&1){let e=E();o(0,"ag-grid-angular",12),h(1,"async"),h(2,"async"),c("gridReady",function(t){p(e);let s=u();return f(s.gridReady(t))})("gridReady",function(t){p(e);let s=u();return f(s.gridReady(t))}),r()}if(n&2){let e=u();g("rowData",S(1,6,e.solicitudes))("columnDefs",e.colDefs)("enableCellTextSelection",!0)("localeText",e.localeText)("pagination",!0)("loading",S(2,8,e.isLoading))}}function H(n,z){n&1&&(o(0,"div",13)(1,"div",14)(2,"span",15),l(3,"Loading..."),r()()())}var le=(()=>{class n{constructor(){this.solicitudInventarioService=a(m),this.solicitudes=new _,this.isLoading=a(G).isLoading,this.theme=a(L),this.localeText=B,this.solicitudesPendientes=[],this.colDefs=[{headerName:"Personal Solicitante",valueGetter:e=>e.data.personal_solicita?.nombre||"N/A",sortable:!0,filter:!0},{headerName:"\xCDtem Solicitado",valueGetter:e=>e.data.item?.nombre||"N/A",sortable:!0,filter:!0},{field:"cantidad",headerName:"Cantidad",sortable:!0,filter:!0},{headerName:"Estado de la Solicitud",valueGetter:e=>e.data.estado?.nombre||"N/A",sortable:!0,filter:!0},{headerName:"Fecha Solicitud",valueGetter:e=>e.data.fecha_solicitud||"N/A",sortable:!0,filter:!0,valueFormatter:e=>new Date(e.value).toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},{headerName:"Acciones",cellRenderer:M,cellRendererParams:{onAcepted:e=>{let i=e.id_solicitud;this.aceptarSolicitud(i,"personal_id")},onDenied:e=>{let i=e.id_solicitud;this.negarSolicitud(i,"personal_id")}},maxWidth:200,resizable:!1}]}ngOnInit(){this.fetchSolicitudes()}fetchSolicitudes(){this.solicitudes=this.solicitudInventarioService.cargarTodasLasSolicitudes().pipe(b(e=>e.data))}loadTabla(){this.fetchSolicitudes()}gridReady(e){e.api.sizeColumnsToFit()}aceptarSolicitud(e,i){this.solicitudInventarioService.aceptarSolicitud(e,i).subscribe({next:()=>{console.log("Solicitud Aceptada"),this.solicitudesPendientes=this.solicitudesPendientes.filter(t=>t.id_solicitud!==e)},error:t=>{console.error("Error al aceptar solicitud:",t)}})}negarSolicitud(e,i){this.solicitudInventarioService.negarSolicitud(e,i).subscribe({next:()=>{console.log("Solicitud Negada"),this.solicitudesPendientes=this.solicitudesPendientes.filter(t=>t.id_solicitud!==e)},error:t=>{console.error("Error al negar solicitud:",t)}})}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=d({type:n,selectors:[["app-tabla-solicitudes"]],standalone:!0,features:[w],decls:19,vars:3,consts:[["header-title",""],[1,"d-flex","flex-column","text-gray-900","fw-bold","my-1"],[2,"color","white"],[1,"content","d-flex","flex-column","flex-column-fluid"],[1,"card","card-flush","h-xl-50","scaled-container"],[1,"d-flex","p-5","justify-content-between","align-items-center"],[1,"d-flex","align-items-center","gap-3"],["type","button",1,"btn","btn-light-primary",3,"click"],[1,"d-flex","align-items-center"],[1,"fa-solid","fa-rotate-right"],[1,"ms-2"],["id","myGrid",2,"height","calc(100dvh - 281px)",3,"ngClass"],["loadingMessage","Cargando...",2,"width","100%","height","100%",3,"gridReady","rowData","columnDefs","enableCellTextSelection","localeText","pagination","loading"],[1,"d-flex","justify-content-center","align-items-center",2,"height","100%"],["role","status",1,"spinner-border"],[1,"visually-hidden"]],template:function(i,t){i&1&&(o(0,"app-header"),A(1,0),o(2,"h1",1)(3,"span",2),l(4,"Solicitudes"),r()(),D(),r(),o(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6)(9,"button",7),c("click",function(){return t.loadTabla()}),o(10,"span",8),T(11,"span",9),o(12,"span",10),l(13,"Actualizar"),r()()()()(),o(14,"div",11),C(15,q,3,10)(16,H,4,0),x(17,15,V,16),y(),r()()()),i&2&&(v(14),g("ngClass",I(1,j,t.theme.getThemeMode()==="light"?"ag-theme-quartz":"ag-theme-quartz-dark")))},dependencies:[R,N,P]})}}return n})();export{le as TablaSolicitudesComponent};
