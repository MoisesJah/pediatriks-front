import{A as W,a as V,b as z,c as $,d as G,e as U,f as J,g as K,z as Q}from"./chunk-KLLKZ3UM.js";import"./chunk-MGQU4BYR.js";import{a as ie}from"./chunk-YJLVBRVV.js";import{a as ne}from"./chunk-UZO5QNZS.js";import{c as ee}from"./chunk-XKOQY6PJ.js";import{a as te}from"./chunk-U2EAJGNN.js";import{a as Y}from"./chunk-RQ4VGEOD.js";import{a as Z,b as C}from"./chunk-PIACHCSP.js";import{a as X}from"./chunk-J6P2CT7J.js";import"./chunk-GKZUPR7X.js";import{j as O}from"./chunk-APQUY7ND.js";import{m as B,o as F,t as k,w as R}from"./chunk-JS4ZJV2L.js";import{Ba as A,C as _,Fc as l,Gc as L,Ic as H,La as v,Ma as S,Mb as f,Mc as I,Oc as E,Qc as M,Vb as d,Vc as g,Wc as u,aa as q,bc as P,dc as j,ec as D,fc as n,gc as a,hc as b,lc as N,n as h,r as x,uc as y,v as w,vc as m,wb as s,xa as p}from"./chunk-B762IU3Y.js";var oe=o=>[o];function re(o,e){o&1&&(n(0,"div",4)(1,"div",5)(2,"span",6),l(3,"Cargando..."),a()()())}function se(o,e){if(o&1&&(n(0,"div",22)(1,"span"),l(2,"Total de Sesiones"),a(),n(3,"div",23),b(4,"ngb-progressbar",24),n(5,"span",25),l(6),a()()()),o&2){let t=m().$implicit;s(4),d("value",t.num_sesiones)("max",t.total_sesiones),s(2),H("",t.num_sesiones," / ",t.total_sesiones,"")}}function le(o,e){if(o&1){let t=N();n(0,"div",7),y("shown",function(){let r=v(t).$implicit,c=m();return S(c.loadHistorialData(r.id))}),n(1,"div",8)(2,"div",9)(3,"div",10)(4,"span",11),l(5),a(),f(6,se,7,4,"div",12),a(),n(7,"button",13),b(8,"i",14),l(9," Historial "),a()(),n(10,"div",15)(11,"div",16)(12,"div",17)(13,"span",18),l(14,"Historial de compras"),a(),n(15,"button",19),y("click",function(){let r=v(t).$implicit,c=m();return S(c.loadHistorialData(r.id,!0))}),l(16,"Actualizar"),a()(),n(17,"div",20),b(18,"ag-grid-angular",21),g(19,"async"),g(20,"async"),a()()()()()}if(o&2){let t=e.$implicit,i=m();d("destroyOnHide",!0),s(5),L(t.paquete),s(),d("ngIf",t.total_sesiones>0),s(11),d("ngClass",M(15,oe,i.theme.getThemeMode()==="light"?"ag-theme-quartz":"ag-theme-quartz-dark")),s(),d("rowData",u(19,11,i.getHistorialSubject(t.id)))("columnDefs",i.columnDefs)("loading",u(20,13,i.getLoadingState(t.id)))("localeText",i.localeText)("enableCellTextSelection",!0)("ariaHidden",!0)("pagination",!0)}}function de(o,e){o&1&&(n(0,"div",0)(1,"div",0)(2,"div",26)(3,"span",27),l(4,"No se encontraron paquetes"),a()()()())}var ae=class T{constructor(){this.reporteService=p(ie),this.activatedRoute=p(O),this.isLoading=p(Y).isLoading,this.theme=p(X),this.id_paciente=this.activatedRoute.snapshot.paramMap.get("id"),this.localeText=te,this.historialList=new h,this.paquetesList=new h,this.historialData=[],this.historialSubjects=new Map,this.dataLoaded=new Map,this.loadingStates=new Map,this.columnDefs=[{field:"num_sesiones",headerName:"N\xB0 Sesiones",filter:!0},{field:"metodo_pago",headerName:"M\xE9todo de Pago",filter:!0},{field:"precio",headerName:"Precio",filter:!0},{field:"created_at",headerName:"Fecha Compra",filter:!0,cellRenderer:e=>ne(e.data.created_at)}]}ngOnInit(){this.getPaquetes()}getHistorialSubject(e){if(!this.historialSubjects.has(e)){let t=new x([]);this.historialSubjects.set(e,t)}return this.historialSubjects.get(e)}getLoadingState(e){if(!this.loadingStates.has(e)){let t=new x(!1);this.loadingStates.set(e,t)}return this.loadingStates.get(e)}loadHistorialData(e,t=!1){this.getLoadingState(e).next(!0),this.reporteService.getPaquetes(this.id_paciente).pipe(_(i=>i.data.compras.flatMap(r=>r.historial.filter(c=>c.id_paq===e))),q(()=>this.getLoadingState(e).next(!1)),C(this)).subscribe(i=>{this.getHistorialSubject(e).next(i)})}getPaquetes(){this.paquetesList=this.reporteService.getPaquetes(this.id_paciente).pipe(_(e=>e.data.compras),C(this))}static{this.\u0275fac=function(t){return new(t||T)}}static{this.\u0275cmp=A({type:T,selectors:[["app-tab-paquetes"]],standalone:!0,features:[E],decls:8,vars:6,consts:[[1,"d-flex","flex-column","gap-4"],["class","loading-container d-flex justify-content-center align-items-center",4,"ngIf"],["ngbAccordion","",1,"card","card-body","border-1","border-gray-300","d-flex","gap-4",3,"destroyOnHide"],["class","d-flex flex-column gap-4",4,"ngIf"],[1,"loading-container","d-flex","justify-content-center","align-items-center"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],["ngbAccordion","",1,"card","card-body","border-1","border-gray-300","d-flex","gap-4",3,"shown","destroyOnHide"],["ngbAccordionItem",""],[1,"d-flex","px-4","justify-content-between","align-items-center"],[1,"d-flex","align-items-center","gap-5"],["ngbAccordionHeader","",1,"fw-bold","fs-5"],["class","d-flex flex-column gap-2","style","min-width: 200px;",4,"ngIf"],["ngbAccordionToggle","",1,"btn","btn-sm","btn-outline","btn-secondary"],[1,"ki-outline","ki-eye","fs-4"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],[1,"d-flex","justify-content-between","align-items-center"],[1,"fw-bold","fs-5"],[1,"btn","btn-sm","btn-info","btn-outline","mb-2",3,"click"],[2,"height","300px",3,"ngClass"],[2,"width","100%","height","100%",3,"rowData","columnDefs","loading","localeText","enableCellTextSelection","ariaHidden","pagination"],[1,"d-flex","flex-column","gap-2",2,"min-width","200px"],[1,"d-flex","align-items-center","gap-2"],["type","primary",1,"flex-grow-1",3,"value","max"],[1,"fw-bold"],[1,"d-flex","flex-column","align-items-center","gap-3"],[1,"fw-bold","fs-3","mt-5"]],template:function(t,i){if(t&1&&(n(0,"div",0),I(1),g(2,"async"),f(3,re,4,0,"div",1),g(4,"async"),j(5,le,21,17,"div",2,P),f(7,de,5,0,"div",3),a()),t&2){let r=u(2,2,i.paquetesList);s(3),d("ngIf",u(4,4,i.isLoading)),s(2),D(r),s(2),d("ngIf",(r==null?null:r.length)===0)}},dependencies:[ee,R,B,F,k,K,J,U,G,$,V,z,W,Q]})}};ae=w([Z()],ae);export{ae as TabPaquetesComponent};
