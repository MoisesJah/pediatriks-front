import{a as M}from"./chunk-U2EAJGNN.js";import{a as m,b as B}from"./chunk-ESGQTXWU.js";import"./chunk-SZA4NEXD.js";import{a as P}from"./chunk-5ZMKPZZY.js";import{a as F}from"./chunk-3IC3XWDF.js";import"./chunk-T3S5D2ZO.js";import{a as G}from"./chunk-H7V4WWIX.js";import"./chunk-GKZUPR7X.js";import"./chunk-DA7F7PFS.js";import{m as I,t as L,v as R}from"./chunk-IVHFDWNE.js";import{Ba as c,Bc as s,C as v,Jc as N,La as f,Lc as k,Ma as g,Mb as x,Qb as T,Qc as S,Rc as _,Sb as y,Vb as h,ec as o,fc as a,gc as A,hc as D,ic as E,kc as w,n as b,qc as d,rc as u,wb as C,xa as l}from"./chunk-MKY54U27.js";var z=(()=>{class n{constructor(){this.authService=l(F),this.solicitudInventarioService=l(m),this.user=this.authService.user()}ngOnInit(){}agInit(e){this.params=e,this.solicitud=e.data}aceptarSolicitud(e,i){if(!e||!i){console.error("Faltan datos para aceptar la solicitud.");return}this.solicitudInventarioService.aceptarSolicitud(e,i).subscribe({next:()=>{console.log("Solicitud Aceptada"),this.params?.onAcepted&&this.params.onAcepted(this.solicitud)},error:t=>{console.error("Error al aceptar solicitud:",t)}})}negarSolicitud(e,i){if(!e||!i){console.error("Faltan datos para negar la solicitud.");return}this.solicitudInventarioService.negarSolicitud(e,i).subscribe({next:()=>{console.log("Solicitud Negada"),this.params?.onDenied&&this.params.onDenied(this.solicitud)},error:t=>{console.error("Error al negar solicitud:",t)}})}refresh(e){return this.solicitud=e.data,!0}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=c({type:n,selectors:[["app-solicitudes-action-buttons"]],decls:5,vars:0,consts:[[1,"d-flex","align-items-center","gap-2",2,"padding-block","0.15rem"],[1,"btn","btn-sm","btn-success","me-2",3,"click"],[1,"btn","btn-sm","btn-danger","me-2",3,"click"]],template:function(i,t){i&1&&(o(0,"div",0)(1,"button",1),d("click",function(){return t.aceptarSolicitud(t.solicitud==null?null:t.solicitud.id_solicitud,t.user==null?null:t.user.id)}),s(2,"Aceptar"),a(),o(3,"button",2),d("click",function(){return t.negarSolicitud(t.solicitud==null?null:t.solicitud.id_solicitud,t.user==null?null:t.user.id)}),s(4,"Negar"),a()())}})}}return n})();var q=()=>[L,import("./chunk-QD4DKI47.js").then(n=>n.AgGridAngular)],H=n=>[n];function W(n,O){if(n&1){let e=w();o(0,"ag-grid-angular",12),S(1,"async"),S(2,"async"),d("gridReady",function(t){f(e);let r=u();return g(r.gridReady(t))})("gridReady",function(t){f(e);let r=u();return g(r.gridReady(t))}),a()}if(n&2){let e=u();h("rowData",_(1,6,e.solicitudes))("columnDefs",e.colDefs)("enableCellTextSelection",!0)("localeText",e.localeText)("pagination",!0)("loading",_(2,8,e.isLoading))}}function J(n,O){n&1&&(o(0,"div",13)(1,"div",14)(2,"span",15),s(3,"Loading..."),a()()())}var de=(()=>{class n{constructor(){this.solicitudInventarioService=l(m),this.solicitudes=new b,this.isLoading=l(P).isLoading,this.theme=l(G),this.localeText=M,this.solicitudesPendientes=[],this.colDefs=[{headerName:"Personal Solicitante",valueGetter:e=>e.data.personal_solicita?.nombre||"N/A",sortable:!0,filter:!0},{headerName:"\xCDtem Solicitado",valueGetter:e=>e.data.item?.nombre||"N/A",sortable:!0,filter:!0},{field:"cantidad",headerName:"Cantidad",sortable:!0,filter:!0},{headerName:"Stock Terapista",field:"stock_terapista",sortable:!0,filter:!0,valueGetter:e=>e.data.stock_terapista||"0"},{headerName:"Estado de la Solicitud",valueGetter:e=>e.data.estado?.nombre||"N/A",sortable:!0,filter:!0},{headerName:"Fecha Solicitud",valueGetter:e=>e.data.fecha_solicitud||"N/A",sortable:!0,filter:!0,valueFormatter:e=>new Date(e.value).toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},{headerName:"Acciones",cellRenderer:z,cellRendererParams:e=>({habilitado:(e.data.estado?.nombre||"").toLowerCase()==="pendiente",onAcepted:r=>{let p=r.id_solicitud;this.aceptarSolicitud(p,"personal_id")},onDenied:r=>{let p=r.id_solicitud;this.negarSolicitud(p,"personal_id")}}),maxWidth:200,resizable:!1}]}ngOnInit(){this.fetchSolicitudes()}fetchSolicitudes(){this.solicitudes=this.solicitudInventarioService.cargarTodasLasSolicitudes().pipe(v(e=>e.data))}loadTabla(){this.fetchSolicitudes()}gridReady(e){e.api.sizeColumnsToFit()}aceptarSolicitud(e,i){this.solicitudInventarioService.aceptarSolicitud(e,i).subscribe({next:()=>{console.log("Solicitud Aceptada"),this.solicitudesPendientes=this.solicitudesPendientes.filter(t=>t.id_solicitud!==e)},error:t=>{console.error("Error al aceptar solicitud:",t)}})}negarSolicitud(e,i){this.solicitudInventarioService.negarSolicitud(e,i).subscribe({next:()=>{console.log("Solicitud Negada"),this.solicitudesPendientes=this.solicitudesPendientes.filter(t=>t.id_solicitud!==e)},error:t=>{console.error("Error al negar solicitud:",t)}})}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=c({type:n,selectors:[["app-tabla-solicitudes"]],standalone:!0,features:[N],decls:19,vars:3,consts:[["header-title",""],[1,"d-flex","flex-column","text-gray-900","fw-bold","my-1"],[2,"color","white"],[1,"content","d-flex","flex-column","flex-column-fluid"],[1,"card","card-flush","h-xl-50","scaled-container"],[1,"d-flex","p-5","justify-content-between","align-items-center"],[1,"d-flex","align-items-center","gap-3"],["type","button",1,"btn","btn-light-primary",3,"click"],[1,"d-flex","align-items-center"],[1,"fa-solid","fa-rotate-right"],[1,"ms-2"],["id","myGrid",2,"height","calc(100dvh - 281px)",3,"ngClass"],["loadingMessage","Cargando...",2,"width","100%","height","100%",3,"gridReady","rowData","columnDefs","enableCellTextSelection","localeText","pagination","loading"],[1,"d-flex","justify-content-center","align-items-center",2,"height","100%"],["role","status",1,"spinner-border"],[1,"visually-hidden"]],template:function(i,t){i&1&&(o(0,"app-header"),D(1,0),o(2,"h1",1)(3,"span",2),s(4,"Solicitudes"),a()(),E(),a(),o(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6)(9,"button",7),d("click",function(){return t.loadTabla()}),o(10,"span",8),A(11,"span",9),o(12,"span",10),s(13,"Actualizar"),a()()()()(),o(14,"div",11),x(15,W,3,10)(16,J,4,0),T(17,15,q,16),y(),a()()()),i&2&&(C(14),h("ngClass",k(1,H,t.theme.getThemeMode()==="light"?"ag-theme-quartz":"ag-theme-quartz-dark")))},dependencies:[R,I,B]})}}return n})();export{de as TablaSolicitudesComponent};
