import{a as _e}from"./chunk-J2IANQEO.js";import{kb as ue}from"./chunk-LCUQXNNV.js";import{a as me}from"./chunk-U3X3T6AK.js";import{a as pe}from"./chunk-VRSJ2P2Y.js";import{a as ce}from"./chunk-YBOIPEH3.js";import{a as oe}from"./chunk-VIK6P75G.js";import{a as le}from"./chunk-5DLWNDQZ.js";import{a as de}from"./chunk-TXW7SD3L.js";import{a as Ce}from"./chunk-GULRCE2W.js";import{c as re}from"./chunk-56DO2HCL.js";import{a as se}from"./chunk-4BKNE7VM.js";import{n as N,o as q}from"./chunk-47BWZHPK.js";import{c as X,d as _,e as z,f as K,k as W,o as Z,p as ee,q as te,r as ie,y as I}from"./chunk-JV7DKPVM.js";import{a as ne}from"./chunk-MKNMNAUM.js";import{a as ae,b as x}from"./chunk-TA6YOJTR.js";import{m as $,n as Y,o as J,t as U}from"./chunk-CWIGPBJP.js";import{Ba as G,Bc as M,C as b,Cc as w,Dc as F,Fc as d,Hc as H,La as C,Ma as S,Mb as y,Sc as j,Ua as P,Vb as s,W as L,Xc as k,Yc as T,Z as B,f as be,fc as o,gc as a,hc as u,ic as Q,jc as R,lc as E,n as g,uc as f,v as A,vc as m,w as O,wb as l,xa as v,xb as V}from"./chunk-JCDSCFF6.js";var fe=be(Ce());var Se=["startTimePicker"],ye=["endTimePicker"],xe=["datePicker"],Ee=c=>({"btn-active-primary active":c});function ke(c,e){if(c&1){let t=E();o(0,"div",41)(1,"button",42),f("click",function(){C(t);let n=m().index,r=m();return S(r.removeInfoTerapia(n))}),u(2,"i",43),a()()}}function Te(c,e){if(c&1){let t=E();o(0,"button",48),f("click",function(){let n=C(t).$implicit,r=m(2).index,p=m();return S(p.toggleOption(n,r))}),d(1),a()}if(c&2){let t=e.$implicit,i=m(2).index,n=m();s("ngClass",j(2,Ee,n.isOptionSelected(t,i))),l(),H(" ",t.label," ")}}function Ve(c,e){if(c&1&&(o(0,"div",13)(1,"div",44)(2,"label",45),d(3,"Dias de Recurrencia"),a(),o(4,"div",46),y(5,Te,2,4,"button",47),a()()()),c&2){let t=m(2);l(5),s("ngForOf",t.options)}}function Me(c,e){if(c&1){let t=E();Q(0),o(1,"div",34),y(2,ke,3,0,"div",35),o(3,"div",13)(4,"div",36)(5,"label",37),d(6,"Terapia"),a(),o(7,"ng-select",38),k(8,"async"),f("change",function(n){let r=C(t).index,p=m();return S(p.getTerapiaId(n,r))}),a()(),o(9,"div",36)(10,"label",37),d(11,"Especialista"),a(),u(12,"ng-select",39),a()(),y(13,Ve,6,1,"div",40),a(),R()}if(c&2){let t=e.index,i=m();l(),s("formGroupName",t),l(),s("ngIf",t>0),l(5),s("items",T(8,7,i.terapiasList))("loadingText","Cargando.."),l(5),s("items",i.avaiblePersonal[t])("loadingText","Cargando.."),l(),s("ngIf",i.isCitaContinua)}}function we(c,e){if(c&1){let t=E();o(0,"div",49)(1,"button",50),f("click",function(){C(t);let n=m();return S(n.closeModal())}),d(2,"Cancelar"),a(),o(3,"button",51),f("click",function(){C(t);let n=m();return S(n.submitEvent())}),d(4,"Guardar"),a()()}}var ve=class D{constructor(e,t,i){this.activeModal=e,this.modalService=t,this.fb=i,this.event=null,this.eventSubmitted=new P,this.eventDeleted=new P,this.terapiaService=v(le),this.sedesService=v(ce),this.personalService=v(oe),this.pacienteService=v(de),this.tipoCitaService=v(_e),this.paquetesService=v(pe),this.isLoading=v(ne).isLoading,this.citaService=v(me),this.terapiasList=new g,this.sedesList=new g,this.pacientesList=new g,this.personalList=new g,this.tipoCitasList=new g,this.paquetesList=new g,this.es=fe.default.es,this.isCitaContinua=!1,this.terapiasId=[],this.paquetesId=[],this.timeOptions={enableTime:!0,noCalendar:!0,dateFormat:"H:i"},this.avaiblePersonal=[],this.options=[{label:"L",value:1},{label:"M",value:2},{label:"MI",value:3},{label:"J",value:4},{label:"V",value:5}],this.isOptionSelected=(r,p)=>this.eventForm.get("detalle").at(p)?.get("recurrencia")?.value?.includes(r.value);let n=new Date;this.minDate=this.formatDate(n),this.eventForm=this.fb.group({id_paciente:[null,_.required],id_sede:[null,_.required],fecha_inicio:["",_.required],hora_inicio:["",_.required],hora_fin:["",_.required],id_tipocita:[null,_.required],detalle:this.fb.array([this.createDetalle()])})}get detalle(){return this.eventForm.get("detalle")}changeTipoCita(e){this.isCitaContinua=e?.nombre&&e?.nombre!=="Evaluaci\xF3n",this.isCitaContinua&&this.detalle.controls.forEach(t=>{t.get("id_paquete")?.setValidators(_.required)})}changePaquete(e,t){(this.eventForm.get("detalle").at(t)?.get("num_sesiones")).setValue(e?.cantidadsesiones)}toggleOption(e,t){let n=this.eventForm.get("detalle").at(t)?.get("recurrencia"),r=n.value;r.indexOf(e.value)===-1?n.setValue([...r,e.value]):n.setValue(r.filter(h=>h!==e.value))}onStartTimeChange(e,t){let[i,n]=e.dateString.split(":").map(Number),r=new Date;r.setHours(i,n+5),(this.detalle.at(t)?.get("hora_fin")).setValue(r.toTimeString().slice(0,5))}createDetalle(){return this.fb.group({id_terapia:[null,_.required],id_paquete:[null],num_sesiones:[null],id_personal:[null,_.required],recurrencia:this.fb.control([])})}addInfoTerapia(){this.detalle.push(this.createDetalle())}removeInfoTerapia(e){this.detalle.removeAt(e)}ngOnInit(){this.loadTerapias(),this.loadSedes(),this.loadPacientes(),this.loadPersonal(),this.loadTipoCitas()}getTerapiaId(e,t){this.isCitaContinua&&e?(this.terapiasId[t]=e.id_terapia,this.terapiaService.getPaquetesByTerapia(e.id_terapia).pipe(L(1)).subscribe(i=>this.paquetesId[t]=i.data)):(this.paquetesId[t]=[],this.detalle.at(t).get("id_personal")?.setValue(null),this.detalle.at(t).get("id_paquete")?.setValue(null))}ngAfterViewInit(){this.eventForm.valueChanges.pipe(B((e,t)=>JSON.stringify(e)===JSON.stringify(t))).subscribe(e=>{let t=e.id_sede;e.detalle.forEach((n,r,p)=>{let h={id_terapia:p[r].id_terapia,fecha_inicio:p[r].fecha_inicio,hora_inicio:p[r].hora_inicio,hora_fin:p[r].hora_fin,id_sede:t};[h.id_terapia,h.fecha_inicio,h.hora_inicio,h.hora_fin].every(Boolean)&&t?this.citaService.getAvailablePersonal(h).pipe(L(1)).subscribe({next:ge=>{this.avaiblePersonal[r]=ge.data},error:()=>{this.avaiblePersonal[r]=[]}}):(this.avaiblePersonal[r]=[],this.detalle.at(r).get("id_personal")?.setValue(null))})})}loadTerapias(){this.terapiasList=this.terapiaService.getAll().pipe(b(e=>e.data),x(this))}loadSedes(){this.sedesList=this.sedesService.getAll().pipe(b(e=>e.data),x(this))}loadTipoCitas(){this.tipoCitasList=this.tipoCitaService.getAll().pipe(b(e=>e.data),x(this))}loadPacientes(){this.pacientesList=this.pacienteService.getAll().pipe(b(e=>e.data),x(this))}loadPersonal(){this.personalList=this.personalService.getAll().pipe(b(e=>e.data),x(this))}openEditModal(){this.activeModal.close(),setTimeout(()=>{let e=this.modalService.open(ue,{size:"lg"});e.componentInstance.event=this.event,e.componentInstance.isEditMode=!0,e.componentInstance.eventUpdated.subscribe(t=>{this.eventSubmitted.emit(t),console.log("Event updated:",t)})},300)}closeModal(){this.activeModal.dismiss()}submitEvent(){console.log(this.eventForm.value)}deleteEvent(){this.event&&(this.eventDeleted.emit(this.event.id),this.activeModal.close())}formatDate(e){let t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${i}-${n}`}static{this.\u0275fac=function(t){return new(t||D)(V(N),V(q),V(I))}}static{this.\u0275cmp=G({type:D,selectors:[["app-modal-event"]],viewQuery:function(t,i){if(t&1&&(M(Se,5),M(ye,5),M(xe,5)),t&2){let n;w(n=F())&&(i.startTimePicker=n.first),w(n=F())&&(i.endTimePicker=n.first),w(n=F())&&(i.datePicker=n.first)}},inputs:{event:"event"},outputs:{eventSubmitted:"eventSubmitted",eventDeleted:"eventDeleted"},decls:56,vars:17,consts:[[1,"modal-header"],[1,"modal-title"],[1,"ki-duotone","ki-calendar-add","text-gray-900","fs-1",2,"vertical-align","text-top"],[1,"path1"],[1,"path2"],[1,"path3"],[1,"path4"],[1,"path5"],[1,"path6"],["type","button","aria-label","Close",1,"btn","btn-sm","btn-icon","btn-active-color-primary","btn-color-gray-800",3,"click"],[1,"ki-duotone","ki-cross-square","fs-1"],[1,"modal-body"],[1,"form","d-flex","flex-column","gap-4",3,"formGroup"],[1,"row"],[1,"form-group","col-6","mb-3"],["for","patient_selection",1,"form-label"],["formControlName","id_paciente","bindValue","id_paciente","placeholder","Seleccionar","bindLabel","nombre",3,"items","loadingText"],["for","id_paquete",1,"form-label"],["formControlName","id_tipocita","bindValue","id_tipocita","placeholder","Seleccionar","bindLabel","nombre",3,"change","items","loadingText"],["formControlName","id_sede","bindValue","id_sede","placeholder","Seleccionar","bindLabel","nombre",3,"items","loadingText"],[1,"form-group","col"],["for","kt_calendar_datepicker_date",1,"form-label"],["type","text","mwlFlatpickr","","altFormat","d/m/Y","id","kt_calendar_datepicker_date","formControlName","fecha_inicio","placeholder","Seleccionar Fecha(s)",1,"form-control",3,"noCalendar","altInput"],["for","kt_calendar_datepicker_start_time",1,"form-label"],["type","text","readonly","","id","kt_calendar_datepicker_start_time","formControlName","hora_inicio","placeholder","Seleccionar Hora de Inicio",1,"form-control"],["for","kt_calendar_datepicker_end_time",1,"form-label"],["type","text","readonly","","id","kt_calendar_datepicker_end_time","formControlName","hora_fin","placeholder","Seleccionar Hora de Fin",1,"form-control"],["formArrayName","detalle"],[1,"d-flex","justify-content-between","align-items-center"],["for","",1,"form-label","fw-bolder","fs-5"],[1,"btn","btn-primary","fs-10","btn-sm","btn-icon",3,"click"],[1,"ki-duotone","ki-plus"],[4,"ngFor","ngForOf"],["class","modal-footer",4,"ngIf"],[1,"form-group","d-flex","flex-column","gap-3","position-relative","p-4","border-2","mt-2","border-dashed","border-gray-300","rounded",3,"formGroupName"],["class","position-absolute end-0","style","transform: translateY(-18px) translateX(12px);",4,"ngIf"],[1,"col-6"],["for","",1,"form-label"],["bindValue","id_terapia","placeholder","Seleccionar","bindLabel","nombre","formControlName","id_terapia",3,"change","items","loadingText"],["bindValue","id_personal","placeholder","Seleccionar","bindLabel","nombre","formControlName","id_personal",3,"items","loadingText"],["class","row",4,"ngIf"],[1,"position-absolute","end-0",2,"transform","translateY(-18px) translateX(12px)"],[1,"btn","btn-sm","fs-10","btn-icon","btn-active-color-danger","btn-danger",3,"click"],[1,"ki-solid","ki-cross"],[1,"form-group","d-flex","flex-column","col","mb-3"],["for","kt_calendar_datepicker_end_date",1,"form-label"],[1,"btn-group"],["class","btn btn-outline",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"btn","btn-outline",3,"click","ngClass"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"h4",1)(2,"i",2),u(3,"span",3)(4,"span",4)(5,"span",5)(6,"span",6)(7,"span",7)(8,"span",8),a(),d(9," Registrar Nueva Cita "),a(),o(10,"button",9),f("click",function(){return i.closeModal()}),o(11,"i",10),u(12,"span",3)(13,"span",4),a()()(),o(14,"div",11)(15,"form",12)(16,"div",13)(17,"div",14)(18,"label",15),d(19,"Seleccionar Paciente"),a(),u(20,"ng-select",16),k(21,"async"),a(),o(22,"div",14)(23,"label",17),d(24,"Tipo de Cita"),a(),o(25,"ng-select",18),k(26,"async"),f("change",function(r){return i.changeTipoCita(r)}),a()(),o(27,"div",14)(28,"label",17),d(29,"Seleccionar Sede"),a(),u(30,"ng-select",19),k(31,"async"),a()(),o(32,"div",13)(33,"div",20)(34,"label",21),d(35,"Fecha"),a(),u(36,"input",22),a(),o(37,"div",20)(38,"label",23),d(39,"Hora de Inicio"),a(),u(40,"input",24),a(),o(41,"div",20)(42,"label",25),d(43,"Hora de Fin"),a(),u(44,"input",26),a()(),o(45,"div",27)(46,"div",28)(47,"label",29),d(48,"Detalle de la Cita"),a(),o(49,"button",30),f("click",function(){return i.addInfoTerapia()}),o(50,"span")(51,"i",31),u(52,"span",3)(53,"span",4),a()()()(),y(54,Me,14,9,"ng-container",32),a()()(),y(55,we,5,0,"div",33)),t&2&&(l(15),s("formGroup",i.eventForm),l(5),s("items",T(21,11,i.pacientesList))("loadingText","Cargando.."),l(5),s("items",T(26,13,i.tipoCitasList))("loadingText","Cargando.."),l(5),s("items",T(31,15,i.sedesList))("loadingText","Cargando.."),l(6),s("noCalendar",!0)("altInput",!0),l(18),s("ngForOf",i.detalle.controls),l(),s("ngIf",!i.event))},dependencies:[$,Y,J,W,X,z,K,Z,ie,ee,te,re,se,U]})}};ve=A([ae({checkProperties:!0}),O("design:paramtypes",[N,q,I])],ve);export{ve as a};
