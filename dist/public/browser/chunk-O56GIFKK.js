import{a as A,b as j}from"./chunk-MG6ACQDW.js";import{a as E}from"./chunk-X6NFAZFH.js";import{a as F}from"./chunk-NR6WIMHC.js";import{a as P,b as M,c as R,d as D}from"./chunk-QXJCGNJL.js";import"./chunk-MGQU4BYR.js";import{a as w}from"./chunk-PIACHCSP.js";import{a as _}from"./chunk-J6P2CT7J.js";import"./chunk-GKZUPR7X.js";import{j as b,m as I}from"./chunk-APQUY7ND.js";import"./chunk-JS4ZJV2L.js";import{Ba as v,Fc as u,Mb as g,Oc as C,Qc as x,Vb as m,ac as y,f as h,fc as a,gc as r,hc as S,v as p,vc as l,wb as d,xa as o}from"./chunk-B762IU3Y.js";var k=h(P()),n=h(A()),W=h(j());var O=i=>["/ficha-result",i];function V(i,t){if(i&1&&(a(0,"div",0)(1,"div",2)(2,"h1"),u(3,"Ficha Completada"),r(),a(4,"a",3),u(5,"Ver Contenido"),r()()()),i&2){let e=l();d(4),m("routerLink",x(1,O,e.fichaResultExists.id))}}function z(i,t){if(i&1&&(a(0,"div",1),S(1,"survey",4),r()),i&2){let e=l();d(),m("model",e.survey)}}var T=class f{constructor(){this.route=o(b),this.theme=o(_),this.fichaId=this.route.snapshot.paramMap.get("surveyId"),this.sesionId=this.route.snapshot.paramMap.get("sesionId"),this.fichaService=o(F),this.citaService=o(E),this.fichaResult=o(D),this.showCloseMg=!1,this.fichaResultExists=null}ngOnInit(){this.fichaResultExists||this.getFicha(),this.getFichaExists()}mergePaciente(t){this.citaService.getPacienteInfo(this.sesionId).subscribe(e=>{t.mergeData({nombres:e.data.nombres,diagnostico:e.data.diagnostico,apoderado:e.data.apoderado,fecha_nacimiento:e.data.fecha_nacimiento,edad:e.data.edad,personal:e.data.personal,telefono:e.data.telefono,colegio:e.data.colegio})})}getFichaExists(){this.fichaResult.exists(this.sesionId,this.fichaId).subscribe(t=>{this.fichaResultExists=t.data})}getFicha(){this.fichaService.getById(this.fichaId).subscribe(t=>{this.survey=new k.Model(t.data.body),this.survey.locale="es",this.survey.applyTheme(this.theme.getThemeMode()==="dark"?n.DefaultDark:n.DefaultLight);let e="<h3>Ficha Completada!</h3>";this.survey.completedHtml=e,this.showCloseMg&&(e+='<a href="javascript:window.close();">Ya puede cerrar esta ventana</a>'),this.mergePaciente(this.survey),this.survey.onComplete.add((c,s)=>{s.showSaveInProgress(),this.fichaResult.create({id_sesion:this.sesionId,id_ficha:this.fichaId,body:JSON.stringify(c.data)}).subscribe({next:()=>{this.showCloseMg=!0,console.log(this.showCloseMg),s.showSaveSuccess("Ficha Guardada Correctamente!")},error:L=>{this.showCloseMg=!1,L.status==403?s.showSaveError("Sin Autorizacion!"):s.showSaveError()}})})})}ngAfterViewInit(){}static{this.\u0275fac=function(e){return new(e||f)}}static{this.\u0275cmp=v({type:f,selectors:[["app-survey"]],standalone:!0,features:[C],decls:2,vars:1,consts:[[2,"position","absolute","left","50%","top","45%","transform","translate(-50%, 0)"],[1,"ficha-container"],[1,"d-flex","flex-column","align-items-center","gap-4","border-2","border-dashed","border-gray-300","bg-gray-300","rounded-1","px-10","py-8"],[1,"btn","btn-info","btn-lg",3,"routerLink"],[3,"model"]],template:function(e,c){e&1&&g(0,V,6,3,"div",0)(1,z,2,1,"div",1),e&2&&y(c.fichaResultExists?0:1)},dependencies:[R,M,I]})}};T=p([w()],T);export{T as SurveyComponent};
